C51 COMPILER V9.59.0.0   MMI_MS                                                            04/19/2021 17:37:53 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE MMI_MS
OBJECT MODULE PLACED IN .\output\mmi_ms.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE mmi_src\mmi_ms.c LARGE OMF2 OPTIMIZE(8,SPEED) BROWSE INCDIR(.\include;.\
                    -Library\byd_standard_peripheral\include;.\byd_api\byd_key\include;.\byd_api\byd_mifare\include;.\byd_tool_comm;.\byd_rfi
                    -d;.\mmi_inc) DEBUG PRINT(.\list\mmi_ms.lst) TABS(2) OBJECT(.\output\mmi_ms.obj)

line level    source

   1          #ifndef __MMI_MS_C__
   2          #define __MMI_MS_C__
   3          
   4          #include "string.h"
   5          #include "mmi_ms.h"
   6          #include "mmi_key.h"
   7          #include "mmi_sys.h"
   8          #include "mmi_audio.h"
   9          #include "mmi_fps.h"
  10          #include "mmi_rfid.h"
  11          #include "mmi_com.h"
  12          #include "mmi_fs.h"
  13          #include "mmi_rst.h"
  14          #include "dqiot_drv.h"
  15          #include "delay.h"
  16          #include "mmi_fs.h"
  17          #include "mmi_fm.h"
  18          #include "mmi_wifi.h"
  19          #include "dqiot_drv_wifi.h"
  20          #include <stdio.h>
  21          
  22          unsigned char input_key_1[KEY_INPUT_MAX_LEN];
  23          unsigned char input_key_2[KEY_INPUT_MAX_LEN];
  24          unsigned char key_len = 0;
  25          OPERATE_TIME opt_time = OPT_TIME_INVALID;
  26          static SYS_BASE_STATUS data sys_state = SYS_STATUS_INVALID;
  27          
  28          static unsigned char data key_last_value = KEY_INVALID;
  29          #ifdef __LOCK_RFID_CARD_SUPPORT__
  30          static unsigned char rfid_last_flag = 0;
  31          #endif
  32          #ifdef __LOCK_BUS_SUPPORT__
  33          static unsigned char admin_check_type = 0;
  34          #endif
  35          
  36          // extern void printfS(char *show, char *status);
  37          // extern void printfV(char *show, int value);
  38          
  39          /*
  40          parameter: 
  41            none
  42          return :
  43            none
  44          */
  45          void mmi_task_proc(void)
  46          {
  47   1        unsigned char touch_value = 0xFF;
  48   1        unsigned char key_value = KEY_INVALID;
  49   1      
  50   1      #ifdef __LOCK_RFID_CARD_SUPPORT__
  51   1        if (mmi_dq_sys_get_rfid_flag() == 1)
  52   1        {
  53   2          //check rfid press
C51 COMPILER V9.59.0.0   MMI_MS                                                            04/19/2021 17:37:53 PAGE 2   

  54   2          if (mmi_dq_rfid_check() == RET_SUCESS)
  55   2          {
  56   3            if (mmi_dq_rfid_work() == RET_SUCESS)
  57   3            {
  58   4              if (rfid_last_flag == 0)
  59   4              {
  60   5                rfid_last_flag = 1;
  61   5                mmi_dq_ms_set_msg_que(QUE_EVENT_RFID, QUE_PRO_LOW, 0);
  62   5              }
  63   4            }
  64   3            else
  65   3            {
  66   4              rfid_last_flag = 0;
  67   4            }
  68   3          }
  69   2        }
  70   1      #endif
  71   1        //check key press
  72   1        touch_value = mmi_dq_key_work();
  73   1        if (touch_value != 0xFF)
  74   1        {
  75   2          key_value = mmi_dq_get_key_map(touch_value);
  76   2          if (key_value != KEY_INVALID)
  77   2          {
  78   3            if (key_last_value != key_value)
  79   3            {
  80   4              key_last_value = key_value;
  81   4              mmi_dq_ms_set_msg_que(QUE_EVENT_KEY, QUE_PRO_LOW, key_value);
  82   4            }
  83   3          }
  84   2          else
  85   2            key_last_value = KEY_INVALID;
  86   2        }
  87   1        else
  88   1          key_last_value = KEY_INVALID;
  89   1      
  90   1      #ifdef __LOCK_AUDIO_SUPPORT__
  91   1        if (mmi_dq_aud_get_end_flag() != 0)
  92   1          mmi_dq_ms_set_msg_que(QUE_EVENT_AUDIO_END, QUE_PRO_LOW, 0);
  93   1      #endif
  94   1      
  95   1        if (mmi_dq_rst_get_state() != 0)
  96   1          mmi_dq_ms_set_msg_que(QUE_EVENT_RST, QUE_PRO_LOW, 0);
  97   1      
  98   1        if (mmi_dq_sys_get_timer2_flag() != 0)
  99   1          mmi_dq_ms_set_msg_que(QUE_EVENT_TIMER_END, QUE_PRO_LOW, 0);
 100   1      
 101   1      #ifdef __LOCK_FP_SUPPORT__
 102   1          //check fp press
 103   1          // if (mmi_dq_fp_work() != 0)
 104   1          //  mmi_dq_ms_set_msg_que(QUE_EVENT_FP, QUE_PRO_LOW, 0);
 105   1      #endif
 106   1      
 107   1      #ifdef __LOCK_WIFI_SUPPORT__
 108   1        if (mmi_dq_sys_get_wifi_check_flag() != 0)
 109   1          mmi_dq_ms_set_msg_que(QUE_EVENT_WIFI_CHECK, QUE_PRO_LOW, 0);
 110   1      #endif
 111   1      
 112   1        return;
 113   1      }
 114          
 115          /*
C51 COMPILER V9.59.0.0   MMI_MS                                                            04/19/2021 17:37:53 PAGE 3   

 116          parameter: 
 117            none
 118          return :
 119            none
 120          */
 121          void mmi_sleep_task_proc(void)
 122          {
 123   1      #ifdef __LOCK_RFID_CARD_SUPPORT__
 124   1        unsigned char ret = 0xFF;
 125   1        static unsigned char time_count = 0;
 126   1      
 127   1        time_count++;
 128   1        if (time_count > 4)
 129   1        {
 130   2          time_count = 0;
 131   2          ret = mmi_dq_rfid_check();
 132   2        }
 133   1      #endif
 134   1      
 135   1        if (
 136   1      #ifdef __LOCK_RFID_CARD_SUPPORT__
 137   1          (ret == RET_SUCESS) ||
 138   1      #endif
 139   1          (mmi_dq_key_check() != 0) || (mmi_dq_rst_get_pin() != 0)
 140   1      #ifdef __LOCK_FP_SUPPORT__
 141   1          || (mmi_dq_fp_get_pin() == 1)
 142   1      #endif
 143   1        )
 144   1        {
 145   2          key_last_value = mmi_dq_get_key_map(dqiot_drv_get_touch_value());
 146   2          mmi_dq_sys_wake_up();
 147   2        }
 148   1      
 149   1      #ifdef __LOCK_WIFI_SUPPORT__
 150   1        //if(mmi_dq_sys_get_wifi_check_flag() != 0)
 151   1        //  mmi_dq_ms_set_msg_que(QUE_EVENT_WIFI_CHECK,QUE_PRO_LOW,0);
 152   1      #endif
 153   1      
 154   1        return;
 155   1      }
 156          
 157          /*
 158          parameter: 
 159            none
 160          return :
 161            none
 162          */
 163          void mmi_wait_sleep_task_proc(void)
 164          {
 165   1      //unsigned int timer1_count = 0;
 166   1      #ifdef __LOCK_WIFI_SUPPORT__
 167   1        if (mmi_dq_wifi_get_running_flag() == 1)
 168   1          mmi_dq_ms_set_sys_state(SYS_STATUS_IDLE);
 169   1        //if((mmi_dq_rfid_check() == RET_SUCESS) || (mmi_dq_key_check() != 0) || (mmi_dq_rst_get_pin() == 0))
 170   1        else
 171   1      #endif
 172   1          if (mmi_dq_ms_get_run_flag() == 0)
 173   1        {
 174   2          mmi_dq_sys_enter_sleep();
 175   2        }
 176   1      
 177   1        return;
C51 COMPILER V9.59.0.0   MMI_MS                                                            04/19/2021 17:37:53 PAGE 4   

 178   1      }
 179          
 180          /*
 181          parameter: 
 182            none
 183          return :
 184            none
 185          */
 186          unsigned char mmi_dq_ms_get_run_flag(void)
 187          {
 188   1        if ((key_last_value == KEY_INVALID)
 189   1      #ifdef __LOCK_AUDIO_SUPPORT__
 190   1          && (mmi_dq_aud_get_state() == 0)
 191   1      #endif
 192   1          && (mmi_dq_rst_get_pin() == 0)
 193   1      #ifdef __LOCK_FP_SUPPORT__
 194   1          && (mmi_dq_fp_get_pin() != 1)
 195   1      #endif
 196   1      #ifdef __LOCK_RFID_CARD_SUPPORT__
 197   1          && rfid_last_flag == 0
 198   1      #endif
 199   1        )
 200   1          return 0;
 201   1      
 202   1        return 1;
 203   1      }
 204          
 205          /*
 206          parameter: 
 207            none
 208          return :
 209            none
 210          */
 211          void mmi_dq_ms_sys_msg_handle(void)
 212          {
 213   1        Sys_MSG_Queue_M sys_msg_que;
 214   1        if (mmi_OutQueue(&sys_msg_que))
 215   1        {
 216   2          mmi_dq_sys_sleep_timer_reset();
 217   2          switch (sys_msg_que.que_event)
 218   2          {
 219   3          case QUE_EVENT_KEY:
 220   3            mmi_ms_pwd_opt_fun(sys_msg_que.que_data);
 221   3            break;
 222   3      #ifdef __LOCK_FP_SUPPORT__
 223   3          case QUE_EVENT_FP:
 224   3            mmi_ms_fps_opt_fun(sys_msg_que.que_data);
 225   3            break;
 226   3      #endif
 227   3      #ifdef __LOCK_RFID_CARD_SUPPORT__
 228   3          case QUE_EVENT_RFID:
 229   3            mmi_ms_rfid_opt_fun(sys_msg_que.que_data);
 230   3            break;
 231   3      #endif
 232   3          case QUE_EVENT_RST:
 233   3            mmi_ms_reset_opt_fun();
 234   3            break;
 235   3          case QUE_EVENT_AUDIO_END:
 236   3      
 237   3            break;
 238   3          case QUE_EVENT_TIMER_END:
 239   3            mmi_dq_sys_delay_event_pro();
C51 COMPILER V9.59.0.0   MMI_MS                                                            04/19/2021 17:37:53 PAGE 5   

 240   3            break;
 241   3      #ifdef __LOCK_WIFI_SUPPORT__
 242   3          case QUE_EVENT_WIFI_CHECK:
 243   3            mmi_ms_wifi_opt_fun();
 244   3            break;
 245   3      #endif
 246   3          default:
 247   3            break;
 248   3          }
 249   2        }
 250   1      }
 251          
 252          /*
 253          parameter: 
 254            none
 255          return :
 256            none
 257          */
 258          void mmi_dq_ms_set_msg_que(SYS_QUEUE_EVENT q_event, SYS_QUEUE_PRO q_pro, unsigned char q_data)
 259          {
 260   1        Sys_MSG_Queue_M que;
 261   1        que.que_event = q_event;
 262   1        que.que_pro = q_pro;
 263   1        que.que_data = q_data;
 264   1        //printf("mmi_dq_ms_set_msg_que  event : %d",q_event);
 265   1        mmi_InQueue(que);
 266   1        return;
 267   1      }
 268          
 269          /*
 270          parameter: 
 271            none
 272          return :
 273            none
 274          */
 275          void mmi_dq_ms_set_sys_state(SYS_BASE_STATUS state)
 276          {
 277   1        sys_state = state;
 278   1        return;
 279   1      }
 280          
 281          /*
 282          parameter: 
 283            none
 284          return :
 285            none
 286          */
 287          SYS_BASE_STATUS mmi_dq_ms_get_sys_state(void)
 288          {
 289   1        return sys_state;
 290   1      }
 291          
 292          /*
 293          parameter: 
 294            none
 295          return :
 296            none
 297          */
 298          void mmi_ms_pwd_init_var(void)
 299          {
 300   1        key_len = 0;
 301   1        opt_time = OPT_ONE_TIME;
C51 COMPILER V9.59.0.0   MMI_MS                                                            04/19/2021 17:37:53 PAGE 6   

 302   1        memset(input_key_1, 0xFF, sizeof(input_key_1));
 303   1        memset(input_key_2, 0xFF, sizeof(input_key_2));
 304   1      }
 305          
 306          /*
 307          parameter: 
 308            none
 309          return :
 310            none
 311          */
 312          void mmi_ms_opt_time_init(void)
 313          {
 314   1        opt_time = OPT_ONE_TIME;
 315   1      }
 316          
 317          /*
 318          parameter: 
 319            none
 320          return :
 321            none
 322          */
 323          void mmi_ms_pwd_opt_fun(unsigned char key_val)
 324          {
 325   1        SYS_BASE_STATUS status = mmi_dq_ms_get_sys_state();
 326   1        //printf("mmi_ms_pwd_opt_fun status: 0x%x  key: %d",status,key_val);
 327   1        switch (status)
 328   1        {
 329   2        case SYS_STATUS_WAIT_FOR_ENTER_SLEEP:
 330   2          mmi_dq_ms_set_sys_state(SYS_STATUS_IDLE);
 331   2          status = SYS_STATUS_IDLE;
 332   2        case SYS_STATUS_INPUT_PWD:
 333   2        case SYS_STATUS_INPUT_ADMIN_PWD:
 334   2        case SYS_STATUS_ADD_PWD:
 335   2        case SYS_STATUS_DEL_PWD:
 336   2        case SYS_STATUS_ADD_ADMIN_PWD:
 337   2        case SYS_STATUS_CHG_ADMIN_PWD:
 338   2      #ifdef __LOCK_110_SUPPORT__
 339   2        case SYS_STATUS_ADD_110_PWD:
 340   2      #endif
 341   2          if (mmi_dq_sys_door_state_check() == 1)
 342   2          {
 343   3      #ifdef __LOCK_AUDIO_SUPPORT__
 344   3            mmi_dq_aud_stop();
 345   3            mmi_dq_aud_play_with_id(AUD_ID_RONG_TIMES_EXCEED);
 346   3      #endif
 347   3      #ifdef __LOCK_WIFI_SUPPORT__
 348   3            mmi_dq_wifi_pw_alarm();
 349   3      #endif
 350   3            return;
 351   3          }
 352   2          if (key_len == 0)
 353   2          {
 354   3            if (key_val == KEY_S)
 355   3            {
 356   4              if (SYS_STATUS_ADD_ADMIN_PWD != status)
 357   4              {
 358   5      #ifdef __LOCK_AUDIO_SUPPORT__
 359   5                mmi_dq_aud_play_key_tone();
 360   5      #endif
 361   5                if (status == SYS_STATUS_INPUT_PWD)
 362   5                  //mmi_dq_sys_enter_sleep();
 363   5                  mmi_dq_ms_set_sys_state(SYS_STATUS_WAIT_FOR_ENTER_SLEEP);
C51 COMPILER V9.59.0.0   MMI_MS                                                            04/19/2021 17:37:53 PAGE 7   

 364   5                else if (status == SYS_STATUS_INPUT_ADMIN_PWD)
 365   5                  mmi_dq_ms_set_sys_state(SYS_STATUS_IDLE);
 366   5      #ifdef __LOCK_WIFI_SUPPORT__
 367   5                else if (wifi_add_flag != 0)
 368   5                {
 369   6                  wifi_add_flag = 0;
 370   6                  mmi_dq_ms_set_sys_state(SYS_STATUS_IDLE);
 371   6                }
 372   5                else
 373   5      #endif
 374   5                  mmi_dq_sys_show_cur_menu_list();
 375   5              }
 376   4              break;
 377   4            }
 378   3            else if (key_val == KEY_H)
 379   3            {
 380   4              if (status == SYS_STATUS_INPUT_PWD)
 381   4              {
 382   5      #ifdef __LOCK_AUDIO_SUPPORT__
 383   5                mmi_dq_aud_play_key_tone();
 384   5      #endif
 385   5      #ifdef __LOCK_BUS_SUPPORT__
 386   5                admin_check_type = 0;
 387   5      #endif
 388   5      #ifdef __LOCK_AUDIO_SUPPORT__
 389   5                mmi_dq_aud_play_with_id(AUD_ID_INPUT_ADMIN_PWD);
 390   5      #endif
 391   5                mmi_dq_ms_set_sys_state(SYS_STATUS_INPUT_ADMIN_PWD);
 392   5              }
 393   4              break;
 394   4            }
 395   3          }
 396   2      
 397   2      // mmi_dq_aud_play_key_num(key_val);
 398   2      #ifdef __LOCK_AUDIO_SUPPORT__
 399   2          mmi_dq_aud_play_key_tone();
 400   2      #endif
 401   2          //input pwd
 402   2          if ((key_val >= KEY_0 && key_val <= KEY_9) && key_len < KEY_INPUT_MAX_LEN)
 403   2          {
 404   3            if ((status == SYS_STATUS_INPUT_PWD) || (status == SYS_STATUS_INPUT_ADMIN_PWD))
 405   3              input_key_1[key_len++] = key_val;
 406   3            else // if((status == SYS_STATUS_ADD_PWD)||(status == SYS_STATUS_ADD_110_PWD)||(status == SYS_STATUS_AD
             -D_ADMIN_PWD))
 407   3            {
 408   4              if (opt_time == OPT_ONE_TIME)
 409   4              {
 410   5                input_key_1[key_len++] = key_val;
 411   5              }
 412   4              else if (opt_time == OPT_TWO_TIME)
 413   4              {
 414   5                input_key_2[key_len++] = key_val;
 415   5              }
 416   4            }
 417   3          }
 418   2      
 419   2          if (key_val == KEY_S)
 420   2          {
 421   3            if (opt_time == OPT_ONE_TIME)
 422   3              input_key_1[key_len--] = 0xFF;
 423   3            else if (opt_time == OPT_TWO_TIME)
 424   3              input_key_2[key_len--] = 0xFF;
C51 COMPILER V9.59.0.0   MMI_MS                                                            04/19/2021 17:37:53 PAGE 8   

 425   3      
 426   3            if (key_len == 0)
 427   3            {
 428   4              if (status == SYS_STATUS_INPUT_ADMIN_PWD)
 429   4      #ifdef __LOCK_AUDIO_SUPPORT__
 430   4                mmi_dq_aud_play_with_id(AUD_ID_INPUT_ADMIN_PWD)
 431   4      #endif
 432   4                  ;
 433   4              else if (opt_time == OPT_ONE_TIME)
 434   4              {
 435   5      #ifdef __LOCK_AUDIO_SUPPORT__
 436   5                if (status == SYS_STATUS_ADD_PWD || status == SYS_STATUS_ADD_110_PWD)
 437   5                  mmi_dq_aud_play_with_id(AUD_ID_INPUT_68_PWD);
 438   5                else if (status == SYS_STATUS_DEL_PWD)
 439   5                  mmi_dq_aud_play_with_id(AUD_ID_INPUT_DEL_NUM);
 440   5                else if (status == SYS_STATUS_ADD_ADMIN_PWD)
 441   5                  mmi_dq_aud_play_with_id(AUD_ID_ADD_ADMIN_PWD_FIRST);
 442   5                else if (status == SYS_STATUS_CHG_ADMIN_PWD)
 443   5                  mmi_dq_aud_play_with_id(AUD_ID_INPUT_NEW_ADMIN_PWD);
 444   5      #endif
 445   5              }
 446   4              else if (opt_time == OPT_TWO_TIME)
 447   4              {
 448   5      #ifdef __LOCK_AUDIO_SUPPORT__
 449   5                if (status == SYS_STATUS_ADD_PWD || status == SYS_STATUS_ADD_110_PWD)
 450   5                  mmi_dq_aud_play_with_id(AUD_ID_PWD_INPUT_AGAIN);
 451   5                else if (status == SYS_STATUS_DEL_PWD)
 452   5                  mmi_dq_aud_play_with_id(AUD_ID_INPUT_DEL_PWD_AGAIN);
 453   5                else if (status == SYS_STATUS_ADD_ADMIN_PWD)
 454   5                  mmi_dq_aud_play_with_id(AUD_ID_INPUT_ADMIN_PWD_INIT_AGAIN);
 455   5                else if (status == SYS_STATUS_CHG_ADMIN_PWD)
 456   5                  mmi_dq_aud_play_with_id(AUD_ID_INPUT_NEW_ADMIN_PWD_AGAIN);
 457   5      #endif
 458   5              }
 459   4            }
 460   3          }
 461   2          else if ((key_val == KEY_H) || (key_len == PWD_INPUT_MAX_LEN))
 462   2          {
 463   3            if (key_len < PWD_INPUT_MIN_LEN)
 464   3            {
 465   4              if (status == SYS_STATUS_INPUT_PWD)
 466   4              {
 467   5                if (key_len == 2 && input_key_1[0] == KEY_0 && input_key_1[1] == KEY_0) //00 è¿œç¨‹å¼€é—¨
 468   5                  mmi_dq_sys_wifi_open();
 469   5      #ifdef __LOCK_WIFI_SUPPORT__
 470   5                else if (key_len == 1 && input_key_1[0] == KEY_5) //5 æ·»åŠ åˆ é™¤å¯†ç /æŒ‡çº¹/RFå¡
 471   5                  mmi_dq_wifi_cmd_add_del();
 472   5                else if (key_len == 1 && input_key_1[0] == KEY_6) //6 è®¾ç½®æ‹ç…§/å½•åƒå¼€å…³
 473   5                  mmi_dq_wifi_pv_switch();
 474   5                else if (key_len == 2 && input_key_1[0] == KEY_1 && input_key_1[1] == KEY_8) //18 åº”æ€¥é’¥åŒ™å¼€é—¨æ
             -ˆåŠŸ
 475   5                  mmi_dq_wifi_open_by_key();
 476   5                else if (key_len == 2 && input_key_1[0] == KEY_1 && input_key_1[1] == KEY_9) //19 é—¨æœªå…³
 477   5                  mmi_dq_wifi_close_over_time();
 478   5                else if (key_len == 2 && input_key_1[0] == KEY_2 && input_key_1[1] == KEY_0) //20 éœ‡åŠ¨æŠ¥è­¦
 479   5                  mmi_dq_wifi_via_alarm();
 480   5                else if (key_len == 2 && input_key_1[0] == KEY_2 && input_key_1[1] == KEY_5) //25 ç¡çœ 
 481   5                  mmi_dq_wifi_sleep();
 482   5                else if (key_len == 2 && input_key_1[0] == KEY_2 && input_key_1[1] == KEY_6) //26 å”¤é†’
 483   5                  mmi_dq_wifi_wakeup();
 484   5                // else if (key_len == 2 && input_key_1[0] == KEY_2 && input_key_1[1] == KEY_7) //27 æ‹ç…§
 485   5                //  mmi_dq_wifi_take_photos();
C51 COMPILER V9.59.0.0   MMI_MS                                                            04/19/2021 17:37:53 PAGE 9   

 486   5                else if (key_len == 2 && input_key_1[0] == KEY_2 && input_key_1[1] == KEY_8) //28 å½•åƒ
 487   5                  mmi_dq_wifi_take_videos();
 488   5                else if (key_len == 2 && input_key_1[0] == KEY_3 && input_key_1[1] == KEY_0) //30 æŸ¥è¯¢ç½‘ç»œçŠ¶æ€
 489   5                  mmi_dq_wifi_check_net();
 490   5                  // else if (key_len == 2 && input_key_1[0] == KEY_3 && input_key_1[1] == KEY_1) //31 Airkissé…ç½‘(a
             -dmin 8)
 491   5                  // mmi_dq_wifi_arikiss_con();
 492   5                  // else if (key_len == 2 && input_key_1[0] == KEY_3 && input_key_1[1] == KEY_2) //32 äºŒç»´ç é…ç½‘
             -(admin 9)
 493   5                  //  mmi_dq_wifi_code_con();
 494   5      #endif
 495   5      #ifdef __LOCK_BUS_SUPPORT__
 496   5                else if (key_len == 2 && input_key_1[0] == KEY_0 && input_key_1[1] == KEY_1) //01
 497   5                {
 498   6      
 499   6                  if (mmi_dq_fs_get_business_flag() == 1)
 500   6                  {
 501   7                    admin_check_type = 1;
 502   7      #ifdef __LOCK_AUDIO_SUPPORT__
 503   7                    mmi_dq_aud_play_with_id(AUD_ID_INPUT_ADMIN_PWD);
 504   7      #endif
 505   7                    mmi_dq_ms_set_sys_state(SYS_STATUS_INPUT_ADMIN_PWD);
 506   7                  }
 507   6                  else
 508   6                  {
 509   7                    mmi_dq_fs_set_business_flag(1);
 510   7      #ifdef __LOCK_AUDIO_SUPPORT__
 511   7                    mmi_dq_aud_play_with_id(AUD_ID_OUT_OPEN);
 512   7      #endif
 513   7                    mmi_dq_ms_set_sys_state(SYS_STATUS_IDLE);
 514   7                  }
 515   6                }
 516   5      #endif
 517   5                else
 518   5                {
 519   6                  mmi_dq_sys_door_open_fail(SYS_OPEN_BY_PASSWORD);
 520   6                }
 521   5                key_len = 0;
 522   5                memset(input_key_1, 0xFF, sizeof(input_key_1));
 523   5              }
 524   4              else
 525   4              {
 526   5      #ifdef __LOCK_AUDIO_SUPPORT__
 527   5                mmi_dq_aud_play_with_id(AUD_ID_PWD_68_LEN);
 528   5      #endif
 529   5                key_len = 0;
 530   5                if (opt_time == OPT_ONE_TIME)
 531   5                  memset(input_key_1, 0xFF, sizeof(input_key_1));
 532   5                else if (opt_time == OPT_TWO_TIME)
 533   5                  memset(input_key_2, 0xFF, sizeof(input_key_2));
 534   5              }
 535   4            }
 536   3            else
 537   3            {
 538   4              if (status == SYS_STATUS_INPUT_PWD)
 539   4              {
 540   5                //if(mmi_dq_fs_check_input_pwd(input_key_1,key_len,FDS_USE_TYPE_ALL) == 0xFF)
 541   5                unsigned char ret = 0;
 542   5                ret = mmi_dq_fs_check_input_pwd_for_open(input_key_1, key_len);
 543   5                //printf("check input ret: %d",(unsigned int)ret);
 544   5                if (ret == 0xFF)
 545   5                  mmi_dq_sys_door_open_fail(SYS_OPEN_BY_PASSWORD);
C51 COMPILER V9.59.0.0   MMI_MS                                                            04/19/2021 17:37:53 PAGE 10  

 546   5      #ifdef __LOCK_BUS_SUPPORT__
 547   5                else if (ret == 0xFE && mmi_dq_fs_get_business_flag() == 1)
 548   5                {
 549   6                  mmi_dq_fs_set_business_flag(0);
 550   6      #ifdef __LOCK_AUDIO_SUPPORT__
 551   6                  mmi_dq_aud_play_with_id(AUD_ID_OUT_CLOSED);
 552   6      #endif
 553   6                  mmi_dq_ms_set_sys_state(SYS_STATUS_IDLE);
 554   6                }
 555   5      #endif
 556   5      #ifdef __LOCK_110_SUPPORT__
 557   5                else if (ret == 1)
 558   5                  mmi_dq_sys_door_open(SYS_OPEN_BY_110_PASSWORD);
 559   5      #endif
 560   5                else
 561   5                  mmi_dq_sys_door_open(SYS_OPEN_BY_PASSWORD);
 562   5                key_len = 0;
 563   5                memset(input_key_1, 0xFF, sizeof(input_key_1));
 564   5              }
 565   4              else if (status == SYS_STATUS_INPUT_ADMIN_PWD)
 566   4              {
 567   5                if (mmi_dq_fs_check_input_pwd(input_key_1, key_len, FDS_USE_TYPE_ADMIN) == 0xFF)
 568   5      #ifdef __LOCK_AUDIO_SUPPORT__
 569   5                  mmi_dq_aud_play_with_id(AUD_ID_PWD_WRONG_TRY)
 570   5      #endif
 571   5                    ;
 572   5                else
 573   5                {
 574   6      #ifdef __LOCK_BUS_SUPPORT__
 575   6                  if (admin_check_type == 1)
 576   6                  {
 577   7                    mmi_dq_fs_set_business_flag(0);
 578   7      #ifdef __LOCK_AUDIO_SUPPORT__
 579   7                    mmi_dq_aud_play_with_id(AUD_ID_OUT_CLOSED);
 580   7      #endif
 581   7                    mmi_dq_ms_set_sys_state(SYS_STATUS_IDLE);
 582   7                  }
 583   6                  else
 584   6      #endif
 585   6                  {
 586   7                    mmi_dq_sys_set_menu_father_id(STR_ID_SYSTEM);
 587   7                    mmi_dq_sys_show_cur_menu_list();
 588   7                  }
 589   6                }
 590   5                key_len = 0;
 591   5                memset(input_key_1, 0xFF, sizeof(input_key_1));
 592   5              }
 593   4              else // if((status == SYS_STATUS_ADD_PWD)||(status == SYS_STATUS_DEL_PWD)||(status == SYS_STATUS_ADD_A
             -DMIN_PWD)||(status == SYS_STATUS_CHG_ADMIN_PWD)||(status == SYS_STATUS_ADD_110_PWD))
 594   4              {
 595   5                if (opt_time == OPT_ONE_TIME)
 596   5                {
 597   6      #ifdef __LOCK_AUDIO_SUPPORT__
 598   6                  if (status == SYS_STATUS_ADD_PWD || status == SYS_STATUS_ADD_110_PWD)
 599   6                    mmi_dq_aud_play_with_id(AUD_ID_PWD_INPUT_AGAIN);
 600   6                  else if (status == SYS_STATUS_DEL_PWD)
 601   6                    mmi_dq_aud_play_with_id(AUD_ID_INPUT_DEL_PWD_AGAIN);
 602   6                  else if (status == SYS_STATUS_ADD_ADMIN_PWD)
 603   6                    mmi_dq_aud_play_with_id(AUD_ID_INPUT_ADMIN_PWD_INIT_AGAIN);
 604   6                  else if (status == SYS_STATUS_CHG_ADMIN_PWD)
 605   6                    mmi_dq_aud_play_with_id(AUD_ID_INPUT_NEW_ADMIN_PWD_AGAIN);
 606   6      #endif
C51 COMPILER V9.59.0.0   MMI_MS                                                            04/19/2021 17:37:53 PAGE 11  

 607   6      
 608   6                  opt_time = OPT_TWO_TIME;
 609   6                  key_len = 0;
 610   6                  memset(input_key_2, 0xFF, sizeof(input_key_2));
 611   6                }
 612   5                else if (opt_time == OPT_TWO_TIME)
 613   5                {
 614   6                  if (0 == memcmp(input_key_1, input_key_2, PWD_INPUT_MAX_LEN))
 615   6                  {
 616   7                    if (status == SYS_STATUS_DEL_PWD)
 617   7                    {
 618   8                      unsigned char del_index = mmi_dq_fs_check_input_pwd(input_key_1, key_len, FDS_USE_TYPE_USER);
 619   8                      if (del_index == 0xFF)
 620   8      #ifdef __LOCK_AUDIO_SUPPORT__
 621   8                        mmi_dq_aud_play_with_id(AUD_ID_PWD_NOT_EXIST)
 622   8      #endif
 623   8                          ;
 624   8                      else
 625   8                      {
 626   9                        if (mmi_dq_fs_del_pwd(del_index, FDS_USE_TYPE_USER) == RET_SUCESS)
 627   9                        {
 628  10                          get_index = del_index;
 629  10      #ifdef __LOCK_AUDIO_SUPPORT__
 630  10                          mmi_dq_aud_play_with_id(AUD_ID_DEL_PWD_SUCESS);
 631  10      #endif
 632  10      #ifdef __LOCK_WIFI_SUPPORT__
 633  10                          mmi_dq_wifi_del_password(get_index);
 634  10      #endif
 635  10                          // printfV("get_index", (int)get_index);
 636  10                        }
 637   9                        else
 638   9      #ifdef __LOCK_AUDIO_SUPPORT__
 639   9                          mmi_dq_aud_play_with_id(AUD_ID_DEL_FAIL)
 640   9      #endif
 641   9                            ;
 642   9                        mmi_dq_sys_del_pwd_con();
 643   9                      }
 644   8                    }
 645   7                    else if (mmi_dq_fs_check_input_pwd(input_key_1, key_len, FDS_USE_TYPE_ALL) != 0xFF)
 646   7      #ifdef __LOCK_AUDIO_SUPPORT__
 647   7                      mmi_dq_aud_play_with_id(AUD_ID_PWD_EXIST)
 648   7      #endif
 649   7                        ;
 650   7                    else
 651   7                    {
 652   8                      if (status == SYS_STATUS_ADD_PWD)
 653   8                      {
 654   9                        if (mmi_dq_fs_set_pwd(input_key_1, key_len, FDS_USE_TYPE_USER) == RET_FAIL)
 655   9      #ifdef __LOCK_AUDIO_SUPPORT__
 656   9                          mmi_dq_aud_play_with_id(AUD_ID_ADD_FAIL)
 657   9      #endif
 658   9                            ;
 659   9                        else
 660   9                        {
 661  10      #ifdef __LOCK_AUDIO_SUPPORT__
 662  10                          mmi_dq_aud_play_with_id(AUD_ID_ADD_PWD_SUCESS);
 663  10      #endif
 664  10      #ifdef __LOCK_WIFI_SUPPORT__
 665  10                          mmi_dq_wifi_add_password(get_index);
 666  10      #endif
 667  10                          // printfV("get_index", (int)get_index);
 668  10                        }
C51 COMPILER V9.59.0.0   MMI_MS                                                            04/19/2021 17:37:53 PAGE 12  

 669   9      #ifdef __LOCK_WIFI_SUPPORT__
 670   9                        if (wifi_add_flag != 0)
 671   9                        {
 672  10                          wifi_add_flag = 0;
 673  10                          mmi_dq_ms_set_sys_state(SYS_STATUS_IDLE);
 674  10                        }
 675   9                        else
 676   9      #endif
 677   9                          mmi_dq_sys_add_pwd_con();
 678   9                      }
 679   8                      else if (status == SYS_STATUS_ADD_ADMIN_PWD)
 680   8                      {
 681   9                        if (mmi_dq_fs_set_pwd(input_key_1, key_len, FDS_USE_TYPE_ADMIN) == RET_FAIL)
 682   9      #ifdef __LOCK_AUDIO_SUPPORT__
 683   9                          mmi_dq_aud_play_with_id(AUD_ID_ADD_FAIL)
 684   9      #endif
 685   9                            ;
 686   9                        else
 687   9                        {
 688  10      #ifdef __LOCK_AUDIO_SUPPORT__
 689  10                          mmi_dq_aud_play_with_id(AUD_ID_ADD_ADMIN_PWD_INIT_SUCESS);
 690  10      #endif
 691  10      #ifdef __LOCK_WIFI_SUPPORT__
 692  10                          mmi_dq_wifi_add_password(get_index);
 693  10      #endif
 694  10                          // printfV("get_index", (int)get_index);
 695  10                        }
 696   9      #ifdef __LOCK_FP_SUPPORT__
 697   9                        mmi_dq_sys_chg_admin_fp_No1();
 698   9      #else
                                if (0 == mmi_dq_fs_get_admin_status())
                                  mmi_dq_sys_lock_add_admin_suc();
                                else
                                  mmi_dq_sys_show_cur_menu_list();
              #endif
 704   9                      }
 705   8                      else if (status == SYS_STATUS_CHG_ADMIN_PWD)
 706   8                      {
 707   9                        if (mmi_dq_fs_set_pwd(input_key_1, key_len, FDS_USE_TYPE_ADMIN) == RET_FAIL)
 708   9      #ifdef __LOCK_AUDIO_SUPPORT__
 709   9                          mmi_dq_aud_play_with_id(AUD_ID_ADD_FAIL)
 710   9      #endif
 711   9                            ;
 712   9                        else
 713   9                        {
 714  10      #ifdef __LOCK_AUDIO_SUPPORT__
 715  10                          mmi_dq_aud_play_with_id(AUD_ID_CHG_ADMIN_PWD_SUCESS);
 716  10      #endif
 717  10      #ifdef __LOCK_WIFI_SUPPORT__
 718  10                          mmi_dq_wifi_add_password(get_index);
 719  10      #endif
 720  10                          // printfV("get_index", (int)get_index);
 721  10                        }
 722   9                        mmi_dq_sys_show_cur_menu_list();
 723   9                      }
 724   8      #ifdef __LOCK_110_SUPPORT__
 725   8                      else if (status == SYS_STATUS_ADD_110_PWD)
 726   8                      {
 727   9                        if (mmi_dq_fs_set_pwd(input_key_1, key_len, FDS_USE_TYPE_110) == RET_FAIL)
 728   9      #ifdef __LOCK_AUDIO_SUPPORT__
 729   9                          mmi_dq_aud_play_with_id(AUD_ID_ADD_FAIL)
 730   9      #endif
C51 COMPILER V9.59.0.0   MMI_MS                                                            04/19/2021 17:37:53 PAGE 13  

 731   9                            ;
 732   9                        else
 733   9                        {
 734  10      #ifdef __LOCK_WIFI_SUPPORT__
 735  10                          mmi_dq_wifi_set_110();
 736  10      #endif
 737  10      #ifdef __LOCK_AUDIO_SUPPORT__
 738  10                          mmi_dq_aud_play_with_id(AUD_ID_ADD_PWD_SUCESS);
 739  10      #endif
 740  10      #ifdef __LOCK_WIFI_SUPPORT__
 741  10                          mmi_dq_wifi_add_password(get_index);
 742  10      #endif
 743  10                          // printfV("get_index", (int)get_index);
 744  10                        }
 745   9                        mmi_dq_sys_show_cur_menu_list();
 746   9                      }
 747   8      #endif
 748   8                    }
 749   7                  }
 750   6                  else
 751   6                  {
 752   7      #ifdef __LOCK_AUDIO_SUPPORT__
 753   7                    mmi_dq_aud_play_with_id(AUD_ID_PWD_NOT_SAME_RETRY);
 754   7      #endif
 755   7                  }
 756   6                  mmi_ms_pwd_init_var();
 757   6                }
 758   5              }
 759   4            }
 760   3            return;
 761   3          }
 762   2          break;
 763   2      #ifdef __LOCK_FP_SUPPORT__
 764   2        case SYS_STATUS_ADD_FP:
 765   2        case SYS_STATUS_DEL_FP:
 766   2      #ifdef __LOCK_110_SUPPORT__
 767   2        case SYS_STATUS_ADD_110_FP:
 768   2        case SYS_STATUS_DEL_110_FP:
 769   2      #endif
 770   2      #endif
 771   2      #ifdef __LOCK_RFID_CARD_SUPPORT__
 772   2        case SYS_STATUS_ADD_RFID:
 773   2        case SYS_STATUS_DEL_RFID:
 774   2      #endif
 775   2          if (key_val == KEY_S)
 776   2          {
 777   3      #ifdef __LOCK_AUDIO_SUPPORT__
 778   3            mmi_dq_aud_play_key_tone();
 779   3      #endif
 780   3      #ifdef __LOCK_WIFI_SUPPORT__
 781   3            if (wifi_add_flag != 0)
 782   3            {
 783   4              wifi_add_flag = 0;
 784   4              mmi_dq_ms_set_sys_state(SYS_STATUS_IDLE);
 785   4            }
 786   3            else
 787   3      #endif
 788   3              mmi_dq_sys_show_cur_menu_list();
 789   3          }
 790   2          break;
 791   2      #ifdef __LOCK_FP_SUPPORT__
 792   2        case SYS_STATUS_ADD_ADMIN_FP1:
C51 COMPILER V9.59.0.0   MMI_MS                                                            04/19/2021 17:37:53 PAGE 14  

 793   2        case SYS_STATUS_ADD_ADMIN_FP2:
 794   2          if (key_val == KEY_S)
 795   2          {
 796   3      #ifdef __LOCK_AUDIO_SUPPORT__
 797   3            mmi_dq_aud_play_key_tone();
 798   3      #endif
 799   3            if (0 == mmi_dq_fs_get_admin_status())
 800   3              mmi_dq_sys_lock_add_admin_suc();
 801   3            else
 802   3              mmi_dq_sys_show_cur_menu_list();
 803   3          }
 804   2          break;
 805   2      #endif
 806   2        case SYS_STATUS_CLR_PWD:
 807   2        case SYS_STATUS_ADD_PWD_CON:
 808   2        case SYS_STATUS_DEL_PWD_CON:
 809   2      #ifdef __LOCK_FP_SUPPORT__
 810   2        case SYS_STATUS_CLR_FP:
 811   2        case SYS_STATUS_ADD_FP_CON:
 812   2        case SYS_STATUS_DEL_FP_CON:
 813   2      #endif
 814   2      #ifdef __LOCK_RFID_CARD_SUPPORT__
 815   2        case SYS_STATUS_CLR_RFID:
 816   2        case SYS_STATUS_ADD_RFID_CON:
 817   2        case SYS_STATUS_DEL_RFID_CON:
 818   2      #endif
 819   2        case SYS_STATUS_RESTORE_LOCK_CON:
 820   2          if (key_val == KEY_H)
 821   2          {
 822   3      #ifdef __LOCK_AUDIO_SUPPORT__
 823   3            mmi_dq_aud_play_key_tone();
 824   3      #endif
 825   3            switch (status)
 826   3            {
 827   4            case SYS_STATUS_CLR_PWD:
 828   4              if (RET_SUCESS == mmi_dq_fs_clr_pwd())
 829   4              {
 830   5      #ifdef __LOCK_AUDIO_SUPPORT__
 831   5                mmi_dq_aud_play_with_id(AUD_ID_CLR_PWD_SUCESS)
 832   5      #endif
 833   5                  ;
 834   5      #ifdef __LOCK_WIFI_SUPPORT__
 835   5                mmi_dq_wifi_clr_pwd_suc();
 836   5      #endif
 837   5              }
 838   4              else
 839   4      #ifdef __LOCK_AUDIO_SUPPORT__
 840   4                mmi_dq_aud_play_with_id(AUD_ID_CLR_PWD_FAIL)
 841   4      #endif
 842   4                  ;
 843   4              mmi_dq_sys_show_cur_menu_list();
 844   4              break;
 845   4      #ifdef __LOCK_FP_SUPPORT__
 846   4            case SYS_STATUS_CLR_FP:
 847   4              if (RET_SUCESS == mmi_dq_fs_clr_fp())
 848   4              {
 849   5      #ifdef __LOCK_AUDIO_SUPPORT__
 850   5                mmi_dq_aud_play_with_id(AUD_ID_CLR_FP_SUCESS);
 851   5      #endif
 852   5      #ifdef __LOCK_WIFI_SUPPORT__
 853   5                mmi_dq_wifi_clr_fps_suc();
 854   5      #endif
C51 COMPILER V9.59.0.0   MMI_MS                                                            04/19/2021 17:37:53 PAGE 15  

 855   5              }
 856   4              else
 857   4      #ifdef __LOCK_AUDIO_SUPPORT__
 858   4                mmi_dq_aud_play_with_id(AUD_ID_CLR_FP_FAIL)
 859   4      #endif
 860   4                  ;
 861   4              mmi_dq_sys_show_cur_menu_list();
 862   4              break;
 863   4      #endif
 864   4      #ifdef __LOCK_RFID_CARD_SUPPORT__
 865   4            case SYS_STATUS_CLR_RFID:
 866   4              if (RET_SUCESS == mmi_dq_fs_clr_rfid())
 867   4              {
 868   5      #ifdef __LOCK_AUDIO_SUPPORT__
 869   5                mmi_dq_aud_play_with_id(AUD_ID_CLR_RFCARD_SUCESS);
 870   5      #endif
 871   5      #ifdef __LOCK_WIFI_SUPPORT__
 872   5                mmi_dq_wifi_clr_rfid_suc();
 873   5      #endif
 874   5              }
 875   4              else
 876   4      #ifdef __LOCK_AUDIO_SUPPORT__
 877   4                mmi_dq_aud_play_with_id(AUD_ID_CLR_RFCARD_FAIL)
 878   4      #endif
 879   4                  ;
 880   4              mmi_dq_sys_show_cur_menu_list();
 881   4              break;
 882   4      #endif
 883   4            case SYS_STATUS_ADD_PWD_CON:
 884   4              mmi_dq_sys_add_pwd();
 885   4              break;
 886   4            case SYS_STATUS_DEL_PWD_CON:
 887   4              mmi_dq_sys_del_pwd();
 888   4              break;
 889   4      #ifdef __LOCK_FP_SUPPORT__
 890   4            case SYS_STATUS_ADD_FP_CON:
 891   4              mmi_dq_sys_add_fp();
 892   4              break;
 893   4            case SYS_STATUS_DEL_FP_CON:
 894   4              mmi_dq_sys_del_fp();
 895   4              break;
 896   4      #endif
 897   4      #ifdef __LOCK_RFID_CARD_SUPPORT__
 898   4            case SYS_STATUS_ADD_RFID_CON:
 899   4              mmi_dq_sys_add_rf();
 900   4              break;
 901   4            case SYS_STATUS_DEL_RFID_CON:
 902   4              mmi_dq_sys_del_rf();
 903   4              break;
 904   4      #endif
 905   4            case SYS_STATUS_RESTORE_LOCK_CON:
 906   4              mmi_dq_sys_restore_lock();
 907   4              break;
 908   4            }
 909   3          }
 910   2          else if (key_val == KEY_S)
 911   2          {
 912   3      #ifdef __LOCK_AUDIO_SUPPORT__
 913   3            mmi_dq_aud_play_key_tone();
 914   3      #endif
 915   3            mmi_dq_sys_show_cur_menu_list();
 916   3          }
C51 COMPILER V9.59.0.0   MMI_MS                                                            04/19/2021 17:37:53 PAGE 16  

 917   2          break;
 918   2        case SYS_STATUS_SYS_MENU:
 919   2          if (key_val == KEY_S)
 920   2          {
 921   3      #ifdef __LOCK_AUDIO_SUPPORT__
 922   3            mmi_dq_aud_play_key_tone();
 923   3      #endif
 924   3            mmi_dq_sys_get_pre_menu_list();
 925   3          }
 926   2          else if (key_val != KEY_0 && key_val <= mmi_dq_sys_get_menu_count())
 927   2          {
 928   3      #ifdef __LOCK_AUDIO_SUPPORT__
 929   3            mmi_dq_aud_play_key_tone();
 930   3      #endif
 931   3            mmi_dq_sys_exe_menu_fun(key_val - 1);
 932   3          }
 933   2          break;
 934   2      #ifdef __FACTORY_TEST_SUPPORT__
 935   2        case SYS_STATUS_FM_MODE:
 936   2        {
 937   3          unsigned char str = mmi_dq_factory_mode_get_test_project();
 938   3          if (str == STR_ID_KEY)
 939   3          {
 940   4      #ifdef __LOCK_AUDIO_SUPPORT__
 941   4            // mmi_dq_aud_play_key_num(key_val);
 942   4            mmi_dq_aud_play_key_tone();
 943   4      #endif
 944   4            mmi_dq_factory_mode_key_test(key_val);
 945   4          }
 946   3          else if (str == STR_ID_MOTO)
 947   3          {
 948   4            if (key_val == KEY_S)
 949   4            {
 950   5      #ifdef __LOCK_AUDIO_SUPPORT__
 951   5              mmi_dq_aud_play_key_tone();
 952   5      #endif
 953   5      #ifdef __LOCK_MOTOR_SUPPORT__
 954   5              mmi_dq_factory_mode_motor_test_back();
 955   5      #endif
 956   5              if (mmi_dq_fs_get_factory_flag() != 0)
 957   5                mmi_dq_factory_mode_test_stop();
 958   5              else
 959   5              {
 960   6      #ifdef __LOCK_MOTOR_SUPPORT__
 961   6                delay_ms(600);
 962   6                mmi_dq_factory_mode_motor_test();
 963   6      #endif
 964   6              }
 965   5            }
 966   4            else if (key_val == KEY_H)
 967   4            {
 968   5      #ifdef __LOCK_AUDIO_SUPPORT__
 969   5              mmi_dq_aud_play_key_tone();
 970   5      #endif
 971   5      #ifdef __LOCK_MOTOR_SUPPORT__
 972   5              mmi_dq_factory_mode_motor_test_back();
 973   5      #endif
 974   5              mmi_dq_factory_mode_test_item_result(STR_ID_MOTO, 1);
 975   5            }
 976   4          }
 977   3          else if (mmi_dq_fs_get_factory_flag() != 0)
 978   3          {
C51 COMPILER V9.59.0.0   MMI_MS                                                            04/19/2021 17:37:53 PAGE 17  

 979   4      #ifdef __LOCK_AUDIO_SUPPORT__
 980   4            mmi_dq_aud_play_key_tone();
 981   4      #endif
 982   4            mmi_dq_factory_mode_test_stop();
 983   4          }
 984   3        }
 985   2        break;
 986   2      #endif
 987   2      #ifdef __LOCK_WIFI_SUPPORT__
 988   2        case SYS_STATUS_WIFI_MODE:
 989   2          //if(key_val == KEY_S)
 990   2          //{
 991   2      #ifdef __LOCK_AUDIO_SUPPORT__
 992   2          mmi_dq_aud_stop();
 993   2      #endif
 994   2      #ifdef __LOCK_AUDIO_SUPPORT__
 995   2          mmi_dq_aud_play_with_id(AUD_ID_WIFI_CONNECTING);
 996   2      #endif
 997   2          //  mmi_dq_ms_set_sys_state(SYS_STATUS_IDLE);
 998   2          //}
 999   2          break;
1000   2      #endif
1001   2        case SYS_STATUS_LOW_POWER:
1002   2      #ifdef __LOCK_AUDIO_SUPPORT__
1003   2          mmi_dq_aud_stop();
1004   2      #endif
1005   2      #ifdef __LOCK_AUDIO_SUPPORT__
1006   2          mmi_dq_aud_play_with_id(AUD_ID_LOW_BATTERY);
1007   2      #endif
1008   2      #ifdef __LOCK_WIFI_SUPPORT__
1009   2          mmi_dq_wifi_lowpower_alarm();
1010   2      #endif
1011   2          break;
1012   2        default:
1013   2          break;
1014   2        }
1015   1        return;
1016   1      }
1017          
1018          #ifdef __LOCK_FP_SUPPORT__
1019          /*
1020          parameter: 
1021            none
1022          return :
1023            none
1024          */
1025          void mmi_ms_fps_opt_fun(unsigned char fps_val)
1026          {
1027   1        RET_VAL retval = 0;
1028   1        unsigned short index = 0;
1029   1        SYS_BASE_STATUS status = mmi_dq_ms_get_sys_state();
1030   1        if (status == SYS_STATUS_LOW_POWER)
1031   1        {
1032   2      #ifdef __LOCK_AUDIO_SUPPORT__
1033   2          mmi_dq_aud_stop();
1034   2      #endif
1035   2      #ifdef __LOCK_AUDIO_SUPPORT__
1036   2          mmi_dq_aud_play_with_id(AUD_ID_LOW_BATTERY);
1037   2      #endif
1038   2      #ifdef __LOCK_WIFI_SUPPORT__
1039   2          mmi_dq_wifi_lowpower_alarm();
1040   2      #endif
C51 COMPILER V9.59.0.0   MMI_MS                                                            04/19/2021 17:37:53 PAGE 18  

1041   2          return;
1042   2        }
1043   1        else if (status == SYS_STATUS_WAIT_FOR_ENTER_SLEEP)
1044   1          mmi_dq_ms_set_sys_state(SYS_STATUS_IDLE);
1045   1      
1046   1        if ((status != SYS_STATUS_INPUT_FP && status != SYS_STATUS_ADD_FP && status != SYS_STATUS_DEL_FP && statu
             -s != SYS_STATUS_ADD_ADMIN_FP1 && status != SYS_STATUS_ADD_ADMIN_FP2 && status != SYS_STATUS_ADD_110_FP && status != SYS_
             -STATUS_DEL_110_FP)
1047   1      #ifdef __FACTORY_TEST_SUPPORT__
1048   1          || (status == SYS_STATUS_FM_MODE && STR_ID_FINGERPRINT != mmi_dq_factory_mode_get_test_project())
1049   1      #endif
1050   1        )
1051   1          return;
1052   1      
1053   1      #ifdef __LOCK_AUDIO_SUPPORT__
1054   1        mmi_dq_aud_stop();
1055   1      #endif
1056   1        if (mmi_dq_sys_door_state_check() == 1)
1057   1        {
1058   2      #ifdef __LOCK_AUDIO_SUPPORT__
1059   2          mmi_dq_aud_stop();
1060   2      #endif
1061   2      #ifdef __LOCK_AUDIO_SUPPORT__
1062   2          mmi_dq_aud_play_with_id(AUD_ID_RONG_TIMES_EXCEED);
1063   2      #endif
1064   2      #ifdef __LOCK_WIFI_SUPPORT__
1065   2          mmi_dq_wifi_fp_alarm();
1066   2      #endif
1067   2          return;
1068   2        }
1069   1      
1070   1        retval = mmi_dq_fp_get_image();
1071   1      
1072   1        if (retval == 0)
1073   1        {
1074   2          // printfS("mmi_dq_fp_get_image", "ok");
1075   2          // if (opt_time != 0)
1076   2          //  retval = mmi_dq_fp_gen_char(0);
1077   2          // if (retval == 0)
1078   2          retval = mmi_dq_fp_gen_char(opt_time);
1079   2          if (retval == 0)
1080   2          {
1081   3            // printfS("mmi_dq_fp_gen_char", "ok");
1082   3            retval = mmi_dq_fp_high_speed_search(opt_time, &index);
1083   3            if (retval == 0)
1084   3            {
1085   4              // printfS("mmi_dq_fp_high_speed_search", "ok");
1086   4              if (status == SYS_STATUS_INPUT_FP)
1087   4              {
1088   5                retval = mmi_dq_fs_check_fp((unsigned char)index, FDS_USE_TYPE_ALL);
1089   5                if (retval == RET_SUCESS)
1090   5                {
1091   6                  get_index = index;
1092   6                  mmi_dq_fp_light(FP_GREEN);
1093   6      #ifdef __LOCK_110_SUPPORT__
1094   6                  if (mmi_dq_fs_check_fp((unsigned char)index, FDS_USE_TYPE_110) == RET_SUCESS)
1095   6                  {
1096   7                    mmi_dq_sys_door_open(SYS_OPEN_BY_110_FP);
1097   7                  }
1098   6                  else
1099   6      #endif
1100   6                    mmi_dq_sys_door_open(SYS_OPEN_BY_FP);
C51 COMPILER V9.59.0.0   MMI_MS                                                            04/19/2021 17:37:53 PAGE 19  

1101   6                }
1102   5                else
1103   5                {
1104   6                  mmi_dq_fp_light(FP_RED);
1105   6                  mmi_dq_sys_door_open_fail(SYS_OPEN_BY_FP);
1106   6                }
1107   5              }
1108   4              else if (status == SYS_STATUS_ADD_FP || status == SYS_STATUS_ADD_ADMIN_FP1 || status == SYS_STATUS_ADD
             -_ADMIN_FP2 || status == SYS_STATUS_ADD_110_FP || status == SYS_STATUS_FM_MODE)
1109   4              {
1110   5                mmi_dq_fp_light(FP_RED);
1111   5      #ifdef __LOCK_AUDIO_SUPPORT__
1112   5                mmi_dq_aud_play_with_id(AUD_ID_FP_EXIST);
1113   5      #endif
1114   5              }
1115   4              else if (status == SYS_STATUS_DEL_FP || status == SYS_STATUS_DEL_110_FP)
1116   4              {
1117   5      #ifdef __LOCK_110_SUPPORT__
1118   5                if (status == SYS_STATUS_DEL_FP)
1119   5                  retval = mmi_dq_fs_check_fp((unsigned char)index, FDS_USE_TYPE_USER);
1120   5                else if (status == SYS_STATUS_DEL_110_FP)
1121   5                  retval = mmi_dq_fs_check_fp((unsigned char)index, FDS_USE_TYPE_110);
1122   5      #else
                        retval = mmi_dq_fs_check_fp((unsigned char)index, FDS_USE_TYPE_USER);
              #endif
1125   5                if (retval == RET_SUCESS)
1126   5                {
1127   6                  static unsigned char del_num = 0;
1128   6                  if (opt_time == OPT_ONE_TIME)
1129   6                  {
1130   7                    opt_time = OPT_TWO_TIME;
1131   7                    del_num = index;
1132   7                    mmi_dq_fp_light(FP_GREEN);
1133   7      #ifdef __LOCK_AUDIO_SUPPORT__
1134   7                    mmi_dq_aud_play_with_id(AUD_ID_PRESS_DEL_FP_AGAIN);
1135   7      #endif
1136   7                  }
1137   6                  else
1138   6                  {
1139   7                    //retval = mmi_dq_fp_match();
1140   7                    if (del_num == index)
1141   7                      retval = 0;
1142   7                    else
1143   7                      retval = 255;
1144   7                    if (retval == 0) //|| retval == 255)
1145   7                    {
1146   8      #ifdef __LOCK_110_SUPPORT__
1147   8                      if (status == SYS_STATUS_DEL_FP)
1148   8                        retval = mmi_dq_fs_del_fp((unsigned char)index, FDS_USE_TYPE_USER);
1149   8                      else if (status == SYS_STATUS_DEL_110_FP)
1150   8                        retval = mmi_dq_fs_del_fp((unsigned char)index, FDS_USE_TYPE_110);
1151   8      #else
                              retval = mmi_dq_fs_del_fp((unsigned char)index, FDS_USE_TYPE_USER);
              #endif
1154   8                      if (retval == RET_SUCESS)
1155   8                      {
1156   9                        retval = mmi_dq_fp_delete(index);
1157   9                      }
1158   8                      if (retval == 0)
1159   8                      {
1160   9                        mmi_dq_fp_light(FP_GREEN);
1161   9      #ifdef __LOCK_AUDIO_SUPPORT__
C51 COMPILER V9.59.0.0   MMI_MS                                                            04/19/2021 17:37:53 PAGE 20  

1162   9                        mmi_dq_aud_play_with_id(AUD_ID_DEL_FP_SUCESS);
1163   9      #endif
1164   9      #ifdef __LOCK_WIFI_SUPPORT__
1165   9                        mmi_dq_wifi_del_fp(index);
1166   9      #endif
1167   9                      }
1168   8                      else
1169   8                      {
1170   9                        mmi_dq_fp_light(FP_RED);
1171   9      #ifdef __LOCK_AUDIO_SUPPORT__
1172   9                        mmi_dq_aud_play_with_id(AUD_ID_DEL_FAIL);
1173   9      #endif
1174   9                      }
1175   8      #ifdef __LOCK_110_SUPPORT__
1176   8                      if (status == SYS_STATUS_DEL_FP)
1177   8                        mmi_dq_sys_del_fp_con();
1178   8                      else if (status == SYS_STATUS_DEL_110_FP)
1179   8                        mmi_dq_sys_show_cur_menu_list();
1180   8      #else
                              mmi_dq_sys_del_fp_con();
              #endif
1183   8                    }
1184   7                    else
1185   7                    {
1186   8                      mmi_dq_fp_light(FP_RED);
1187   8      #ifdef __LOCK_AUDIO_SUPPORT__
1188   8                      mmi_dq_aud_play_with_id(AUD_ID_FP_TWICE_NOT_SAME_RETRY);
1189   8      #endif
1190   8                    }
1191   7                    opt_time = OPT_ONE_TIME;
1192   7                  }
1193   6                }
1194   5                else
1195   5                {
1196   6                  mmi_dq_fp_light(FP_RED);
1197   6      #ifdef __LOCK_AUDIO_SUPPORT__
1198   6                  mmi_dq_aud_play_with_id(AUD_ID_FP_NOT_EXIST);
1199   6      #endif
1200   6                }
1201   5              }
1202   4            }
1203   3            else
1204   3            {
1205   4              // printfS("mmi_dq_fp_high_speed_search", "error");
1206   4              if (status == SYS_STATUS_INPUT_FP)
1207   4              {
1208   5                mmi_dq_fp_light(FP_RED);
1209   5      #ifdef __LOCK_AUDIO_SUPPORT__
1210   5                // mmi_dq_aud_play_with_id(AUD_ID_FP_WRONG_TRY);
1211   5      #endif
1212   5                mmi_dq_sys_door_open_fail(SYS_OPEN_BY_FP);
1213   5              }
1214   4              else if (status == SYS_STATUS_ADD_FP || status == SYS_STATUS_ADD_ADMIN_FP1 || status == SYS_STATUS_ADD
             -_ADMIN_FP2 || status == SYS_STATUS_ADD_110_FP || status == SYS_STATUS_FM_MODE)
1215   4              {
1216   5                if (opt_time == FPS_MAX_INPUT_TIME)
1217   5                {
1218   6                  retval = mmi_dq_fp_reg_module();
1219   6                  if (retval == 0)
1220   6                  {
1221   7                    // printfS("mmi_dq_fp_reg_module", "ok");
1222   7                    if (status == SYS_STATUS_ADD_FP || status == SYS_STATUS_ADD_110_FP || status == SYS_STATUS_FM_MODE)
C51 COMPILER V9.59.0.0   MMI_MS                                                            04/19/2021 17:37:53 PAGE 21  

1223   7                    {
1224   8      #ifdef __LOCK_110_SUPPORT__
1225   8                      if (status == SYS_STATUS_ADD_110_FP)
1226   8                        index = mmi_dq_fs_get_fp_110_unuse_index();
1227   8                      else
1228   8      #endif
1229   8                        index = mmi_dq_fs_get_fp_unuse_index();
1230   8                      if (index == 0xFF)
1231   8                      {
1232   9                        // printfS("mmi_dq_fs_get_fp_unuse_index", "error");
1233   9                        mmi_dq_fp_light(FP_RED);
1234   9      #ifdef __LOCK_AUDIO_SUPPORT__
1235   9                        mmi_dq_aud_play_with_id(AUD_ID_FP_FULL);
1236   9      #endif
1237   9                        mmi_dq_sys_show_cur_menu_list();
1238   9                      }
1239   8                      else
1240   8                      {
1241   9                        // printfS("mmi_dq_fs_get_fp_unuse_index", "ok");
1242   9                        // printfV("index", (int)index);
1243   9                        retval = mmi_dq_fp_store_char(0, index);
1244   9                        if (status == SYS_STATUS_ADD_FP)
1245   9                        {
1246  10                          if (retval == 0)
1247  10                          {
1248  11                            // printfS("mmi_dq_fp_store_char", "ok");
1249  11                            retval = mmi_dq_fs_set_fp((unsigned char)index, FDS_USE_TYPE_USER);
1250  11                            if (retval != 0)
1251  11                              mmi_dq_fp_delete(index);
1252  11                          }
1253  10                          if (retval == 0)
1254  10                          {
1255  11                            // printfS("mmi_dq_fs_set_fp", "ok");
1256  11                            mmi_dq_fp_light(FP_GREEN);
1257  11      #ifdef __LOCK_AUDIO_SUPPORT__
1258  11                            mmi_dq_aud_play_with_id(AUD_ID_ADD_FP_SUCESS);
1259  11      #endif
1260  11      #ifdef __LOCK_WIFI_SUPPORT__
1261  11                            mmi_dq_wifi_add_fp(index);
1262  11      #endif
1263  11                          }
1264  10                          else
1265  10                          {
1266  11                            // printfS("mmi_dq_fp_store_char", "error");
1267  11                            mmi_dq_fp_light(FP_RED);
1268  11      #ifdef __LOCK_AUDIO_SUPPORT__
1269  11                            mmi_dq_aud_play_with_id(AUD_ID_ADD_FAIL);
1270  11      #endif
1271  11                          }
1272  10      #ifdef __LOCK_WIFI_SUPPORT__
1273  10                          if (wifi_add_flag != 0)
1274  10                          {
1275  11                            wifi_add_flag = 0;
1276  11                            mmi_dq_ms_set_sys_state(SYS_STATUS_IDLE);
1277  11                          }
1278  10                          else
1279  10      #endif
1280  10                            mmi_dq_sys_add_fp_con();
1281  10                        }
1282   9      #ifdef __LOCK_110_SUPPORT__
1283   9                        else if (status == SYS_STATUS_ADD_110_FP)
1284   9                        {
C51 COMPILER V9.59.0.0   MMI_MS                                                            04/19/2021 17:37:53 PAGE 22  

1285  10                          if (retval == 0)
1286  10                          {
1287  11                            retval = mmi_dq_fs_set_fp((unsigned char)index, FDS_USE_TYPE_110);
1288  11                            if (retval != 0)
1289  11                              mmi_dq_fp_delete(index);
1290  11                          }
1291  10                          if (retval == 0)
1292  10                          {
1293  11                            mmi_dq_fp_light(FP_GREEN);
1294  11      #ifdef __LOCK_AUDIO_SUPPORT__
1295  11                            mmi_dq_aud_play_with_id(AUD_ID_ADD_FP_SUCESS);
1296  11      #endif
1297  11      #ifdef __LOCK_WIFI_SUPPORT__
1298  11                            mmi_dq_wifi_set_110();
1299  11                            mmi_dq_wifi_add_fp(index);
1300  11      #endif
1301  11                          }
1302  10                          else
1303  10                          {
1304  11                            mmi_dq_fp_light(FP_RED);
1305  11      #ifdef __LOCK_AUDIO_SUPPORT__
1306  11                            mmi_dq_aud_play_with_id(AUD_ID_ADD_FAIL);
1307  11      #endif
1308  11                          }
1309  10                          mmi_dq_sys_show_cur_menu_list();
1310  10                        }
1311   9      #endif
1312   9      #ifdef __FACTORY_TEST_SUPPORT__
1313   9                        else
1314   9                        {
1315  10                          if (retval == 0)
1316  10                          {
1317  11                            retval = mmi_dq_fp_delete(index);
1318  11                          }
1319  10                          if (retval == 0)
1320  10                          {
1321  11                            mmi_dq_fp_light(FP_GREEN);
1322  11                            mmi_dq_factory_mode_test_item_result(STR_ID_FINGERPRINT, 1);
1323  11                          }
1324  10                          else
1325  10                          {
1326  11                            mmi_dq_fp_light(FP_RED);
1327  11                            mmi_dq_factory_mode_test_item_result(STR_ID_FINGERPRINT, 0);
1328  11                          }
1329  10                        }
1330   9      #endif
1331   9                      }
1332   8                    }
1333   7                    else
1334   7                    {
1335   8                      if (status == SYS_STATUS_ADD_ADMIN_FP1)
1336   8                        index = 0;
1337   8                      else if (status == SYS_STATUS_ADD_ADMIN_FP2)
1338   8                        index = 1;
1339   8                      retval = mmi_dq_fp_delete(index);
1340   8                      if (retval == 0)
1341   8                        retval = mmi_dq_fp_store_char(0, index);
1342   8                      if (retval == 0)
1343   8                        retval = mmi_dq_fs_set_fp((unsigned char)index, FDS_USE_TYPE_ADMIN);
1344   8                      if (retval == 0)
1345   8                      {
1346   9                        mmi_dq_fp_light(FP_GREEN);
C51 COMPILER V9.59.0.0   MMI_MS                                                            04/19/2021 17:37:53 PAGE 23  

1347   9      #ifdef __LOCK_AUDIO_SUPPORT__
1348   9                        mmi_dq_aud_play_with_id(AUD_ID_ADD_FP_SUCESS);
1349   9      #endif
1350   9      #ifdef __LOCK_WIFI_SUPPORT__
1351   9                        mmi_dq_wifi_add_fp(index);
1352   9      #endif
1353   9                      }
1354   8                      else
1355   8                      {
1356   9                        mmi_dq_fp_light(FP_RED);
1357   9      #ifdef __LOCK_AUDIO_SUPPORT__
1358   9                        mmi_dq_aud_play_with_id(AUD_ID_ADD_FAIL);
1359   9      #endif
1360   9                      }
1361   8                      if (0 == mmi_dq_fs_get_admin_status())
1362   8                      {
1363   9                        if (status == SYS_STATUS_ADD_ADMIN_FP1)
1364   9                          mmi_dq_sys_chg_admin_fp_No2();
1365   9                        else
1366   9                          mmi_dq_sys_lock_add_admin_suc();
1367   9                      }
1368   8                      else
1369   8                        mmi_dq_sys_show_cur_menu_list();
1370   8                    }
1371   7                  }
1372   6                  else
1373   6                  {
1374   7                    mmi_dq_fp_light(FP_RED);
1375   7      #ifdef __LOCK_AUDIO_SUPPORT__
1376   7                    mmi_dq_aud_play_with_id(AUD_ID_ADD_FAIL_RETRY);
1377   7      #endif
1378   7                  }
1379   6                  opt_time = OPT_ONE_TIME;
1380   6                }
1381   5                else
1382   5                {
1383   6                  opt_time++;
1384   6                  mmi_dq_fp_light(FP_GREEN);
1385   6      #ifdef __LOCK_AUDIO_SUPPORT__
1386   6                  mmi_dq_aud_play_with_id(AUD_ID_PRESS_FP_AGAIN);
1387   6      #endif
1388   6                }
1389   5              }
1390   4              else if (status == SYS_STATUS_DEL_FP)
1391   4              {
1392   5                mmi_dq_fp_light(FP_RED);
1393   5      #ifdef __LOCK_AUDIO_SUPPORT__
1394   5                mmi_dq_aud_play_with_id(AUD_ID_FP_NOT_EXIST);
1395   5      #endif
1396   5              }
1397   4            }
1398   3            return;
1399   3          }
1400   2        }
1401   1        // printfS("mmi_dq_fp_get_image", "error");
1402   1      
1403   1        mmi_dq_fp_light(FP_RED);
1404   1      #ifdef __LOCK_AUDIO_SUPPORT__
1405   1        mmi_dq_aud_play_with_id(AUD_ID_PRESS_FP_AGAIN);
1406   1      #endif
1407   1        return;
1408   1      }
C51 COMPILER V9.59.0.0   MMI_MS                                                            04/19/2021 17:37:53 PAGE 24  

*** WARNING C280 IN LINE 1025 OF mmi_src\mmi_ms.c: 'fps_val': unreferenced local variable
1409          #endif
1410          
1411          #ifdef __LOCK_RFID_CARD_SUPPORT__
1412          /*
1413          parameter: 
1414            none
1415          return :
1416            none
1417          */
1418          void mmi_ms_rfid_opt_fun(unsigned char rfid_val)
1419          {
1420   1        RET_VAL retval = RET_SUCESS;
1421   1        unsigned char index = 0;
1422   1        SYS_BASE_STATUS status = mmi_dq_ms_get_sys_state();
1423   1      
1424   1        if (status == SYS_STATUS_LOW_POWER)
1425   1        {
1426   2      #ifdef __LOCK_AUDIO_SUPPORT__
1427   2          mmi_dq_aud_stop();
1428   2      #endif
1429   2      #ifdef __LOCK_AUDIO_SUPPORT__
1430   2          mmi_dq_aud_play_with_id(AUD_ID_LOW_BATTERY);
1431   2      #endif
1432   2      #ifdef __LOCK_WIFI_SUPPORT__
1433   2          mmi_dq_wifi_lowpower_alarm();
1434   2      #endif
1435   2          return;
1436   2        }
1437   1        else if (status == SYS_STATUS_WAIT_FOR_ENTER_SLEEP)
1438   1          mmi_dq_ms_set_sys_state(SYS_STATUS_IDLE);
1439   1      
1440   1        if ((status != SYS_STATUS_INPUT_RFID && status != SYS_STATUS_ADD_RFID && status != SYS_STATUS_DEL_RFID)
1441   1      #ifdef __FACTORY_TEST_SUPPORT__
1442   1          || (status == SYS_STATUS_FM_MODE && STR_ID_RF_CARD != mmi_dq_factory_mode_get_test_project())
1443   1      #endif
1444   1        )
1445   1          return;
1446   1      
1447   1      #ifdef __LOCK_AUDIO_SUPPORT__
1448   1        mmi_dq_aud_stop();
1449   1      #endif
1450   1      
1451   1        if (mmi_dq_sys_door_state_check() == 1)
1452   1        {
1453   2      #ifdef __LOCK_AUDIO_SUPPORT__
1454   2          mmi_dq_aud_play_with_id(AUD_ID_RONG_TIMES_EXCEED);
1455   2      #endif
1456   2      #ifdef __LOCK_WIFI_SUPPORT__
1457   2          mmi_dq_wifi_rfid_alarm();
1458   2      #endif
1459   2          return;
1460   2        }
1461   1      #ifdef __FACTORY_TEST_SUPPORT__
1462   1        if (status == SYS_STATUS_FM_MODE)
1463   1        {
1464   2          retval = mmi_dq_rfid_gen_char(opt_time);
1465   2          if (retval == RET_SUCESS)
1466   2          {
1467   3            if (opt_time == OPT_ONE_TIME)
1468   3            {
1469   4      #ifdef __LOCK_AUDIO_SUPPORT__
C51 COMPILER V9.59.0.0   MMI_MS                                                            04/19/2021 17:37:53 PAGE 25  

1470   4              mmi_dq_aud_play_with_id(AUD_ID_PRESS_RFCARD_AGAIN);
1471   4      #endif
1472   4              opt_time = OPT_TWO_TIME;
1473   4            }
1474   3            else
1475   3            {
1476   4              retval = mmi_dq_rfid_match();
1477   4              if (retval == RET_SUCESS)
1478   4      
1479   4                mmi_dq_factory_mode_test_item_result(STR_ID_RF_CARD, 1);
1480   4              else
1481   4      #ifdef __LOCK_AUDIO_SUPPORT__
1482   4                mmi_dq_aud_play_with_id(AUD_ID_RFCARD_TWICE_NOT_SAME_RETRY)
1483   4      #endif
1484   4                  ;
1485   4              opt_time = OPT_ONE_TIME;
1486   4            }
1487   3          }
1488   2          return;
1489   2        }
1490   1      #endif
1491   1        retval = mmi_dq_rfid_search_by_temp(&index);
1492   1        if (retval == RET_SUCESS)
1493   1        {
1494   2          if (status == SYS_STATUS_INPUT_RFID)
1495   2          {
1496   3            mmi_dq_sys_door_open(SYS_OPEN_BY_RFID);
1497   3          }
1498   2          else if (status == SYS_STATUS_ADD_RFID)
1499   2          {
1500   3      #ifdef __LOCK_AUDIO_SUPPORT__
1501   3            mmi_dq_aud_play_with_id(AUD_ID_RFCARD_EXIST);
1502   3      #endif
1503   3          }
1504   2          else if (status == SYS_STATUS_DEL_RFID)
1505   2          {
1506   3            retval = mmi_dq_rfid_gen_char(opt_time);
1507   3            if (retval == RET_SUCESS)
1508   3            {
1509   4              if (opt_time == OPT_ONE_TIME)
1510   4              {
1511   5      #ifdef __LOCK_AUDIO_SUPPORT__
1512   5                mmi_dq_aud_play_with_id(AUD_ID_PRESS_DEL_RFCARD_AGAIN);
1513   5      #endif
1514   5                opt_time = OPT_TWO_TIME;
1515   5              }
1516   4              else
1517   4              {
1518   5                retval = mmi_dq_rfid_match();
1519   5                if (retval == RET_SUCESS)
1520   5                {
1521   6                  retval = mmi_dq_fs_del_rfid(index);
1522   6                  if (retval == RET_SUCESS)
1523   6                  {
1524   7                    get_index = index;
1525   7      #ifdef __LOCK_AUDIO_SUPPORT__
1526   7                    mmi_dq_aud_play_with_id(AUD_ID_DEL_RFCARD_SUCESS);
1527   7      #endif
1528   7      #ifdef __LOCK_WIFI_SUPPORT__
1529   7                    mmi_dq_wifi_del_rfid_suc(get_index);
1530   7      #endif
1531   7                    // printfV("get_index", (int)get_index);
C51 COMPILER V9.59.0.0   MMI_MS                                                            04/19/2021 17:37:53 PAGE 26  

1532   7                  }
1533   6                  else
1534   6      #ifdef __LOCK_AUDIO_SUPPORT__
1535   6                    mmi_dq_aud_play_with_id(AUD_ID_DEL_FAIL)
1536   6      #endif
1537   6                      ;
1538   6                  mmi_dq_sys_del_rf_con();
1539   6                }
1540   5                else
1541   5      #ifdef __LOCK_AUDIO_SUPPORT__
1542   5                  mmi_dq_aud_play_with_id(AUD_ID_RFCARD_TWICE_NOT_SAME_RETRY)
1543   5      #endif
1544   5                    ;
1545   5                opt_time = OPT_ONE_TIME;
1546   5              }
1547   4            }
1548   3            else
1549   3      #ifdef __LOCK_AUDIO_SUPPORT__
1550   3              mmi_dq_aud_play_with_id(AUD_ID_DEL_FAIL_RETRY)
1551   3      #endif
1552   3                ;
1553   3          }
1554   2        }
1555   1        else
1556   1        {
1557   2          if (status == SYS_STATUS_ADD_RFID)
1558   2          {
1559   3            retval = mmi_dq_rfid_gen_char(opt_time);
1560   3            if (retval == RET_SUCESS)
1561   3            {
1562   4              if (opt_time == OPT_ONE_TIME)
1563   4              {
1564   5      #ifdef __LOCK_AUDIO_SUPPORT__
1565   5                mmi_dq_aud_play_with_id(AUD_ID_PRESS_RFCARD_AGAIN);
1566   5      #endif
1567   5                opt_time = OPT_TWO_TIME;
1568   5              }
1569   4              else
1570   4              {
1571   5                retval = mmi_dq_rfid_match();
1572   5                if (retval == RET_SUCESS)
1573   5                {
1574   6                  retval = mmi_dq_rfid_store(0);
1575   6                  if (retval == RET_SUCESS)
1576   6                  {
1577   7      #ifdef __LOCK_AUDIO_SUPPORT__
1578   7                    mmi_dq_aud_play_with_id(AUD_ID_ADD_RFCARD_SUCESS);
1579   7      #endif
1580   7      #ifdef __LOCK_WIFI_SUPPORT__
1581   7                    mmi_dq_wifi_add_rfid_suc(get_index);
1582   7      #endif
1583   7                    // printfV("get_index", (int)get_index);
1584   7                  }
1585   6                  else
1586   6      #ifdef __LOCK_AUDIO_SUPPORT__
1587   6                    mmi_dq_aud_play_with_id(AUD_ID_ADD_FAIL)
1588   6      #endif
1589   6                      ;
1590   6      #ifdef __LOCK_WIFI_SUPPORT__
1591   6                  if (wifi_add_flag == 0)
1592   6                  {
1593   7                    wifi_add_flag = 0;
C51 COMPILER V9.59.0.0   MMI_MS                                                            04/19/2021 17:37:53 PAGE 27  

1594   7                    mmi_dq_ms_set_sys_state(SYS_STATUS_IDLE);
1595   7                  }
1596   6                  else
1597   6      #endif
1598   6                    mmi_dq_sys_add_rf_con();
1599   6                }
1600   5                else
1601   5      #ifdef __LOCK_AUDIO_SUPPORT__
1602   5                  mmi_dq_aud_play_with_id(AUD_ID_RFCARD_TWICE_NOT_SAME_RETRY)
1603   5      #endif
1604   5                    ;
1605   5                opt_time = OPT_ONE_TIME;
1606   5              }
1607   4            }
1608   3            else
1609   3      #ifdef __LOCK_AUDIO_SUPPORT__
1610   3              mmi_dq_aud_play_with_id(AUD_ID_ADD_FAIL_RETRY)
1611   3      #endif
1612   3                ;
1613   3          }
1614   2          else if (status == SYS_STATUS_INPUT_RFID)
1615   2            mmi_dq_sys_door_open_fail(SYS_OPEN_BY_RFID);
1616   2          else
1617   2      #ifdef __LOCK_AUDIO_SUPPORT__
1618   2            mmi_dq_aud_play_with_id(AUD_ID_RFCARD_NOT_EXIST)
1619   2      #endif
1620   2              ;
1621   2        }
1622   1      
1623   1        return;
1624   1      }
*** WARNING C280 IN LINE 1418 OF mmi_src\mmi_ms.c: 'rfid_val': unreferenced local variable
1625          #endif
1626          
1627          /*
1628          parameter: 
1629            none
1630          return :
1631            none
1632          */
1633          void mmi_ms_reset_opt_fun(void)
1634          {
1635   1        SYS_BASE_STATUS status = mmi_dq_ms_get_sys_state();
1636   1      
1637   1        if (status == SYS_STATUS_FM_MODE
1638   1      #ifdef __FACTORY_TEST_SUPPORT__
1639   1          && STR_ID_RESET == mmi_dq_factory_mode_get_test_project()
1640   1      #endif
1641   1        )
1642   1        {
1643   2      #ifdef __FACTORY_TEST_SUPPORT__
1644   2          mmi_dq_factory_mode_reset_test();
1645   2      #endif
1646   2          return;
1647   2        }
1648   1        else
1649   1        {
1650   2          if (RET_SUCESS == mmi_dq_fs_reset())
1651   2          {
1652   3      #ifdef __LOCK_AUDIO_SUPPORT__
1653   3            mmi_dq_aud_play_with_id(AUD_ID_RESTORE_SUCESS);
1654   3      #endif
C51 COMPILER V9.59.0.0   MMI_MS                                                            04/19/2021 17:37:53 PAGE 28  

1655   3      
1656   3      #ifdef __LOCK_WIFI_SUPPORT__
1657   3            mmi_dq_wifi_clr_pwd_suc();
1658   3            mmi_dq_wifi_clr_fps_suc();
1659   3            mmi_dq_wifi_clr_rfid_suc();
1660   3      #endif
1661   3          }
1662   2          else
1663   2      #ifdef __LOCK_AUDIO_SUPPORT__
1664   2            mmi_dq_aud_play_with_id(AUD_BASE_ID_FAIL)
1665   2      #endif
1666   2              ;
1667   2      
1668   2          mmi_dq_sys_add_admin_pwd();
1669   2        }
1670   1      }
1671          
1672          #ifdef __LOCK_WIFI_SUPPORT__
1673          /*
1674          parameter: 
1675            none
1676          return :
1677            none
1678          */
1679          void mmi_ms_wifi_opt_fun(void)
1680          {
1681   1        unsigned char type = mmi_dq_sys_get_wifi_check_type();
1682   1        if (type == 0)
1683   1          mmi_dq_wifi_check_connect();
1684   1        else if (type == 1)
1685   1          mmi_dq_wifi_check_open();
1686   1      }
1687          #endif
1688          #endif //__MMI_MS_C__


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   4163    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     74      21
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  2 WARNING(S),  0 ERROR(S)
