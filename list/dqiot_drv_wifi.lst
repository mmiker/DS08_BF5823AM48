C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/21/2021 11:38:16 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE DQIOT_DRV_WIFI
OBJECT MODULE PLACED IN .\output\dqiot_drv_wifi.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE source\dqiot_drv_wifi.c LARGE OMF2 OPTIMIZE(8,SPEED) BROWSE INCDIR(.\inc
                    -lude;.\Library\byd_standard_peripheral\include;.\byd_api\byd_key\include;.\byd_api\byd_mifare\include;.\byd_tool_comm;.\
                    -byd_rfid;.\mmi_inc) DEBUG PRINT(.\list\dqiot_drv_wifi.lst) TABS(2) OBJECT(.\output\dqiot_drv_wifi.obj)

line level    source

   1          #ifndef __DQIOT_DRV_WIFI_C__
   2          #define __DQIOT_DRV_WIFI_C__
   3          #include "mmi_feature.h"
   4          #ifdef __LOCK_WIFI_SUPPORT__
   5          #include "dqiot_drv_wifi.h"
   6          #include "iic_master.h"
   7          #include "delay.h"
   8          #include "mmi_fs.h"
   9          #include "mmi_audio.h"
  10          #include "mmi_wifi.h"
  11          #include "mmi_fps.h"
  12          #include "mmi_ms.h"
  13          // #include <stdio.h>
  14          
  15          unsigned char wifi_add_flag = 0;
  16          extern unsigned char uart_get_buf[];
  17          extern unsigned char uart_getbuflen;
  18          // extern void printfS(char *show, char *status);
  19          // extern void printfV(char *show, int value);
  20          
  21          /**
  22            * @brief  GPIOÂàùÂßãÂåñ
  23            * @param  none
  24            * @return none
  25            * @note   none
  26            * @see    none
  27            */
  28          void dqiot_drv_wifi_gpio_init(void)
  29          {
  30   1        /*wifi
  31   1        UART0_TX  PF4 ËæìÂá∫
  32   1        UART0_RX  PF5 ËæìÂÖ•
  33   1        NRST_CTR  PF7 ‰æõÁîµ
  34   1        */
  35   1        gpio_init(FP_TX_PORT, FP_TX_PIN, GPIO_MODE_OUT);
  36   1        gpio_bit_set(FP_TX_PORT, FP_TX_PIN);
  37   1      
  38   1        gpio_init(FP_RX_PORT, FP_RX_PIN, GPIO_MODE_IPU);
  39   1        gpio_bit_set(FP_RX_PORT, FP_RX_PIN);
  40   1      
  41   1        gpio_init(FP_PWR_PORT, FP_PWR_PIN, GPIO_MODE_OUT);
  42   1        gpio_bit_set(FP_PWR_PORT, FP_PWR_PIN);
  43   1      
  44   1        return;
  45   1      }
  46          
  47          /**
  48            * @brief  GPIOÂèñÊ∂àÂàùÂßãÂåñ
  49            * @param  none
  50            * @return none
  51            * @note   none
  52            * @see    none
  53            */
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/21/2021 11:38:16 PAGE 2   

  54          void dqiot_drv_wifi_gpio_deinit(void)
  55          {
  56   1        /*wifi
  57   1        UART0_TX  PF4 ËæìÂá∫
  58   1        UART0_RX  PF5 ËæìÂÖ•
  59   1        NRST_CTR  PF7 ‰æõÁîµ
  60   1        */
  61   1        gpio_init(FP_TX_PORT, FP_TX_PIN, GPIO_MODE_IN_FLOATING);
  62   1        gpio_bit_reset(FP_TX_PORT, FP_TX_PIN);
  63   1      
  64   1        gpio_init(FP_RX_PORT, FP_RX_PIN, GPIO_MODE_IN_FLOATING);
  65   1        gpio_bit_reset(FP_RX_PORT, FP_RX_PIN);
  66   1      
  67   1        gpio_init(FP_PWR_PORT, FP_PWR_PIN, GPIO_MODE_IN_FLOATING);
  68   1        gpio_bit_reset(FP_PWR_PORT, FP_PWR_PIN);
  69   1      
  70   1        return;
  71   1      }
  72          
  73          /**
  74            * @brief  ‰∏≤Âè£Êï∞ÊçÆÊé•Êî∂
  75            * @param  send    ÂèëÈÄÅÊï∞ÊçÆ
  76            * @param  send_len  ÂèëÈÄÅÊï∞ÊçÆÈïøÂ∫¶
  77            * @param  Buf     Êé•Êî∂Êï∞ÊçÆ
  78            * @param  len     Êé•Êî∂Êï∞ÊçÆÈïøÂ∫¶
  79            * @return ‰∏≤Âè£Êï∞ÊçÆ
  80            * @note   none
  81            * @see    none
  82            */
  83          uint8_t UH010_ReadDatas(uint8_t *send, uint8_t send_len, uint8_t *Buf, uint8_t len)
  84          {
  85   1      #if 0
                uint8_t i;
              
                if (send_len > 0)
                {
                  EA = 0;
                  iic_master_start();
              
                  if (iic_sendbyte_and_getnack(WIFI_ADDR))
                  {
                    //iic_master_stop();
                    //EA = 1;
                    //return 1;
                  }
              
                  for (i = 0; i < send_len; i++)
                  {
                    if (iic_sendbyte_and_getnack(send[i]))
                    {
                      //iic_master_stop();
                      //EA = 1;
                      //return 1;
                    }
                  }
              
                  if (iic_sendbyte_and_getnack(WIFI_ADDR | 0x01))
                  {
                    //iic_master_stop();
                    //EA = 1;
                    //return 1;
                  }
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/21/2021 11:38:16 PAGE 3   

              
                  for (i = 0; i < len; i++)
                  {
                    Buf[i] = iic_receive_byte();
                    if (i == (len - 1))
                      break;
                    iic_respond(ACK);
                  }
              
                  iic_respond(NACK);
              
                  EA = 1;
                  iic_master_stop();
                }
                else
                {
                  EA = 0;
                  iic_master_start();
                  if (iic_sendbyte_and_getnack(WIFI_ADDR | 0x01))
                  {
                    //iic_master_stop();
                    //EA = 1;
                    //return 1;
                  }
              
                  for (i = 0; i < len; i++)
                  {
                    Buf[i] = iic_receive_byte();
                    if (i == (len - 1))
                      break;
                    iic_respond(ACK);
                  }
              
                  iic_respond(NACK);
              
                  EA = 1;
                  iic_master_stop();
                }
              
                return 0;
              #else
 157   1        uint8_t i = 0, j = 0, index = 0;
 158   1        uint16_t waittime = 1000;
 159   1      
 160   1        if (send_len > 0)
 161   1        {
 162   2          EA = 0;
 163   2      
 164   2          for (i = 0; i < send_len; i++)
 165   2            uart_tx_byte(UART0, send[i]);
 166   2      
 167   2          while (--waittime)
 168   2          {
 169   3            delay_ms(1);
 170   3      
 171   3            if (uart_getbuflen >= 2)
 172   3            {
 173   4              /* ÂØªÊâæÂåÖÂ§¥ */
 174   4              for (i = 0; i < uart_getbuflen; i++)
 175   4              {
 176   5                if (uart_get_buf[i] == 'K' || uart_get_buf[i] == 'I' || uart_get_buf[i] == 'B' \
 177   5                || uart_get_buf[i] == 'F' || uart_get_buf[i] == 'R' || uart_get_buf[i] == 'M' \
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/21/2021 11:38:16 PAGE 4   

 178   5                || uart_get_buf[i] == 'J' || uart_get_buf[i] == 'q')
 179   5                {
 180   6                  if (uart_get_buf[i] == 'J') //ÂèñÁ¨¨‰∏Ä‰∏™ÂëΩ‰ª§
 181   6                  {
 182   7                    index = i;
 183   7                    break;
 184   7                  }
 185   6                  if (uart_getbuflen - i >= 2) //ÂèñÊúÄÂêé‰∏Ä‰∏™ÂëΩ‰ª§
 186   6                    index = i;
 187   6                }
 188   5              }
 189   4      
 190   4              for (i = index; i < uart_getbuflen; i++)
 191   4              {
 192   5                Buf[j] = uart_get_buf[i];
 193   5                if (j == (len - 1))
 194   5                  break;
 195   5                j++;
 196   5              }
 197   4      
 198   4              // /* log */
 199   4              // dqiot_drv_uart0A_init();
 200   4              // for (i = 0; i < uart_getbuflen; i++)
 201   4              //  printf("uart_get_buf[%d] is %d\n", (int)i, (int)uart_get_buf[i]);
 202   4              // for (i = 0; i < len; i++)
 203   4              //  printf("buf[%d] is %d\n", (int)i, (int)Buf[i]);
 204   4              // dqiot_drv_uart0B_init();
 205   4      
 206   4              /* Ê∏ÖÁ©∫ÁºìÂ≠ò */
 207   4              uart_getbuflen = 0;
 208   4              EA = 1;
 209   4      
 210   4              return 0;
 211   4            }
 212   3          }
 213   2      
 214   2          EA = 1;
 215   2        }
 216   1        else
 217   1        {
 218   2          EA = 0;
 219   2      
 220   2          while (--waittime)
 221   2          {
 222   3            delay_ms(1);
 223   3      
 224   3            if (uart_getbuflen >= 2)
 225   3            {
 226   4              /* ÂØªÊâæÂåÖÂ§¥ */
 227   4              for (i = 0; i < uart_getbuflen; i++)
 228   4              {
 229   5                if (uart_get_buf[i] == 'K' || uart_get_buf[i] == 'I' || uart_get_buf[i] == 'B' \
 230   5                || uart_get_buf[i] == 'F' || uart_get_buf[i] == 'R' || uart_get_buf[i] == 'M' \
 231   5                || uart_get_buf[i] == 'J' || uart_get_buf[i] == 'q')
 232   5                {
 233   6                  if (uart_get_buf[i] == 'J') //ÂèñÁ¨¨‰∏Ä‰∏™ÂëΩ‰ª§
 234   6                  {
 235   7                    index = i;
 236   7                    break;
 237   7                  }
 238   6                  if (uart_getbuflen - i >= 2) //ÂèñÊúÄÂêé‰∏Ä‰∏™ÂëΩ‰ª§
 239   6                    index = i;
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/21/2021 11:38:16 PAGE 5   

 240   6                }
 241   5              }
 242   4      
 243   4              for (i = index; i < uart_getbuflen; i++)
 244   4              {
 245   5                Buf[j] = uart_get_buf[i];
 246   5                if (j == (len - 1))
 247   5                  break;
 248   5                j++;
 249   5              }
 250   4      
 251   4              // /* log */
 252   4              // dqiot_drv_uart0A_init();
 253   4              // for (i = 0; i < uart_getbuflen; i++)
 254   4              //  printf("uart_get_buf[%d] is %d\n", (int)i, (int)uart_get_buf[i]);
 255   4              // for (i = 0; i < len; i++)
 256   4              //  printf("buf[%d] is %d\n", (int)i, (int)Buf[i]);
 257   4              // dqiot_drv_uart0B_init();
 258   4      
 259   4              /* Ê∏ÖÁ©∫ÁºìÂ≠ò */
 260   4              uart_getbuflen = 0;
 261   4              EA = 1;
 262   4      
 263   4              return 0;
 264   4            }
 265   3          }
 266   2      
 267   2          EA = 1;
 268   2        }
 269   1      
 270   1        return 0;
 271   1      #endif
 272   1      }
 273          
 274          /**
 275            * @brief  ‰∏≤Âè£Êï∞ÊçÆÂèëÁîü
 276            * @param  send    ÂèëÈÄÅÊï∞ÊçÆ
 277            * @param  send_len  ÂèëÈÄÅÊï∞ÊçÆÈïøÂ∫¶
 278            * @return none
 279            * @note   none
 280            * @see    none
 281            */
 282          uint8_t UH010_Write_Byte(uint8_t *send, uint8_t send_len)
 283          {
 284   1      #if 0
                uint8_t i;
              
                EA = 0;
                iic_master_start();
              
                if (iic_sendbyte_and_getnack(WIFI_ADDR & ~0x01))
                {
                  iic_master_stop();
                  EA = 1;
                  return 1;
                }
              
                for (i = 0; i < send_len; i++)
                {
                  if (iic_sendbyte_and_getnack(send[i]))
                  {
                    iic_master_stop();
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/21/2021 11:38:16 PAGE 6   

                    EA = 1;
                    return 1;
                  }
                }
                EA = 1;
                iic_master_stop();
              
                return 0;
              #else
 311   1        uint8_t i;
 312   1      
 313   1        uart_getbuflen = 0;
 314   1        EA = 0;
 315   1      
 316   1        for (i = 0; i < send_len; i++)
 317   1          uart_tx_byte(UART0, send[i]);
 318   1      
 319   1        EA = 1;
 320   1      
 321   1        return 0;
 322   1      #endif
 323   1      }
 324          
 325          /*
 326          parameter: 
 327            none
 328          return :
 329            none
 330          */
 331          void wifi_uh316_init(void)
 332          {
 333   1      }
 334          
 335          /**
 336            * @brief  Êô∫ËÉΩÈÖçÁΩëÔºàÂèëÈÄÅÔºâ
 337            * @param  none
 338            * @return none
 339            * @note   none
 340            * @see    none
 341            */
 342          uint8_t wifi_net_connect_send(void)
 343          {
 344   1        uint8_t wifi_data[2];
 345   1        wifi_data[0] = WIFI_CMD_NET_CON;
 346   1        wifi_data[1] = 100;
 347   1        if (UH010_Write_Byte(wifi_data, 2) == 0)
 348   1          return 1;
 349   1        else
 350   1          return 0;
 351   1      }
 352          
 353          /**
 354            * @brief  AirkissÈÖçÁΩëÔºàÂèëÈÄÅÔºâ
 355            * @param  none
 356            * @return none
 357            * @note   none
 358            * @see    none
 359            */
 360          uint8_t wifi_net_airkiss_connect_send(void)
 361          {
 362   1        uint8_t wifi_data[2];
 363   1        wifi_data[0] = WIFI_CMD_AIRKISS_NET_CON;
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/21/2021 11:38:16 PAGE 7   

 364   1        wifi_data[1] = 100;
 365   1        if (UH010_Write_Byte(wifi_data, 2) == 0)
 366   1          return 1;
 367   1        else
 368   1          return 0;
 369   1      }
 370          
 371          /**
 372            * @brief  ‰∫åÁª¥Á†ÅÈÖçÁΩëÔºàÂèëÈÄÅÔºâ
 373            * @param  none
 374            * @return none
 375            * @note   none
 376            * @see    none
 377            */
 378          uint8_t wifi_net_code_connect_send(void)
 379          {
 380   1        uint8_t wifi_data[2];
 381   1        wifi_data[0] = WIFI_CMD_CODE_NET_CON;
 382   1        wifi_data[1] = 100;
 383   1        if (UH010_Write_Byte(wifi_data, 2) == 0)
 384   1          return 1;
 385   1        else
 386   1          return 0;
 387   1      }
 388          
 389          /**
 390            * @brief  ÈÖçÁΩëÁä∂ÊÄÅÔºàÊé•Êî∂Ôºâ
 391            * @param  none
 392            * @return none
 393            * @note   none
 394            * @see    none
 395            */
 396          uint8_t wifi_net_connect_state(void)
 397          {
 398   1        uint8_t wifi_data[2];
 399   1        uint8_t data_2[2] = {0};
 400   1        wifi_data[0] = WIFI_CMD_NET_STATE;
 401   1        wifi_data[1] = 100;
 402   1        UH010_Write_Byte(wifi_data, 2);
 403   1        delay_ms(50);
 404   1        UH010_ReadDatas(wifi_data, 0, data_2, 2);
 405   1        if (data_2[0] == 'I' && data_2[1] == 'O')
 406   1          return 1;
 407   1        if (data_2[0] == 'I' && data_2[1] == 'E')
 408   1          return 2;
 409   1        else
 410   1          return 0;
 411   1      }
 412          
 413          /**
 414            * @brief  Êü•ËØ¢ÁΩëÁªúÁä∂ÊÄÅ
 415            * @param  none
 416            * @return none
 417            * @note   none
 418            * @see    none
 419            */
 420          uint8_t wifi_check_net(void)
 421          {
 422   1        uint8_t wifi_data[2];
 423   1        uint8_t data_2[2] = {0};
 424   1        wifi_data[0] = WIFI_CMD_CHECK_NET;
 425   1        wifi_data[1] = 100;
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/21/2021 11:38:16 PAGE 8   

 426   1        UH010_Write_Byte(wifi_data, 2);
 427   1        delay_ms(50);
 428   1        UH010_ReadDatas(wifi_data, 0, data_2, 2);
 429   1        if (data_2[0] == 'q' && data_2[1] == 'O')
 430   1          return 1;
 431   1        else
 432   1          return 0;
 433   1      }
 434          
 435          /**
 436            * @brief  ÊãçÁÖß
 437            * @param  none
 438            * @return none
 439            * @note   none
 440            * @see    none
 441            */
 442          uint8_t wifi_take_photos(void)
 443          {
 444   1        uint8_t wifi_data[2];
 445   1        wifi_data[0] = WIFI_CMD_TAKE_PHOTOS;
 446   1        wifi_data[1] = 100;
 447   1        UH010_Write_Byte(wifi_data, 2);
 448   1        return 1;
 449   1      }
 450          
 451          /**
 452            * @brief  ÂΩïÂÉè
 453            * @param  none
 454            * @return none
 455            * @note   none
 456            * @see    none
 457            */
 458          uint8_t wifi_take_videos(void)
 459          {
 460   1        uint8_t wifi_data[2];
 461   1        wifi_data[0] = WIFI_CMD_TAKE_VIDEOS;
 462   1        wifi_data[1] = 100;
 463   1        UH010_Write_Byte(wifi_data, 2);
 464   1        return 1;
 465   1      }
 466          
 467          /**
 468            * @brief  ÂèëÈÄÅÊï∞ÊçÆÂåÖ
 469            * @param  cmd   ÂëΩ‰ª§
 470            * @param  pv    ÁîµÊµÅ
 471            * @param  index ÁºñÂè∑(0xff=null)
 472            * @return status
 473            * @note   none
 474            * @see    none
 475            */
 476          uint8_t wifi_data_package(uint8_t cmd, uint8_t pv, uint8_t index)
 477          {
 478   1        uint8_t wifi_data[3];
 479   1        wifi_data[0] = cmd;
 480   1        wifi_data[1] = pv;
 481   1        wifi_data[2] = index;
 482   1      
 483   1        if (index == 0xff)
 484   1          UH010_Write_Byte(wifi_data, 2);
 485   1        else
 486   1          UH010_Write_Byte(wifi_data, 3);
 487   1      
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/21/2021 11:38:16 PAGE 9   

 488   1        return 1;
 489   1      }
 490          
 491          /**
 492            * @brief  ËøúÁ®ãÂºÄÈó®ÔºàÂèëÈÄÅÔºâ
 493            * @param  none
 494            * @return none
 495            * @note   none
 496            * @see    none
 497            */
 498          uint8_t wifi_open_ask(void)
 499          {
 500   1        uint8_t wifi_data[2];
 501   1        wifi_data[0] = WIFI_CMD_WF_OPEN_ASK;
 502   1        wifi_data[1] = 100;
 503   1        if (UH010_Write_Byte(wifi_data, 2) == 0)
 504   1          return 1;
 505   1        else
 506   1          return 0;
 507   1      }
 508          
 509          /**
 510            * @brief  ËøúÁ®ãÂºÄÈó®ÔºàÊé•Êî∂Ôºâ
 511            * @param  none
 512            * @return none
 513            * @note   none
 514            * @see    none
 515            */
 516          uint8_t wifi_open_reply_get(void)
 517          {
 518   1        uint8_t wifi_data[2];
 519   1        uint8_t data_2[2] = {0};
 520   1        wifi_data[0] = WIFI_CMD_WF_OPEN_REPLY;
 521   1        wifi_data[1] = 100;
 522   1        UH010_Write_Byte(wifi_data, 2);
 523   1        delay_ms(300);
 524   1        UH010_ReadDatas(wifi_data, 0, data_2, 2);
 525   1      
 526   1        // printfV("data_2[0]", (int)data_2[0]);
 527   1        // printfV("data_2[1]", (int)data_2[1]);
 528   1      
 529   1        if (data_2[0] == 'K' && data_2[1] == 'O')
 530   1          return 1;
 531   1        else if (data_2[0] == 'K' && data_2[1] == 'E')
 532   1          return 2;
 533   1        else if (data_2[0] == 'K' && data_2[1] == 'K')
 534   1          return 3;
 535   1        else
 536   1          return 0;
 537   1      }
 538          
 539          /**
 540            * @brief  Ê∑ªÂä†Âà†Èô§ÂØÜÁ†Å/ÊåáÁ∫π/RFÂç°
 541            * @param  none
 542            * @return none
 543            * @note   none
 544            * @see    none
 545            */
 546          uint8_t wifi_cmd_add_del(void)
 547          {
 548   1        RET_VAL retval = 0xff;
 549   1        uint8_t wifi_data[2];
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/21/2021 11:38:16 PAGE 10  

 550   1        uint8_t data_2[3] = {0};
 551   1        wifi_data[0] = WIFI_CMD_ADD_DEL;
 552   1        wifi_data[1] = 100;
 553   1        UH010_Write_Byte(wifi_data, 2);
 554   1        delay_ms(300);
 555   1        UH010_ReadDatas(wifi_data, 0, data_2, 3);
 556   1      
 557   1        if (data_2[0] == 'B')
 558   1        {
 559   2          switch (data_2[1])
 560   2          {
 561   3          case 'L':
 562   3            return 0xff;
 563   3      
 564   3          case 'E':
 565   3      #ifdef __LOCK_AUDIO_SUPPORT__
 566   3            mmi_dq_aud_play_with_id(AUD_BASE_ID_FAIL);
 567   3      #endif
 568   3            return 0xff;
 569   3      
 570   3          case 'M':
 571   3            wifi_add_flag = 1;
 572   3      #ifdef __LOCK_AUDIO_SUPPORT__
 573   3            mmi_dq_aud_play_with_id(AUD_ID_INPUT_68_PWD);
 574   3      #endif
 575   3            mmi_dq_ms_set_sys_state(SYS_STATUS_ADD_PWD);
 576   3            break;
 577   3      
 578   3          case 'F':
 579   3      #ifdef __LOCK_FP_SUPPORT__
                    wifi_add_flag = 1;
              #ifdef __LOCK_AUDIO_SUPPORT__
                    mmi_dq_aud_play_with_id(AUD_ID_PRESS_FP);
              #endif
                    mmi_dq_ms_set_sys_state(SYS_STATUS_ADD_FP);
              #else
 586   3            mmi_dq_aud_play_with_id(AUD_BASE_ID_FAIL);
 587   3      #endif
 588   3            break;
 589   3      
 590   3          case 'R':
 591   3      #ifdef __LOCK_RFID_CARD_SUPPORT__
 592   3            wifi_add_flag = 1;
 593   3      #ifdef __LOCK_AUDIO_SUPPORT__
 594   3            mmi_dq_aud_play_with_id(AUD_ID_PRESS_RFCARD);
 595   3      #endif
 596   3            mmi_dq_ms_set_sys_state(SYS_STATUS_ADD_RFID);
 597   3      #else
                    mmi_dq_aud_play_with_id(AUD_BASE_ID_FAIL);
              #endif
 600   3            break;
 601   3          }
 602   2        }
 603   1        else if (data_2[0] == 'M' || data_2[0] == 'F' || data_2[0] == 'R')
 604   1        {
 605   2          if (data_2[2] == 0x00) //48 => 0,57 => 9
 606   2            get_index = data_2[1] - '0';
 607   2          else
 608   2            get_index = (data_2[1] - '0') * 10 + (data_2[2] - '0');
 609   2      
 610   2          switch (data_2[0])
 611   2          {
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/21/2021 11:38:16 PAGE 11  

 612   3          case 'M':
 613   3            retval = mmi_dq_fs_del_pwd(get_index, FDS_USE_TYPE_USER);
 614   3            if (retval == RET_SUCESS)
 615   3            {
 616   4      #ifdef __LOCK_AUDIO_SUPPORT__
 617   4              mmi_dq_aud_play_with_id(AUD_ID_DEL_PWD_SUCESS);
 618   4      #endif
 619   4              mmi_dq_wifi_del_password(get_index);
 620   4            }
 621   3            else
 622   3      #ifdef __LOCK_AUDIO_SUPPORT__
 623   3              mmi_dq_aud_play_with_id(AUD_ID_DEL_FAIL)
 624   3      #endif
 625   3                ;
 626   3            break;
 627   3      
 628   3          case 'F':
 629   3      #ifdef __LOCK_FP_SUPPORT__
                    retval = mmi_dq_fs_del_fp(get_index, FDS_USE_TYPE_USER);
                    if (retval == RET_SUCESS)
                      retval = mmi_dq_fp_delete((unsigned short)get_index);
                    if (retval == 0)
                    {
              #ifdef __LOCK_AUDIO_SUPPORT__
                      mmi_dq_aud_play_with_id(AUD_ID_DEL_FP_SUCESS);
              #endif
                      mmi_dq_wifi_del_fp(get_index);
                    }
                    else
              #ifdef __LOCK_AUDIO_SUPPORT__
                      mmi_dq_aud_play_with_id(AUD_ID_DEL_FAIL)
              #endif
                        ;
              #else
 646   3            mmi_dq_aud_play_with_id(AUD_BASE_ID_FAIL);
 647   3      #endif
 648   3            break;
 649   3      
 650   3          case 'R':
 651   3      #ifdef __LOCK_RFID_CARD_SUPPORT__
 652   3            retval = mmi_dq_fs_del_rfid(get_index);
 653   3            if (retval == RET_SUCESS)
 654   3            {
 655   4      #ifdef __LOCK_AUDIO_SUPPORT__
 656   4              mmi_dq_aud_play_with_id(AUD_ID_DEL_RFCARD_SUCESS);
 657   4      #endif
 658   4              mmi_dq_wifi_del_rfid_suc(get_index);
 659   4            }
 660   3            else
 661   3      #ifdef __LOCK_AUDIO_SUPPORT__
 662   3              mmi_dq_aud_play_with_id(AUD_ID_DEL_FAIL)
 663   3      #endif
 664   3                ;
 665   3      #else
                    mmi_dq_aud_play_with_id(AUD_BASE_ID_FAIL);
              #endif
 668   3            break;
 669   3          }
 670   2        }
 671   1        else
 672   1          return 1; //Á©∫ÂÄº
 673   1      
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/21/2021 11:38:16 PAGE 12  

 674   1        return 0;
 675   1      }
 676          
 677          /**
 678            * @brief  Èó®Êú™ÂÖ≥
 679            * @param  none
 680            * @return none
 681            * @note   none
 682            * @see    none
 683            */
 684          void wifi_close_over_time(void)
 685          {
 686   1        uint8_t wifi_data[2];
 687   1        wifi_data[0] = WIFI_CMD_CLOSE_OVER_TIME;
 688   1        wifi_data[1] = 100;
 689   1        UH010_Write_Byte(wifi_data, 2);
 690   1      }
 691          
 692          /**
 693            * @brief  Âî§ÈÜí
 694            * @param  none
 695            * @return none
 696            * @note   none
 697            * @see    none
 698            */
 699          unsigned char wifi_wake_up(void)
 700          {
 701   1      
 702   1        uint8_t wifi_data[2];
 703   1        wifi_data[0] = WIFI_CMD_WAKEUP;
 704   1        wifi_data[1] = 100;
 705   1        return UH010_Write_Byte(wifi_data, 2);
 706   1      }
 707          
 708          /**
 709            * @brief  Áù°Áú†
 710            * @param  none
 711            * @return none
 712            * @note   none
 713            * @see    none
 714            */
 715          void wifi_sleep_mode(void)
 716          {
 717   1        uint8_t wifi_data[2];
 718   1        wifi_data[0] = WIFI_CMD_SLEEP;
 719   1        wifi_data[1] = 100;
 720   1        UH010_Write_Byte(wifi_data, 2);
 721   1      }
 722          
 723          /**
 724            * @brief  Ê∑ªÂä†ÂØÜÁ†Å
 725            * @param  index
 726            * @return none
 727            * @note   none
 728            * @see    none
 729            */
 730          void wifi_add_password(uint8_t index)
 731          {
 732   1        uint8_t wifi_data[3];
 733   1        wifi_data[0] = WIFI_CMD_ADD_PW;
 734   1        wifi_data[1] = 100;
 735   1        wifi_data[2] = index;
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/21/2021 11:38:16 PAGE 13  

 736   1        UH010_Write_Byte(wifi_data, 3);
 737   1      }
 738          
 739          /**
 740            * @brief  Âà†Èô§ÂØÜÁ†Å
 741            * @param  index
 742            * @return none
 743            * @note   none
 744            * @see    none
 745            */
 746          void wifi_del_password(uint8_t index)
 747          {
 748   1        uint8_t wifi_data[3];
 749   1        wifi_data[0] = WIFI_CMD_DEL_PW;
 750   1        wifi_data[1] = 100;
 751   1        wifi_data[2] = index;
 752   1        UH010_Write_Byte(wifi_data, 3);
 753   1      }
 754          
 755          /**
 756            * @brief  Ê∑ªÂä†ÊåáÁ∫π
 757            * @param  index
 758            * @return none
 759            * @note   none
 760            * @see    none
 761            */
 762          void wifi_add_fp(uint8_t index)
 763          {
 764   1        uint8_t wifi_data[3];
 765   1        wifi_data[0] = WIFI_CMD_ADD_FP;
 766   1        wifi_data[1] = 100;
 767   1        wifi_data[2] = index;
 768   1        UH010_Write_Byte(wifi_data, 3);
 769   1      }
 770          
 771          /**
 772            * @brief  Âà†Èô§ÊåáÁ∫π
 773            * @param  index
 774            * @return none
 775            * @note   none
 776            * @see    none
 777            */
 778          void wifi_del_fp(uint8_t index)
 779          {
 780   1        uint8_t wifi_data[3];
 781   1        wifi_data[0] = WIFI_CMD_DEL_FP;
 782   1        wifi_data[1] = 100;
 783   1        wifi_data[2] = index;
 784   1        UH010_Write_Byte(wifi_data, 3);
 785   1      }
 786          
 787          /**
 788            * @brief  Ê∑ªÂä†RFÂç°
 789            * @param  index
 790            * @return none
 791            * @note   none
 792            * @see    none
 793            */
 794          void wifi_add_rf(uint8_t index)
 795          {
 796   1        uint8_t wifi_data[3];
 797   1        wifi_data[0] = WIFI_CMD_ADD_RF;
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/21/2021 11:38:16 PAGE 14  

 798   1        wifi_data[1] = 100;
 799   1        wifi_data[2] = index;
 800   1        UH010_Write_Byte(wifi_data, 3);
 801   1      }
 802          
 803          /**
 804            * @brief  Âà†Èô§RFÂç°
 805            * @param  index
 806            * @return none
 807            * @note   none
 808            * @see    none
 809            */
 810          void wifi_del_rf(uint8_t index)
 811          {
 812   1        uint8_t wifi_data[3];
 813   1        wifi_data[0] = WIFI_CMD_DEL_RF;
 814   1        wifi_data[1] = 100;
 815   1        wifi_data[2] = index;
 816   1        UH010_Write_Byte(wifi_data, 3);
 817   1      }
 818          
 819          /**
 820            * @brief  ÂØÜÁ†ÅÂÖ®ÈÉ®Ê∏ÖÈô§
 821            * @param  none
 822            * @return none
 823            * @note   none
 824            * @see    none
 825            */
 826          void wifi_clr_pwd(void)
 827          {
 828   1        uint8_t wifi_data[2];
 829   1        wifi_data[0] = WIFI_CMD_CLR_PW;
 830   1        wifi_data[1] = 100;
 831   1        UH010_Write_Byte(wifi_data, 2);
 832   1      }
 833          
 834          /**
 835            * @brief  ÊåáÁ∫πÂÖ®ÈÉ®Ê∏ÖÈô§
 836            * @param  none
 837            * @return none
 838            * @note   none
 839            * @see    none
 840            */
 841          void wifi_clr_fp(void)
 842          {
 843   1        uint8_t wifi_data[2];
 844   1        wifi_data[0] = WIFI_CMD_CLR_FP;
 845   1        wifi_data[1] = 100;
 846   1        UH010_Write_Byte(wifi_data, 2);
 847   1      }
 848          
 849          /**
 850            * @brief  RFÂç°ÂÖ®ÈÉ®Ê∏ÖÈô§
 851            * @param  none
 852            * @return none
 853            * @note   none
 854            * @see    none
 855            */
 856          void wifi_clr_rf(void)
 857          {
 858   1        uint8_t wifi_data[2];
 859   1        wifi_data[0] = WIFI_CMD_CLR_RF;
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/21/2021 11:38:16 PAGE 15  

 860   1        wifi_data[1] = 100;
 861   1        UH010_Write_Byte(wifi_data, 2);
 862   1      }
 863          
 864          /**
 865            * @brief  ËøúÁ®ãÂºÄÈó®
 866            * @param  none
 867            * @return none
 868            * @note   none
 869            * @see    none
 870            */
 871          void wifi_open_by_wifi(void)
 872          {
 873   1        uint8_t wifi_data[2];
 874   1        wifi_data[0] = WIFI_CMD_WF_OPEN;
 875   1        wifi_data[1] = 100;
 876   1        UH010_Write_Byte(wifi_data, 2);
 877   1      }
 878          
 879          /**
 880            * @brief  ÂØÜÁ†ÅÂºÄÈó®
 881            * @param  index
 882            * @return none
 883            * @note   none
 884            * @see    none
 885            */
 886          void wifi_open_by_password(uint8_t index)
 887          {
 888   1        uint8_t wifi_data[3];
 889   1        wifi_data[0] = WIFI_CMD_PW_OPEN;
 890   1        wifi_data[1] = 100;
 891   1        wifi_data[2] = index;
 892   1        UH010_Write_Byte(wifi_data, 3);
 893   1      }
 894          
 895          /**
 896            * @brief  ÊåáÁ∫πÂºÄÈó®
 897            * @param  index
 898            * @return none
 899            * @note   none
 900            * @see    none
 901            */
 902          void wifi_open_by_fp(uint8_t index)
 903          {
 904   1        uint8_t wifi_data[3];
 905   1        wifi_data[0] = WIFI_CMD_FP_OPEN;
 906   1        wifi_data[1] = 100;
 907   1        wifi_data[2] = index;
 908   1        UH010_Write_Byte(wifi_data, 3);
 909   1      }
 910          
 911          /**
 912            * @brief  RFÂç°ÊåáÁ∫π
 913            * @param  index
 914            * @return none
 915            * @note   none
 916            * @see    none
 917            */
 918          void wifi_open_by_rfid(uint8_t index)
 919          {
 920   1        uint8_t wifi_data[3];
 921   1        wifi_data[0] = WIFI_CMD_RF_OPEN;
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/21/2021 11:38:16 PAGE 16  

 922   1        wifi_data[1] = 100;
 923   1        wifi_data[2] = index;
 924   1        UH010_Write_Byte(wifi_data, 3);
 925   1      }
 926          
 927          /**
 928            * @brief  Â∫îÊÄ•Èí•ÂåôÂºÄÈó®
 929            * @param  none
 930            * @return none
 931            * @note   none
 932            * @see    none
 933            */
 934          void wifi_open_by_key(void)
 935          {
 936   1        uint8_t wifi_data[2];
 937   1        wifi_data[0] = WIFI_CMD_KEY_OPEN;
 938   1        wifi_data[1] = 100;
 939   1        UH010_Write_Byte(wifi_data, 2);
 940   1      }
 941          
 942          /*
 943          parameter: 
 944            none
 945          return :
 946            none
 947          */
 948          void wifi_door_close(void)
 949          {
 950   1        uint8_t wifi_data[2];
 951   1        wifi_data[0] = WIFI_CMD_CLOSE;
 952   1        wifi_data[1] = 100;
 953   1        UH010_Write_Byte(wifi_data, 2);
 954   1      }
 955          
 956          /**
 957            * @brief  ÈúáÂä®Êä•Ë≠¶
 958            * @param  none
 959            * @return none
 960            * @note   none
 961            * @see    none
 962            */
 963          void wifi_via_alarm(void)
 964          {
 965   1        uint8_t wifi_data[2];
 966   1        wifi_data[0] = WIFI_CMD_VIA_ALARM;
 967   1        wifi_data[1] = 100;
 968   1        UH010_Write_Byte(wifi_data, 2);
 969   1      }
 970          
 971          /**
 972            * @brief  Â§öÊ¨°ÂØÜÁ†ÅÈîôËØØ
 973            * @param  none
 974            * @return none
 975            * @note   none
 976            * @see    none
 977            */
 978          void wifi_pw_alarm(void)
 979          {
 980   1        uint8_t wifi_data[2];
 981   1        wifi_data[0] = WIFI_CMD_PW_ALARM;
 982   1        wifi_data[1] = 100;
 983   1        UH010_Write_Byte(wifi_data, 2);
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/21/2021 11:38:16 PAGE 17  

 984   1      }
 985          
 986          /**
 987            * @brief  Â§öÊ¨°ÊåáÁ∫πÈîôËØØ
 988            * @param  none
 989            * @return none
 990            * @note   none
 991            * @see    none
 992            */
 993          void wifi_fp_alarm(void)
 994          {
 995   1        uint8_t wifi_data[2];
 996   1        wifi_data[0] = WIFI_CMD_FP_ALARM;
 997   1        wifi_data[1] = 100;
 998   1        UH010_Write_Byte(wifi_data, 2);
 999   1      }
1000          
1001          /**
1002            * @brief  Â§öÊ¨°RFÂç°ÈîôËØØ
1003            * @param  none
1004            * @return none
1005            * @note   none
1006            * @see    none
1007            */
1008          void wifi_rf_alarm(void)
1009          {
1010   1        uint8_t wifi_data[2];
1011   1        wifi_data[0] = WIFI_CMD_RF_ALARM;
1012   1        wifi_data[1] = 100;
1013   1        UH010_Write_Byte(wifi_data, 2);
1014   1      }
1015          
1016          /**
1017            * @brief  ‰ΩéÁîµÈáè
1018            * @param  none
1019            * @return none
1020            * @note   none
1021            * @see    none
1022            */
1023          void wifi_lowpower_alarm(void)
1024          {
1025   1        uint8_t wifi_data[2];
1026   1        wifi_data[0] = WIFI_CMD_LOWPOWER_ALARM;
1027   1        wifi_data[1] = 100;
1028   1        UH010_Write_Byte(wifi_data, 2);
1029   1      }
1030          
1031          /**
1032            * @brief  ÊãçÁÖßÂΩïÂÉèÂºÄÂÖ≥ÔºàÂèëÈÄÅÔºâ
1033            * @param  none
1034            * @return none
1035            * @note   none
1036            * @see    none
1037            */
1038          void wifi_pv_switch_send(void)
1039          {
1040   1        uint8_t wifi_data[2];
1041   1        wifi_data[0] = WIFI_CMD_PV_SWITCH_SEND;
1042   1        wifi_data[1] = 100;
1043   1        UH010_Write_Byte(wifi_data, 2);
1044   1      }
1045          
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/21/2021 11:38:16 PAGE 18  

1046          /**
1047            * @brief  ÊãçÁÖßÂΩïÂÉèÂºÄÂÖ≥ÔºàÊé•Êî∂Ôºâ
1048            * @param  none
1049            * @return none
1050            * @note   none
1051            * @see    none
1052            */
1053          uint8_t wifi_pv_switch_get(void)
1054          {
1055   1        uint8_t wifi_data[2];
1056   1        uint8_t data_2[2] = {0};
1057   1        wifi_data[0] = WIFI_CMD_PV_SWITCH_GET;
1058   1        wifi_data[1] = 100;
1059   1        UH010_Write_Byte(wifi_data, 2);
1060   1        delay_ms(300);
1061   1        UH010_ReadDatas(wifi_data, 0, data_2, 2);
1062   1        if (data_2[0] == 'J' && data_2[1] == 'E') //Êó†ÂìçÂ∫î
1063   1          return 0xff;
1064   1        else if (data_2[0] == 'J' && data_2[1] == '0') //ÂÖ≥Èó≠ÊãçÁÖßÂΩïÂÉè(ËÆæÂ§á‰πãÂêéÂºÄÈó®ÈÉΩ‰∏ç‰ºöÂèëÈÄÅÊãçÁ
             -ÖßÂíåÂΩïÂÉèÂëΩ‰ª§)
1065   1          return 0;
1066   1        else if (data_2[0] == 'J' && data_2[1] == '1') //ÂºÄÂêØÊãçÁÖßÂÖ≥Èó≠ÂΩïÂÉè
1067   1          return 1;
1068   1        else if (data_2[0] == 'J' && data_2[1] == '2') //ÂÖ≥Èó≠ÊãçÁÖßÂºÄÂêØÂΩïÂÉè
1069   1          return 2;
1070   1        else if (data_2[0] == 'J' && data_2[1] == '3') //ÂºÄÂêØÊãçÁÖßÂºÄÂêØÂΩïÂÉè
1071   1          return 3;
1072   1        else
1073   1          return 0xff;
1074   1      }
1075          
1076          void wifi_send_fp_110(void)
1077          {
1078   1        uint8_t wifi_data[2];
1079   1        wifi_data[0] = WIFI_CMD_WF_OPEN_FP_110;
1080   1        wifi_data[1] = 100;
1081   1        UH010_Write_Byte(wifi_data, 2);
1082   1      }
1083          
1084          void wifi_send_pwd_110(void)
1085          {
1086   1        uint8_t wifi_data[2];
1087   1        wifi_data[0] = WIFI_CMD_WF_OPEN_PSW_110;
1088   1        wifi_data[1] = 100;
1089   1        UH010_Write_Byte(wifi_data, 2);
1090   1      }
1091          
1092          void wifi_set_110(void)
1093          {
1094   1        uint8_t wifi_data[2];
1095   1        wifi_data[0] = WIFI_CMD_WF_SET_110;
1096   1        wifi_data[1] = 100;
1097   1        UH010_Write_Byte(wifi_data, 2);
1098   1      }
1099          
1100          #endif
1101          #endif //__DQIOT_DRV_WIFI_C__


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2333    ----
   CONSTANT SIZE    =     11    ----
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/21/2021 11:38:16 PAGE 19  

   XDATA SIZE       =      1     118
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
