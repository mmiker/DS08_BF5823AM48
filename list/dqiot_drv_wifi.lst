C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/19/2021 17:37:53 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE DQIOT_DRV_WIFI
OBJECT MODULE PLACED IN .\output\dqiot_drv_wifi.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE source\dqiot_drv_wifi.c LARGE OMF2 OPTIMIZE(8,SPEED) BROWSE INCDIR(.\inc
                    -lude;.\Library\byd_standard_peripheral\include;.\byd_api\byd_key\include;.\byd_api\byd_mifare\include;.\byd_tool_comm;.\
                    -byd_rfid;.\mmi_inc) DEBUG PRINT(.\list\dqiot_drv_wifi.lst) TABS(2) OBJECT(.\output\dqiot_drv_wifi.obj)

line level    source

   1          #ifndef __DQIOT_DRV_WIFI_C__
   2          #define __DQIOT_DRV_WIFI_C__
   3          #include "mmi_feature.h"
   4          #ifdef __LOCK_WIFI_SUPPORT__
   5          #include "dqiot_drv_wifi.h"
   6          #include "iic_master.h"
   7          #include "delay.h"
   8          #include "mmi_fs.h"
   9          #include "mmi_audio.h"
  10          #include "mmi_wifi.h"
  11          #include "mmi_fps.h"
  12          #include "mmi_ms.h"
  13          // #include <stdio.h>
  14          
  15          unsigned char wifi_add_flag = 0;
  16          extern unsigned char uart_get_buf[];
  17          extern unsigned char uart_getbuflen;
  18          // extern void printfS(char *show, char *status);
  19          // extern void printfV(char *show, int value);
  20          
  21          /**
  22            * @brief  GPIOÂàùÂßãÂåñ
  23            * @param  none
  24            * @return none
  25            * @note   none
  26            * @see    none
  27            */
  28          void dqiot_drv_wifi_gpio_init(void)
  29          {
  30   1        /*wifi
  31   1        UART0_TX  PF4 ËæìÂá∫
  32   1        UART0_RX  PF5 ËæìÂÖ•
  33   1        NRST_CTR  PF7 ‰æõÁîµ
  34   1        */
  35   1        gpio_init(FP_TX_PORT, FP_TX_PIN, GPIO_MODE_OUT);
  36   1        gpio_bit_set(FP_TX_PORT, FP_TX_PIN);
  37   1      
  38   1        gpio_init(FP_RX_PORT, FP_RX_PIN, GPIO_MODE_IPU);
  39   1        gpio_bit_set(FP_RX_PORT, FP_RX_PIN);
  40   1      
  41   1        gpio_init(FP_PWR_PORT, FP_PWR_PIN, GPIO_MODE_OUT);
  42   1        gpio_bit_set(FP_PWR_PORT, FP_PWR_PIN);
  43   1      
  44   1        return;
  45   1      }
  46          
  47          /**
  48            * @brief  GPIOÂèñÊ∂àÂàùÂßãÂåñ
  49            * @param  none
  50            * @return none
  51            * @note   none
  52            * @see    none
  53            */
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/19/2021 17:37:53 PAGE 2   

  54          void dqiot_drv_wifi_gpio_deinit(void)
  55          {
  56   1        /*wifi
  57   1        UART0_TX  PF4 ËæìÂá∫
  58   1        UART0_RX  PF5 ËæìÂÖ•
  59   1        NRST_CTR  PF7 ‰æõÁîµ
  60   1        */
  61   1        gpio_init(FP_TX_PORT, FP_TX_PIN, GPIO_MODE_IN_FLOATING);
  62   1        gpio_bit_reset(FP_TX_PORT, FP_TX_PIN);
  63   1      
  64   1        gpio_init(FP_RX_PORT, FP_RX_PIN, GPIO_MODE_IN_FLOATING);
  65   1        gpio_bit_reset(FP_RX_PORT, FP_RX_PIN);
  66   1      
  67   1        gpio_init(FP_PWR_PORT, FP_PWR_PIN, GPIO_MODE_IN_FLOATING);
  68   1        gpio_bit_reset(FP_PWR_PORT, FP_PWR_PIN);
  69   1      
  70   1        return;
  71   1      }
  72          
  73          /**
  74            * @brief  ‰∏≤Âè£Êï∞ÊçÆÊé•Êî∂
  75            * @param  send    ÂèëÈÄÅÊï∞ÊçÆ
  76            * @param  send_len  ÂèëÈÄÅÊï∞ÊçÆÈïøÂ∫¶
  77            * @param  Buf     Êé•Êî∂Êï∞ÊçÆ
  78            * @param  len     Êé•Êî∂Êï∞ÊçÆÈïøÂ∫¶
  79            * @return ‰∏≤Âè£Êï∞ÊçÆ
  80            * @note   none
  81            * @see    none
  82            */
  83          uint8_t UH010_ReadDatas(uint8_t *send, uint8_t send_len, uint8_t *Buf, uint8_t len)
  84          {
  85   1      #if 0
                uint8_t i;
              
                if (send_len > 0)
                {
                  EA = 0;
                  iic_master_start();
              
                  if (iic_sendbyte_and_getnack(WIFI_ADDR))
                  {
                    //iic_master_stop();
                    //EA = 1;
                    //return 1;
                  }
              
                  for (i = 0; i < send_len; i++)
                  {
                    if (iic_sendbyte_and_getnack(send[i]))
                    {
                      //iic_master_stop();
                      //EA = 1;
                      //return 1;
                    }
                  }
              
                  if (iic_sendbyte_and_getnack(WIFI_ADDR | 0x01))
                  {
                    //iic_master_stop();
                    //EA = 1;
                    //return 1;
                  }
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/19/2021 17:37:53 PAGE 3   

              
                  for (i = 0; i < len; i++)
                  {
                    Buf[i] = iic_receive_byte();
                    if (i == (len - 1))
                      break;
                    iic_respond(ACK);
                  }
              
                  iic_respond(NACK);
              
                  EA = 1;
                  iic_master_stop();
                }
                else
                {
                  EA = 0;
                  iic_master_start();
                  if (iic_sendbyte_and_getnack(WIFI_ADDR | 0x01))
                  {
                    //iic_master_stop();
                    //EA = 1;
                    //return 1;
                  }
              
                  for (i = 0; i < len; i++)
                  {
                    Buf[i] = iic_receive_byte();
                    if (i == (len - 1))
                      break;
                    iic_respond(ACK);
                  }
              
                  iic_respond(NACK);
              
                  EA = 1;
                  iic_master_stop();
                }
              
                return 0;
              #else
 157   1        uint8_t i = 0, j = 0;
 158   1        uint16_t waittime = 1000;
 159   1      
 160   1        if (send_len > 0)
 161   1        {
 162   2          EA = 0;
 163   2      
 164   2          for (i = 0; i < send_len; i++)
 165   2            uart_tx_byte(UART0, send[i]);
 166   2      
 167   2          while (--waittime)
 168   2          {
 169   3            // delay_ms(1);
 170   3      
 171   3            if (uart_getbuflen >= 2)
 172   3            {
 173   4              /* ÂØªÊâæÂåÖÂ§¥ */
 174   4              for (i = 0; i < uart_getbuflen; i++)
 175   4              {
 176   5                if (uart_get_buf[i] == 'K' || uart_get_buf[i] == 'I' || uart_get_buf[i] == 'B' || uart_get_buf[i] == 
             -'F' || uart_get_buf[i] == 'R' || uart_get_buf[i] == 'M' || uart_get_buf[i] == 'J' || uart_get_buf[i] == 'q')
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/19/2021 17:37:53 PAGE 4   

 177   5                  break;
 178   5              }
 179   4      
 180   4              for (i; i < uart_getbuflen; i++)
 181   4              {
 182   5                Buf[j] = uart_get_buf[i];
 183   5                if (j == (len - 1))
 184   5                  break;
 185   5                j++;
 186   5              }
 187   4      
 188   4              /* Ê∏ÖÁ©∫ÁºìÂ≠ò */
 189   4              uart_getbuflen = 0;
 190   4              EA = 1;
 191   4      
 192   4              return 0;
 193   4            }
 194   3          }
 195   2      
 196   2          EA = 1;
 197   2        }
 198   1        else
 199   1        {
 200   2          EA = 0;
 201   2      
 202   2          while (--waittime)
 203   2          {
 204   3            // delay_ms(1);
 205   3      
 206   3            if (uart_getbuflen >= 2)
 207   3            {
 208   4              /* ÂØªÊâæÂåÖÂ§¥ */
 209   4              for (i = 0; i < uart_getbuflen; i++)
 210   4              {
 211   5                if (uart_get_buf[i] == 'K' || uart_get_buf[i] == 'I' || uart_get_buf[i] == 'B' || uart_get_buf[i] == 
             -'F' || uart_get_buf[i] == 'R' || uart_get_buf[i] == 'M' || uart_get_buf[i] == 'J' || uart_get_buf[i] == 'q')
 212   5                  break;
 213   5              }
 214   4      
 215   4              for (i; i < uart_getbuflen; i++)
 216   4              {
 217   5                Buf[j] = uart_get_buf[i];
 218   5                if (j == (len - 1))
 219   5                  break;
 220   5                j++;
 221   5              }
 222   4      
 223   4              /* Ê∏ÖÁ©∫ÁºìÂ≠ò */
 224   4              uart_getbuflen = 0;
 225   4              EA = 1;
 226   4      
 227   4              return 0;
 228   4            }
 229   3          }
 230   2      
 231   2          EA = 1;
 232   2        }
 233   1      
 234   1        return 0;
 235   1      #endif
 236   1      }
 237          
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/19/2021 17:37:53 PAGE 5   

 238          /**
 239            * @brief  ‰∏≤Âè£Êï∞ÊçÆÂèëÁîü
 240            * @param  send    ÂèëÈÄÅÊï∞ÊçÆ
 241            * @param  send_len  ÂèëÈÄÅÊï∞ÊçÆÈïøÂ∫¶
 242            * @return none
 243            * @note   none
 244            * @see    none
 245            */
 246          uint8_t UH010_Write_Byte(uint8_t *send, uint8_t send_len)
 247          {
 248   1      #if 0
                uint8_t i;
              
                EA = 0;
                iic_master_start();
              
                if (iic_sendbyte_and_getnack(WIFI_ADDR & ~0x01))
                {
                  iic_master_stop();
                  EA = 1;
                  return 1;
                }
              
                for (i = 0; i < send_len; i++)
                {
                  if (iic_sendbyte_and_getnack(send[i]))
                  {
                    iic_master_stop();
                    EA = 1;
                    return 1;
                  }
                }
                EA = 1;
                iic_master_stop();
              
                return 0;
              #else
 275   1        uint8_t i;
 276   1      
 277   1        EA = 0;
 278   1        uart_getbuflen = 0;
 279   1      
 280   1        for (i = 0; i < send_len; i++)
 281   1          uart_tx_byte(UART0, send[i]);
 282   1      
 283   1        EA = 1;
 284   1      
 285   1        return 0;
 286   1      #endif
 287   1      }
 288          
 289          /*
 290          parameter: 
 291            none
 292          return :
 293            none
 294          */
 295          void wifi_uh316_init(void)
 296          {
 297   1      }
 298          
 299          /**
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/19/2021 17:37:53 PAGE 6   

 300            * @brief  Êô∫ËÉΩÈÖçÁΩëÔºàÂèëÈÄÅÔºâ
 301            * @param  none
 302            * @return none
 303            * @note   none
 304            * @see    none
 305            */
 306          uint8_t wifi_net_connect_send(void)
 307          {
 308   1        uint8_t wifi_data[2];
 309   1        wifi_data[0] = WIFI_CMD_NET_CON;
 310   1        wifi_data[1] = 100;
 311   1        if (UH010_Write_Byte(wifi_data, 2) == 0)
 312   1          return 1;
 313   1        else
 314   1          return 0;
 315   1      }
 316          
 317          /**
 318            * @brief  AirkissÈÖçÁΩëÔºàÂèëÈÄÅÔºâ
 319            * @param  none
 320            * @return none
 321            * @note   none
 322            * @see    none
 323            */
 324          uint8_t wifi_net_airkiss_connect_send(void)
 325          {
 326   1        uint8_t wifi_data[2];
 327   1        wifi_data[0] = WIFI_CMD_AIRKISS_NET_CON;
 328   1        wifi_data[1] = 100;
 329   1        if (UH010_Write_Byte(wifi_data, 2) == 0)
 330   1          return 1;
 331   1        else
 332   1          return 0;
 333   1      }
 334          
 335          /**
 336            * @brief  ‰∫åÁª¥Á†ÅÈÖçÁΩëÔºàÂèëÈÄÅÔºâ
 337            * @param  none
 338            * @return none
 339            * @note   none
 340            * @see    none
 341            */
 342          uint8_t wifi_net_code_connect_send(void)
 343          {
 344   1        uint8_t wifi_data[2];
 345   1        wifi_data[0] = WIFI_CMD_CODE_NET_CON;
 346   1        wifi_data[1] = 100;
 347   1        if (UH010_Write_Byte(wifi_data, 2) == 0)
 348   1          return 1;
 349   1        else
 350   1          return 0;
 351   1      }
 352          
 353          /**
 354            * @brief  ÈÖçÁΩëÁä∂ÊÄÅÔºàÊé•Êî∂Ôºâ
 355            * @param  none
 356            * @return none
 357            * @note   none
 358            * @see    none
 359            */
 360          uint8_t wifi_net_connect_state(void)
 361          {
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/19/2021 17:37:53 PAGE 7   

 362   1        uint8_t wifi_data[2];
 363   1        uint8_t data_2[2] = {0};
 364   1        wifi_data[0] = WIFI_CMD_NET_STATE;
 365   1        wifi_data[1] = 100;
 366   1        UH010_Write_Byte(wifi_data, 2);
 367   1        delay_ms(50);
 368   1        UH010_ReadDatas(wifi_data, 0, data_2, 2);
 369   1        if (data_2[0] == 'I' && data_2[1] == 'O')
 370   1          return 1;
 371   1        if (data_2[0] == 'I' && data_2[1] == 'E')
 372   1          return 2;
 373   1        else
 374   1          return 0;
 375   1      }
 376          
 377          /**
 378            * @brief  Êü•ËØ¢ÁΩëÁªúÁä∂ÊÄÅ
 379            * @param  none
 380            * @return none
 381            * @note   none
 382            * @see    none
 383            */
 384          uint8_t wifi_check_net(void)
 385          {
 386   1        uint8_t wifi_data[2];
 387   1        uint8_t data_2[2] = {0};
 388   1        wifi_data[0] = WIFI_CMD_CHECK_NET;
 389   1        wifi_data[1] = 100;
 390   1        UH010_Write_Byte(wifi_data, 2);
 391   1        delay_ms(50);
 392   1        UH010_ReadDatas(wifi_data, 0, data_2, 2);
 393   1        if (data_2[0] == 'q' && data_2[1] == 'O')
 394   1          return 1;
 395   1        else
 396   1          return 0;
 397   1      }
 398          
 399          /**
 400            * @brief  ÊãçÁÖß
 401            * @param  none
 402            * @return none
 403            * @note   none
 404            * @see    none
 405            */
 406          uint8_t wifi_take_photos(void)
 407          {
 408   1        uint8_t wifi_data[2];
 409   1        wifi_data[0] = WIFI_CMD_TAKE_PHOTOS;
 410   1        wifi_data[1] = 100;
 411   1        UH010_Write_Byte(wifi_data, 2);
 412   1        return 1;
 413   1      }
 414          
 415          /**
 416            * @brief  ÂΩïÂÉè
 417            * @param  none
 418            * @return none
 419            * @note   none
 420            * @see    none
 421            */
 422          uint8_t wifi_take_videos(void)
 423          {
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/19/2021 17:37:53 PAGE 8   

 424   1        uint8_t wifi_data[2];
 425   1        wifi_data[0] = WIFI_CMD_TAKE_VIDEOS;
 426   1        wifi_data[1] = 100;
 427   1        UH010_Write_Byte(wifi_data, 2);
 428   1        return 1;
 429   1      }
 430          
 431          /**
 432            * @brief  ÂèëÈÄÅÊï∞ÊçÆÂåÖ
 433            * @param  cmd   ÂëΩ‰ª§
 434            * @param  pv    ÁîµÊµÅ
 435            * @param  index ÁºñÂè∑(0xff=null)
 436            * @return status
 437            * @note   none
 438            * @see    none
 439            */
 440          uint8_t wifi_data_package(uint8_t cmd, uint8_t pv, uint8_t index)
 441          {
 442   1        uint8_t wifi_data[3];
 443   1        wifi_data[0] = cmd;
 444   1        wifi_data[1] = pv;
 445   1        wifi_data[2] = index;
 446   1      
 447   1        if (index == 0xff)
 448   1          UH010_Write_Byte(wifi_data, 2);
 449   1        else
 450   1          UH010_Write_Byte(wifi_data, 3);
 451   1      
 452   1        return 1;
 453   1      }
 454          
 455          /**
 456            * @brief  ËøúÁ®ãÂºÄÈó®ÔºàÂèëÈÄÅÔºâ
 457            * @param  none
 458            * @return none
 459            * @note   none
 460            * @see    none
 461            */
 462          uint8_t wifi_open_ask(void)
 463          {
 464   1        uint8_t wifi_data[2];
 465   1        wifi_data[0] = WIFI_CMD_WF_OPEN_ASK;
 466   1        wifi_data[1] = 100;
 467   1        if (UH010_Write_Byte(wifi_data, 2) == 0)
 468   1          return 1;
 469   1        else
 470   1          return 0;
 471   1      }
 472          
 473          /**
 474            * @brief  ËøúÁ®ãÂºÄÈó®ÔºàÊé•Êî∂Ôºâ
 475            * @param  none
 476            * @return none
 477            * @note   none
 478            * @see    none
 479            */
 480          uint8_t wifi_open_reply_get(void)
 481          {
 482   1        uint8_t wifi_data[2];
 483   1        uint8_t data_2[2] = {0};
 484   1        wifi_data[0] = WIFI_CMD_WF_OPEN_REPLY;
 485   1        wifi_data[1] = 100;
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/19/2021 17:37:53 PAGE 9   

 486   1        UH010_Write_Byte(wifi_data, 2);
 487   1        delay_ms(300);
 488   1        UH010_ReadDatas(wifi_data, 0, data_2, 2);
 489   1      
 490   1        // printfV("data_2[0]", (int)data_2[0]);
 491   1        // printfV("data_2[1]", (int)data_2[1]);
 492   1      
 493   1        if (data_2[0] == 'K' && data_2[1] == 'O')
 494   1          return 1;
 495   1        else if (data_2[0] == 'K' && data_2[1] == 'E')
 496   1          return 2;
 497   1        else if (data_2[0] == 'K' && data_2[1] == 'K')
 498   1          return 3;
 499   1        else
 500   1          return 0;
 501   1      }
 502          
 503          /**
 504            * @brief  Ê∑ªÂä†Âà†Èô§ÂØÜÁ†Å/ÊåáÁ∫π/RFÂç°
 505            * @param  none
 506            * @return none
 507            * @note   none
 508            * @see    none
 509            */
 510          uint8_t wifi_cmd_add_del(void)
 511          {
 512   1        RET_VAL retval = 0;
 513   1        uint8_t wifi_data[2];
 514   1        uint8_t data_2[3] = {0};
 515   1        wifi_data[0] = WIFI_CMD_ADD_DEL;
 516   1        wifi_data[1] = 100;
 517   1        UH010_Write_Byte(wifi_data, 2);
 518   1        delay_ms(300);
 519   1        UH010_ReadDatas(wifi_data, 0, data_2, 3);
 520   1      
 521   1        // printfV("data_2[0]", (int)data_2[0]);
 522   1        // printfV("data_2[1]", (int)data_2[1]);
 523   1        // printfV("data_2[2]", (int)data_2[2]);
 524   1      
 525   1        if (data_2[0] == 'B')
 526   1        {
 527   2          switch (data_2[1])
 528   2          {
 529   3          case 'L':
 530   3            return 0;
 531   3          case 'E':
 532   3      #ifdef __LOCK_AUDIO_SUPPORT__
 533   3            mmi_dq_aud_play_with_id(AUD_BASE_ID_FAIL);
 534   3      #endif
 535   3            return 0xff;
 536   3          case 'M':
 537   3            wifi_add_flag = 1;
 538   3      #ifdef __LOCK_AUDIO_SUPPORT__
 539   3            mmi_dq_aud_play_with_id(AUD_ID_INPUT_68_PWD);
 540   3      #endif
 541   3            mmi_dq_ms_set_sys_state(SYS_STATUS_ADD_PWD);
 542   3            break;
 543   3      #ifdef __LOCK_FP_SUPPORT__
 544   3          case 'F':
 545   3            wifi_add_flag = 1;
 546   3      #ifdef __LOCK_AUDIO_SUPPORT__
 547   3            mmi_dq_aud_play_with_id(AUD_ID_PRESS_FP);
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/19/2021 17:37:53 PAGE 10  

 548   3      #endif
 549   3            mmi_dq_ms_set_sys_state(SYS_STATUS_ADD_FP);
 550   3            break;
 551   3      #endif
 552   3      #ifdef __LOCK_RFID_CARD_SUPPORT__
 553   3          case 'R':
 554   3            wifi_add_flag = 1;
 555   3      #ifdef __LOCK_AUDIO_SUPPORT__
 556   3            mmi_dq_aud_play_with_id(AUD_ID_PRESS_RFCARD);
 557   3      #endif
 558   3            mmi_dq_ms_set_sys_state(SYS_STATUS_ADD_RFID);
 559   3            break;
 560   3      #endif
 561   3          }
 562   2        }
 563   1        else if (data_2[0] == 'M' || data_2[0] == 'F' || data_2[0] == 'R')
 564   1        {
 565   2          if (data_2[2] == 0x00) //48 => 0,57 => 9
 566   2            get_index = data_2[1] - '0';
 567   2          else
 568   2            get_index = (data_2[1] - '0') * 10 + (data_2[2] - '0');
 569   2          // printfV("get_index", (int)get_index);
 570   2      
 571   2          switch (data_2[0])
 572   2          {
 573   3          case 'M':
 574   3            retval = mmi_dq_fs_del_pwd(get_index, FDS_USE_TYPE_USER);
 575   3            if (retval == RET_SUCESS)
 576   3            {
 577   4      #ifdef __LOCK_AUDIO_SUPPORT__
 578   4              mmi_dq_aud_play_with_id(AUD_ID_DEL_PWD_SUCESS);
 579   4      #endif
 580   4              mmi_dq_wifi_del_password(get_index);
 581   4            }
 582   3            else
 583   3      #ifdef __LOCK_AUDIO_SUPPORT__
 584   3              mmi_dq_aud_play_with_id(AUD_ID_DEL_FAIL);
 585   3      #endif
 586   3            break;
 587   3      #ifdef __LOCK_FP_SUPPORT__
 588   3          case 'F':
 589   3            retval = mmi_dq_fs_del_fp(get_index, FDS_USE_TYPE_USER);
 590   3            if (retval == RET_SUCESS)
 591   3              retval = mmi_dq_fp_delete((unsigned short)get_index);
 592   3            if (retval == 0)
 593   3            {
 594   4      #ifdef __LOCK_AUDIO_SUPPORT__
 595   4              mmi_dq_aud_play_with_id(AUD_ID_DEL_FP_SUCESS);
 596   4      #endif
 597   4              mmi_dq_wifi_del_fp(get_index);
 598   4            }
 599   3            else
 600   3      #ifdef __LOCK_AUDIO_SUPPORT__
 601   3              mmi_dq_aud_play_with_id(AUD_ID_DEL_FAIL);
 602   3      #endif
 603   3            break;
 604   3      #endif
 605   3      #ifdef __LOCK_RFID_CARD_SUPPORT__
 606   3          case 'R':
 607   3            retval = mmi_dq_fs_del_rfid(get_index);
 608   3            if (retval == RET_SUCESS)
 609   3            {
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/19/2021 17:37:53 PAGE 11  

 610   4      #ifdef __LOCK_AUDIO_SUPPORT__
 611   4              mmi_dq_aud_play_with_id(AUD_ID_DEL_RFCARD_SUCESS);
 612   4      #endif
 613   4              mmi_dq_wifi_del_rfid_suc(get_index);
 614   4            }
 615   3            else
 616   3      #ifdef __LOCK_AUDIO_SUPPORT__
 617   3              mmi_dq_aud_play_with_id(AUD_ID_DEL_FAIL);
 618   3      #endif
 619   3            break;
 620   3      #endif
 621   3          }
 622   2        }
 623   1        else
 624   1          return 0;
 625   1      
 626   1        return 1;
 627   1      }
 628          
 629          /**
 630            * @brief  Èó®Êú™ÂÖ≥
 631            * @param  none
 632            * @return none
 633            * @note   none
 634            * @see    none
 635            */
 636          void wifi_close_over_time(void)
 637          {
 638   1        uint8_t wifi_data[2];
 639   1        wifi_data[0] = WIFI_CMD_CLOSE_OVER_TIME;
 640   1        wifi_data[1] = 100;
 641   1        UH010_Write_Byte(wifi_data, 2);
 642   1      }
 643          
 644          /**
 645            * @brief  Âî§ÈÜí
 646            * @param  none
 647            * @return none
 648            * @note   none
 649            * @see    none
 650            */
 651          unsigned char wifi_wake_up(void)
 652          {
 653   1      
 654   1        uint8_t wifi_data[2];
 655   1        wifi_data[0] = WIFI_CMD_WAKEUP;
 656   1        wifi_data[1] = 100;
 657   1        return UH010_Write_Byte(wifi_data, 2);
 658   1      }
 659          
 660          /**
 661            * @brief  Áù°Áú†
 662            * @param  none
 663            * @return none
 664            * @note   none
 665            * @see    none
 666            */
 667          void wifi_sleep_mode(void)
 668          {
 669   1        uint8_t wifi_data[2];
 670   1        wifi_data[0] = WIFI_CMD_SLEEP;
 671   1        wifi_data[1] = 100;
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/19/2021 17:37:53 PAGE 12  

 672   1        UH010_Write_Byte(wifi_data, 2);
 673   1      }
 674          
 675          /**
 676            * @brief  Ê∑ªÂä†ÂØÜÁ†Å
 677            * @param  index
 678            * @return none
 679            * @note   none
 680            * @see    none
 681            */
 682          void wifi_add_password(uint8_t index)
 683          {
 684   1        uint8_t wifi_data[2];
 685   1        wifi_data[0] = WIFI_CMD_ADD_PW;
 686   1        wifi_data[1] = 100;
 687   1        wifi_data[2] = index;
 688   1        UH010_Write_Byte(wifi_data, 3);
 689   1      }
 690          
 691          /**
 692            * @brief  Âà†Èô§ÂØÜÁ†Å
 693            * @param  index
 694            * @return none
 695            * @note   none
 696            * @see    none
 697            */
 698          void wifi_del_password(uint8_t index)
 699          {
 700   1        uint8_t wifi_data[2];
 701   1        wifi_data[0] = WIFI_CMD_DEL_PW;
 702   1        wifi_data[1] = 100;
 703   1        wifi_data[2] = index;
 704   1        UH010_Write_Byte(wifi_data, 3);
 705   1      }
 706          
 707          /**
 708            * @brief  Ê∑ªÂä†ÊåáÁ∫π
 709            * @param  index
 710            * @return none
 711            * @note   none
 712            * @see    none
 713            */
 714          void wifi_add_fp(uint8_t index)
 715          {
 716   1        uint8_t wifi_data[2];
 717   1        wifi_data[0] = WIFI_CMD_ADD_FP;
 718   1        wifi_data[1] = 100;
 719   1        wifi_data[2] = index;
 720   1        UH010_Write_Byte(wifi_data, 3);
 721   1      }
 722          
 723          /**
 724            * @brief  Âà†Èô§ÊåáÁ∫π
 725            * @param  index
 726            * @return none
 727            * @note   none
 728            * @see    none
 729            */
 730          void wifi_del_fp(uint8_t index)
 731          {
 732   1        uint8_t wifi_data[2];
 733   1        wifi_data[0] = WIFI_CMD_DEL_FP;
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/19/2021 17:37:53 PAGE 13  

 734   1        wifi_data[1] = 100;
 735   1        wifi_data[2] = index;
 736   1        UH010_Write_Byte(wifi_data, 3);
 737   1      }
 738          
 739          /**
 740            * @brief  Ê∑ªÂä†RFÂç°
 741            * @param  index
 742            * @return none
 743            * @note   none
 744            * @see    none
 745            */
 746          void wifi_add_rf(uint8_t index)
 747          {
 748   1        uint8_t wifi_data[2];
 749   1        wifi_data[0] = WIFI_CMD_ADD_RF;
 750   1        wifi_data[1] = 100;
 751   1        wifi_data[2] = index;
 752   1        UH010_Write_Byte(wifi_data, 3);
 753   1      }
 754          
 755          /**
 756            * @brief  Âà†Èô§RFÂç°
 757            * @param  index
 758            * @return none
 759            * @note   none
 760            * @see    none
 761            */
 762          void wifi_del_rf(uint8_t index)
 763          {
 764   1        uint8_t wifi_data[2];
 765   1        wifi_data[0] = WIFI_CMD_DEL_RF;
 766   1        wifi_data[1] = 100;
 767   1        wifi_data[2] = index;
 768   1        UH010_Write_Byte(wifi_data, 3);
 769   1      }
 770          
 771          /**
 772            * @brief  ÂØÜÁ†ÅÂÖ®ÈÉ®Ê∏ÖÈô§
 773            * @param  none
 774            * @return none
 775            * @note   none
 776            * @see    none
 777            */
 778          void wifi_clr_pwd(void)
 779          {
 780   1        uint8_t wifi_data[2];
 781   1        wifi_data[0] = WIFI_CMD_CLR_PW;
 782   1        wifi_data[1] = 100;
 783   1        UH010_Write_Byte(wifi_data, 2);
 784   1      }
 785          
 786          /**
 787            * @brief  ÊåáÁ∫πÂÖ®ÈÉ®Ê∏ÖÈô§
 788            * @param  none
 789            * @return none
 790            * @note   none
 791            * @see    none
 792            */
 793          void wifi_clr_fp(void)
 794          {
 795   1        uint8_t wifi_data[2];
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/19/2021 17:37:53 PAGE 14  

 796   1        wifi_data[0] = WIFI_CMD_CLR_FP;
 797   1        wifi_data[1] = 100;
 798   1        UH010_Write_Byte(wifi_data, 2);
 799   1      }
 800          
 801          /**
 802            * @brief  RFÂç°ÂÖ®ÈÉ®Ê∏ÖÈô§
 803            * @param  none
 804            * @return none
 805            * @note   none
 806            * @see    none
 807            */
 808          void wifi_clr_rf(void)
 809          {
 810   1        uint8_t wifi_data[2];
 811   1        wifi_data[0] = WIFI_CMD_CLR_RF;
 812   1        wifi_data[1] = 100;
 813   1        UH010_Write_Byte(wifi_data, 2);
 814   1      }
 815          
 816          /**
 817            * @brief  ËøúÁ®ãÂºÄÈó®
 818            * @param  none
 819            * @return none
 820            * @note   none
 821            * @see    none
 822            */
 823          void wifi_open_by_wifi(void)
 824          {
 825   1        uint8_t wifi_data[2];
 826   1        wifi_data[0] = WIFI_CMD_WF_OPEN;
 827   1        wifi_data[1] = 100;
 828   1        UH010_Write_Byte(wifi_data, 2);
 829   1      }
 830          
 831          /**
 832            * @brief  ÂØÜÁ†ÅÂºÄÈó®
 833            * @param  index
 834            * @return none
 835            * @note   none
 836            * @see    none
 837            */
 838          void wifi_open_by_password(uint8_t index)
 839          {
 840   1        uint8_t wifi_data[3];
 841   1        wifi_data[0] = WIFI_CMD_PW_OPEN;
 842   1        wifi_data[1] = 100;
 843   1        wifi_data[2] = index;
 844   1        UH010_Write_Byte(wifi_data, 3);
 845   1      }
 846          
 847          /**
 848            * @brief  ÊåáÁ∫πÂºÄÈó®
 849            * @param  index
 850            * @return none
 851            * @note   none
 852            * @see    none
 853            */
 854          void wifi_open_by_fp(uint8_t index)
 855          {
 856   1        uint8_t wifi_data[2];
 857   1        wifi_data[0] = WIFI_CMD_FP_OPEN;
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/19/2021 17:37:53 PAGE 15  

 858   1        wifi_data[1] = 100;
 859   1        wifi_data[2] = index;
 860   1        UH010_Write_Byte(wifi_data, 3);
 861   1      }
 862          
 863          /**
 864            * @brief  RFÂç°ÊåáÁ∫π
 865            * @param  index
 866            * @return none
 867            * @note   none
 868            * @see    none
 869            */
 870          void wifi_open_by_rfid(uint8_t index)
 871          {
 872   1        uint8_t wifi_data[2];
 873   1        wifi_data[0] = WIFI_CMD_RF_OPEN;
 874   1        wifi_data[1] = 100;
 875   1        wifi_data[2] = index;
 876   1        UH010_Write_Byte(wifi_data, 3);
 877   1      }
 878          
 879          /**
 880            * @brief  Â∫îÊÄ•Èí•ÂåôÂºÄÈó®
 881            * @param  none
 882            * @return none
 883            * @note   none
 884            * @see    none
 885            */
 886          void wifi_open_by_key(void)
 887          {
 888   1        uint8_t wifi_data[2];
 889   1        wifi_data[0] = WIFI_CMD_KEY_OPEN;
 890   1        wifi_data[1] = 100;
 891   1        UH010_Write_Byte(wifi_data, 2);
 892   1      }
 893          
 894          /*
 895          parameter: 
 896            none
 897          return :
 898            none
 899          */
 900          void wifi_door_close(void)
 901          {
 902   1        uint8_t wifi_data[2];
 903   1        wifi_data[0] = WIFI_CMD_CLOSE;
 904   1        wifi_data[1] = 100;
 905   1        UH010_Write_Byte(wifi_data, 2);
 906   1      }
 907          
 908          /**
 909            * @brief  ÈúáÂä®Êä•Ë≠¶
 910            * @param  none
 911            * @return none
 912            * @note   none
 913            * @see    none
 914            */
 915          void wifi_via_alarm(void)
 916          {
 917   1        uint8_t wifi_data[2];
 918   1        wifi_data[0] = WIFI_CMD_VIA_ALARM;
 919   1        wifi_data[1] = 100;
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/19/2021 17:37:53 PAGE 16  

 920   1        UH010_Write_Byte(wifi_data, 2);
 921   1      }
 922          
 923          /**
 924            * @brief  Â§öÊ¨°ÂØÜÁ†ÅÈîôËØØ
 925            * @param  none
 926            * @return none
 927            * @note   none
 928            * @see    none
 929            */
 930          void wifi_pw_alarm(void)
 931          {
 932   1        uint8_t wifi_data[2];
 933   1        wifi_data[0] = WIFI_CMD_PW_ALARM;
 934   1        wifi_data[1] = 100;
 935   1        UH010_Write_Byte(wifi_data, 2);
 936   1      }
 937          
 938          /**
 939            * @brief  Â§öÊ¨°ÊåáÁ∫πÈîôËØØ
 940            * @param  none
 941            * @return none
 942            * @note   none
 943            * @see    none
 944            */
 945          void wifi_fp_alarm(void)
 946          {
 947   1        uint8_t wifi_data[2];
 948   1        wifi_data[0] = WIFI_CMD_FP_ALARM;
 949   1        wifi_data[1] = 100;
 950   1        UH010_Write_Byte(wifi_data, 2);
 951   1      }
 952          
 953          /**
 954            * @brief  Â§öÊ¨°RFÂç°ÈîôËØØ
 955            * @param  none
 956            * @return none
 957            * @note   none
 958            * @see    none
 959            */
 960          void wifi_rf_alarm(void)
 961          {
 962   1        uint8_t wifi_data[2];
 963   1        wifi_data[0] = WIFI_CMD_RF_ALARM;
 964   1        wifi_data[1] = 100;
 965   1        UH010_Write_Byte(wifi_data, 2);
 966   1      }
 967          
 968          /**
 969            * @brief  ‰ΩéÁîµÈáè
 970            * @param  none
 971            * @return none
 972            * @note   none
 973            * @see    none
 974            */
 975          void wifi_lowpower_alarm(void)
 976          {
 977   1        uint8_t wifi_data[2];
 978   1        wifi_data[0] = WIFI_CMD_LOWPOWER_ALARM;
 979   1        wifi_data[1] = 100;
 980   1        UH010_Write_Byte(wifi_data, 2);
 981   1      }
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/19/2021 17:37:53 PAGE 17  

 982          
 983          /**
 984            * @brief  ÊãçÁÖßÂΩïÂÉèÂºÄÂÖ≥ÔºàÂèëÈÄÅÔºâ
 985            * @param  none
 986            * @return none
 987            * @note   none
 988            * @see    none
 989            */
 990          void wifi_pv_switch_send(void)
 991          {
 992   1        uint8_t wifi_data[2];
 993   1        wifi_data[0] = WIFI_CMD_PV_SWITCH_SEND;
 994   1        wifi_data[1] = 100;
 995   1        UH010_Write_Byte(wifi_data, 2);
 996   1      }
 997          
 998          /**
 999            * @brief  ÊãçÁÖßÂΩïÂÉèÂºÄÂÖ≥ÔºàÊé•Êî∂Ôºâ
1000            * @param  none
1001            * @return none
1002            * @note   none
1003            * @see    none
1004            */
1005          uint8_t wifi_pv_switch_get(void)
1006          {
1007   1        uint8_t wifi_data[2];
1008   1        uint8_t data_2[2] = {0};
1009   1        wifi_data[0] = WIFI_CMD_PV_SWITCH_GET;
1010   1        wifi_data[1] = 100;
1011   1        UH010_Write_Byte(wifi_data, 2);
1012   1        delay_ms(300);
1013   1        UH010_ReadDatas(wifi_data, 0, data_2, 2);
1014   1        if (data_2[0] == 'J' && data_2[1] == 'E') //Êó†ÂìçÂ∫î
1015   1          return 0xff;
1016   1        else if (data_2[0] == 'J' && data_2[1] == '0') //ÂÖ≥Èó≠ÊãçÁÖßÂΩïÂÉè(ËÆæÂ§á‰πãÂêéÂºÄÈó®ÈÉΩ‰∏ç‰ºöÂèëÈÄÅÊãçÁ
             -ÖßÂíåÂΩïÂÉèÂëΩ‰ª§)
1017   1          return 0;
1018   1        else if (data_2[0] == 'J' && data_2[1] == '1') //ÂºÄÂêØÊãçÁÖßÂÖ≥Èó≠ÂΩïÂÉè
1019   1          return 1;
1020   1        else if (data_2[0] == 'J' && data_2[1] == '2') //ÂÖ≥Èó≠ÊãçÁÖßÂºÄÂêØÂΩïÂÉè
1021   1          return 2;
1022   1        else if (data_2[0] == 'J' && data_2[1] == '3') //ÂºÄÂêØÊãçÁÖßÂºÄÂêØÂΩïÂÉè
1023   1          return 3;
1024   1        else
1025   1          return 0xff;
1026   1      }
1027          
1028          void wifi_send_fp_110(void)
1029          {
1030   1        uint8_t wifi_data[2];
1031   1        wifi_data[0] = WIFI_CMD_WF_OPEN_FP_110;
1032   1        wifi_data[1] = 100;
1033   1        UH010_Write_Byte(wifi_data, 2);
1034   1      }
1035          
1036          void wifi_send_pwd_110(void)
1037          {
1038   1        uint8_t wifi_data[2];
1039   1        wifi_data[0] = WIFI_CMD_WF_OPEN_PSW_110;
1040   1        wifi_data[1] = 100;
1041   1        UH010_Write_Byte(wifi_data, 2);
1042   1      }
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/19/2021 17:37:53 PAGE 18  

1043          
1044          void wifi_set_110(void)
1045          {
1046   1        uint8_t wifi_data[2];
1047   1        wifi_data[0] = WIFI_CMD_WF_SET_110;
1048   1        wifi_data[1] = 100;
1049   1        UH010_Write_Byte(wifi_data, 2);
1050   1      }
1051          
1052          #endif
1053          #endif //__DQIOT_DRV_WIFI_C__


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2289    ----
   CONSTANT SIZE    =     11    ----
   XDATA SIZE       =      5     109
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
