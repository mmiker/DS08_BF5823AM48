C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 14:52:05 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE DQIOT_DRV_WIFI
OBJECT MODULE PLACED IN .\output\dqiot_drv_wifi.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE source\dqiot_drv_wifi.c LARGE OMF2 OPTIMIZE(8,SPEED) BROWSE INCDIR(.\inc
                    -lude;.\Library\byd_standard_peripheral\include;.\byd_api\byd_key\include;.\byd_api\byd_mifare\include;.\byd_tool_comm;.\
                    -byd_rfid;.\mmi_inc) DEBUG PRINT(.\list\dqiot_drv_wifi.lst) TABS(2) OBJECT(.\output\dqiot_drv_wifi.obj)

line level    source

   1          #ifndef __DQIOT_DRV_WIFI_C__
   2          #define __DQIOT_DRV_WIFI_C__
   3          #include "mmi_feature.h"
   4          #ifdef __LOCK_WIFI_SUPPORT__
   5          #include "dqiot_drv_wifi.h"
   6          #include "iic_master.h"
   7          #include "delay.h"
   8          #include "mmi_fs.h"
   9          #include "mmi_audio.h"
  10          #include "mmi_wifi.h"
  11          #include "mmi_fps.h"
  12          #include "mmi_ms.h"
  13          // #include <stdio.h>
  14          
  15          unsigned char wifi_add_flag = 0;
  16          extern unsigned char uart_get_buf[];
  17          extern unsigned char uart_getbuflen;
  18          // extern void printfS(char *show, char *status);
  19          // extern void printfV(char *show, int value);
  20          
  21          /**
  22            * @brief  GPIOÂàùÂßãÂåñ
  23            * @param  none
  24            * @return none
  25            * @note   none
  26            * @see    none
  27            */
  28          void dqiot_drv_wifi_gpio_init(void)
  29          {
  30   1        /*wifi
  31   1        UART0_TX  PF4 ËæìÂá∫
  32   1        UART0_RX  PF5 ËæìÂÖ•
  33   1        NRST_CTR  PF7 ‰æõÁîµ
  34   1        */
  35   1        gpio_init(FP_TX_PORT, FP_TX_PIN, GPIO_MODE_OUT);
  36   1        gpio_bit_set(FP_TX_PORT, FP_TX_PIN);
  37   1      
  38   1        gpio_init(FP_RX_PORT, FP_RX_PIN, GPIO_MODE_IPU);
  39   1        gpio_bit_set(FP_RX_PORT, FP_RX_PIN);
  40   1      
  41   1        gpio_init(FP_PWR_PORT, FP_PWR_PIN, GPIO_MODE_OUT);
  42   1        gpio_bit_set(FP_PWR_PORT, FP_PWR_PIN);
  43   1      
  44   1        return;
  45   1      }
  46          
  47          /**
  48            * @brief  GPIOÂèñÊ∂àÂàùÂßãÂåñ
  49            * @param  none
  50            * @return none
  51            * @note   none
  52            * @see    none
  53            */
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 14:52:05 PAGE 2   

  54          void dqiot_drv_wifi_gpio_deinit(void)
  55          {
  56   1        /*wifi
  57   1        UART0_TX  PF4 ËæìÂá∫
  58   1        UART0_RX  PF5 ËæìÂÖ•
  59   1        NRST_CTR  PF7 ‰æõÁîµ
  60   1        */
  61   1        gpio_init(FP_TX_PORT, FP_TX_PIN, GPIO_MODE_IN_FLOATING);
  62   1        gpio_bit_reset(FP_TX_PORT, FP_TX_PIN);
  63   1      
  64   1        gpio_init(FP_RX_PORT, FP_RX_PIN, GPIO_MODE_IN_FLOATING);
  65   1        gpio_bit_reset(FP_RX_PORT, FP_RX_PIN);
  66   1      
  67   1        gpio_init(FP_PWR_PORT, FP_PWR_PIN, GPIO_MODE_IN_FLOATING);
  68   1        gpio_bit_reset(FP_PWR_PORT, FP_PWR_PIN);
  69   1      
  70   1        return;
  71   1      }
  72          
  73          /**
  74            * @brief  ‰∏≤Âè£Êï∞ÊçÆÊé•Êî∂
  75            * @param  send    ÂèëÈÄÅÊï∞ÊçÆ
  76            * @param  send_len  ÂèëÈÄÅÊï∞ÊçÆÈïøÂ∫¶
  77            * @param  Buf     Êé•Êî∂Êï∞ÊçÆ
  78            * @param  len     Êé•Êî∂Êï∞ÊçÆÈïøÂ∫¶
  79            * @return ‰∏≤Âè£Êï∞ÊçÆ
  80            * @note   none
  81            * @see    none
  82            */
  83          uint8_t UH010_ReadDatas(uint8_t *send, uint8_t send_len, uint8_t *Buf, uint8_t len)
  84          {
  85   1      #if 0
                uint8_t i;
              
                if (send_len > 0)
                {
                  EA = 0;
                  iic_master_start();
              
                  if (iic_sendbyte_and_getnack(WIFI_ADDR))
                  {
                    //iic_master_stop();
                    //EA = 1;
                    //return 1;
                  }
              
                  for (i = 0; i < send_len; i++)
                  {
                    if (iic_sendbyte_and_getnack(send[i]))
                    {
                      //iic_master_stop();
                      //EA = 1;
                      //return 1;
                    }
                  }
              
                  if (iic_sendbyte_and_getnack(WIFI_ADDR | 0x01))
                  {
                    //iic_master_stop();
                    //EA = 1;
                    //return 1;
                  }
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 14:52:05 PAGE 3   

              
                  for (i = 0; i < len; i++)
                  {
                    Buf[i] = iic_receive_byte();
                    if (i == (len - 1))
                      break;
                    iic_respond(ACK);
                  }
              
                  iic_respond(NACK);
              
                  EA = 1;
                  iic_master_stop();
                }
                else
                {
                  EA = 0;
                  iic_master_start();
                  if (iic_sendbyte_and_getnack(WIFI_ADDR | 0x01))
                  {
                    //iic_master_stop();
                    //EA = 1;
                    //return 1;
                  }
              
                  for (i = 0; i < len; i++)
                  {
                    Buf[i] = iic_receive_byte();
                    if (i == (len - 1))
                      break;
                    iic_respond(ACK);
                  }
              
                  iic_respond(NACK);
              
                  EA = 1;
                  iic_master_stop();
                }
              
                return 0;
              #else
 157   1        uint8_t i = 0, j = 0;
 158   1        uint16_t waittime = 1000;
 159   1      
 160   1        if (send_len > 0)
 161   1        {
 162   2          EA = 0;
 163   2      
 164   2          for (i = 0; i < send_len; i++)
 165   2            uart_tx_byte(UART0, send[i]);
 166   2      
 167   2          while (--waittime)
 168   2          {
 169   3            delay_ms(1);
 170   3      
 171   3            if (uart_getbuflen >= 2)
 172   3            {
 173   4              /* ÂØªÊâæÂåÖÂ§¥ */
 174   4              for (i = 0; i < uart_getbuflen; i++)
 175   4              {
 176   5                if (uart_get_buf[i] == 'K' || uart_get_buf[i] == 'I' || uart_get_buf[i] == 'B' || uart_get_buf[i] == 
             -'F' || uart_get_buf[i] == 'R' || uart_get_buf[i] == 'M' || uart_get_buf[i] == 'J' || uart_get_buf[i] == 'q')
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 14:52:05 PAGE 4   

 177   5                  break;
 178   5              }
 179   4      
 180   4              for (i; i < uart_getbuflen; i++)
 181   4              {
 182   5                Buf[j] = uart_get_buf[i];
 183   5                if (j == (len - 1))
 184   5                  break;
 185   5                j++;
 186   5              }
 187   4      
 188   4              EA = 1;
 189   4              /* Ê∏ÖÁ©∫ÁºìÂ≠ò */
 190   4              uart_getbuflen = 0;
 191   4      
 192   4              return 0;
 193   4            }
 194   3          }
 195   2      
 196   2          EA = 1;
 197   2        }
 198   1        else
 199   1        {
 200   2          EA = 0;
 201   2      
 202   2          while (--waittime)
 203   2          {
 204   3            delay_ms(1);
 205   3      
 206   3            if (uart_getbuflen >= 2)
 207   3            {
 208   4              /* ÂØªÊâæÂåÖÂ§¥ */
 209   4              for (i = 0; i < uart_getbuflen; i++)
 210   4              {
 211   5                if (uart_get_buf[i] == 'K' || uart_get_buf[i] == 'I' || uart_get_buf[i] == 'B' || uart_get_buf[i] == 
             -'F' || uart_get_buf[i] == 'R' || uart_get_buf[i] == 'M' || uart_get_buf[i] == 'J' || uart_get_buf[i] == 'q')
 212   5                  break;
 213   5              }
 214   4      
 215   4              for (i; i < uart_getbuflen; i++)
 216   4              {
 217   5                Buf[j] = uart_get_buf[i];
 218   5                if (j == (len - 1))
 219   5                  break;
 220   5                j++;
 221   5              }
 222   4      
 223   4              EA = 1;
 224   4              /* Ê∏ÖÁ©∫ÁºìÂ≠ò */
 225   4              uart_getbuflen = 0;
 226   4      
 227   4              return 0;
 228   4            }
 229   3          }
 230   2      
 231   2          EA = 1;
 232   2        }
 233   1      
 234   1        return 0;
 235   1      #endif
 236   1      }
 237          
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 14:52:05 PAGE 5   

 238          /**
 239            * @brief  ‰∏≤Âè£Êï∞ÊçÆÂèëÁîü
 240            * @param  send    ÂèëÈÄÅÊï∞ÊçÆ
 241            * @param  send_len  ÂèëÈÄÅÊï∞ÊçÆÈïøÂ∫¶
 242            * @return none
 243            * @note   none
 244            * @see    none
 245            */
 246          uint8_t UH010_Write_Byte(uint8_t *send, uint8_t send_len)
 247          {
 248   1      #if 0
                uint8_t i;
              
                EA = 0;
                iic_master_start();
              
                if (iic_sendbyte_and_getnack(WIFI_ADDR & ~0x01))
                {
                  iic_master_stop();
                  EA = 1;
                  return 1;
                }
              
                for (i = 0; i < send_len; i++)
                {
                  if (iic_sendbyte_and_getnack(send[i]))
                  {
                    iic_master_stop();
                    EA = 1;
                    return 1;
                  }
                }
                EA = 1;
                iic_master_stop();
              
                return 0;
              #else
 275   1        uint8_t i;
 276   1      
 277   1        uart_getbuflen = 0;
 278   1        EA = 0;
 279   1      
 280   1        for (i = 0; i < send_len; i++)
 281   1          uart_tx_byte(UART0, send[i]);
 282   1      
 283   1        EA = 1;
 284   1      
 285   1        return 0;
 286   1      #endif
 287   1      }
 288          
 289          /*
 290          parameter: 
 291            none
 292          return :
 293            none
 294          */
 295          void wifi_uh316_init(void)
 296          {
 297   1      }
 298          
 299          /**
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 14:52:05 PAGE 6   

 300            * @brief  Êô∫ËÉΩÈÖçÁΩëÔºàÂèëÈÄÅÔºâ
 301            * @param  none
 302            * @return none
 303            * @note   none
 304            * @see    none
 305            */
 306          uint8_t wifi_net_connect_send(void)
 307          {
 308   1        uint8_t wifi_data[2];
 309   1        wifi_data[0] = WIFI_CMD_NET_CON;
 310   1        wifi_data[1] = 100;
 311   1        if (UH010_Write_Byte(wifi_data, 2) == 0)
 312   1          return 1;
 313   1        else
 314   1          return 0;
 315   1      }
 316          
 317          /**
 318            * @brief  AirkissÈÖçÁΩëÔºàÂèëÈÄÅÔºâ
 319            * @param  none
 320            * @return none
 321            * @note   none
 322            * @see    none
 323            */
 324          uint8_t wifi_net_airkiss_connect_send(void)
 325          {
 326   1        uint8_t wifi_data[2];
 327   1        wifi_data[0] = WIFI_CMD_AIRKISS_NET_CON;
 328   1        wifi_data[1] = 100;
 329   1        if (UH010_Write_Byte(wifi_data, 2) == 0)
 330   1          return 1;
 331   1        else
 332   1          return 0;
 333   1      }
 334          
 335          /**
 336            * @brief  ‰∫åÁª¥Á†ÅÈÖçÁΩëÔºàÂèëÈÄÅÔºâ
 337            * @param  none
 338            * @return none
 339            * @note   none
 340            * @see    none
 341            */
 342          uint8_t wifi_net_code_connect_send(void)
 343          {
 344   1        uint8_t wifi_data[2];
 345   1        wifi_data[0] = WIFI_CMD_CODE_NET_CON;
 346   1        wifi_data[1] = 100;
 347   1        if (UH010_Write_Byte(wifi_data, 2) == 0)
 348   1          return 1;
 349   1        else
 350   1          return 0;
 351   1      }
 352          
 353          /**
 354            * @brief  ÈÖçÁΩëÁä∂ÊÄÅÔºàÊé•Êî∂Ôºâ
 355            * @param  none
 356            * @return none
 357            * @note   none
 358            * @see    none
 359            */
 360          uint8_t wifi_net_connect_state(void)
 361          {
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 14:52:05 PAGE 7   

 362   1        uint8_t wifi_data[2];
 363   1        uint8_t data_2[2] = {0};
 364   1        wifi_data[0] = WIFI_CMD_NET_STATE;
 365   1        wifi_data[1] = 100;
 366   1        UH010_Write_Byte(wifi_data, 2);
 367   1        delay_ms(50);
 368   1        UH010_ReadDatas(wifi_data, 0, data_2, 2);
 369   1        if (data_2[0] == 'I' && data_2[1] == 'O')
 370   1          return 1;
 371   1        if (data_2[0] == 'I' && data_2[1] == 'E')
 372   1          return 2;
 373   1        else
 374   1          return 0;
 375   1      }
 376          
 377          /**
 378            * @brief  Êü•ËØ¢ÁΩëÁªúÁä∂ÊÄÅ
 379            * @param  none
 380            * @return none
 381            * @note   none
 382            * @see    none
 383            */
 384          uint8_t wifi_check_net(void)
 385          {
 386   1        uint8_t wifi_data[2];
 387   1        uint8_t data_2[2] = {0};
 388   1        wifi_data[0] = WIFI_CMD_CHECK_NET;
 389   1        wifi_data[1] = 100;
 390   1        UH010_Write_Byte(wifi_data, 2);
 391   1        delay_ms(50);
 392   1        UH010_ReadDatas(wifi_data, 0, data_2, 2);
 393   1        if (data_2[0] == 'q' && data_2[1] == 'O')
 394   1          return 1;
 395   1        else
 396   1          return 0;
 397   1      }
 398          
 399          /**
 400            * @brief  ÊãçÁÖß
 401            * @param  none
 402            * @return none
 403            * @note   none
 404            * @see    none
 405            */
 406          uint8_t wifi_take_photos(void)
 407          {
 408   1        uint8_t wifi_data[2];
 409   1        wifi_data[0] = WIFI_CMD_TAKE_PHOTOS;
 410   1        wifi_data[1] = 100;
 411   1        UH010_Write_Byte(wifi_data, 2);
 412   1        return 1;
 413   1      }
 414          
 415          /**
 416            * @brief  ÂΩïÂÉè
 417            * @param  none
 418            * @return none
 419            * @note   none
 420            * @see    none
 421            */
 422          uint8_t wifi_take_videos(void)
 423          {
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 14:52:05 PAGE 8   

 424   1        uint8_t wifi_data[2];
 425   1        wifi_data[0] = WIFI_CMD_TAKE_VIDEOS;
 426   1        wifi_data[1] = 100;
 427   1        UH010_Write_Byte(wifi_data, 2);
 428   1        return 1;
 429   1      }
 430          
 431          /**
 432            * @brief  ÂèëÈÄÅÊï∞ÊçÆÂåÖ
 433            * @param  cmd   ÂëΩ‰ª§
 434            * @param  pv    ÁîµÊµÅ
 435            * @param  index ÁºñÂè∑(0xff=null)
 436            * @return status
 437            * @note   none
 438            * @see    none
 439            */
 440          uint8_t wifi_data_package(uint8_t cmd, uint8_t pv, uint8_t index)
 441          {
 442   1        uint8_t wifi_data[3];
 443   1        wifi_data[0] = cmd;
 444   1        wifi_data[1] = pv;
 445   1        wifi_data[2] = index;
 446   1      
 447   1        if (index == 0xff)
 448   1          UH010_Write_Byte(wifi_data, 2);
 449   1        else
 450   1          UH010_Write_Byte(wifi_data, 3);
 451   1      
 452   1        return 1;
 453   1      }
 454          
 455          /**
 456            * @brief  ËøúÁ®ãÂºÄÈó®ÔºàÂèëÈÄÅÔºâ
 457            * @param  none
 458            * @return none
 459            * @note   none
 460            * @see    none
 461            */
 462          uint8_t wifi_open_ask(void)
 463          {
 464   1        uint8_t wifi_data[2];
 465   1        wifi_data[0] = WIFI_CMD_WF_OPEN_ASK;
 466   1        wifi_data[1] = 100;
 467   1        if (UH010_Write_Byte(wifi_data, 2) == 0)
 468   1          return 1;
 469   1        else
 470   1          return 0;
 471   1      }
 472          
 473          /**
 474            * @brief  ËøúÁ®ãÂºÄÈó®ÔºàÊé•Êî∂Ôºâ
 475            * @param  none
 476            * @return none
 477            * @note   none
 478            * @see    none
 479            */
 480          uint8_t wifi_open_reply_get(void)
 481          {
 482   1        uint8_t wifi_data[2];
 483   1        uint8_t data_2[2] = {0};
 484   1        wifi_data[0] = WIFI_CMD_WF_OPEN_REPLY;
 485   1        wifi_data[1] = 100;
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 14:52:05 PAGE 9   

 486   1        UH010_Write_Byte(wifi_data, 2);
 487   1        delay_ms(300);
 488   1        UH010_ReadDatas(wifi_data, 0, data_2, 2);
 489   1      
 490   1        // printfV("data_2[0]", (int)data_2[0]);
 491   1        // printfV("data_2[1]", (int)data_2[1]);
 492   1      
 493   1        if (data_2[0] == 'K' && data_2[1] == 'O')
 494   1          return 1;
 495   1        else if (data_2[0] == 'K' && data_2[1] == 'E')
 496   1          return 2;
 497   1        else if (data_2[0] == 'K' && data_2[1] == 'K')
 498   1          return 3;
 499   1        else
 500   1          return 0;
 501   1      }
 502          
 503          /**
 504            * @brief  Ê∑ªÂä†Âà†Èô§ÂØÜÁ†Å/ÊåáÁ∫π/RFÂç°
 505            * @param  none
 506            * @return none
 507            * @note   none
 508            * @see    none
 509            */
 510          uint8_t wifi_cmd_add_del(void)
 511          {
 512   1        RET_VAL retval = 0xff;
 513   1        uint8_t wifi_data[2];
 514   1        uint8_t data_2[3] = {0};
 515   1        wifi_data[0] = WIFI_CMD_ADD_DEL;
 516   1        wifi_data[1] = 100;
 517   1        UH010_Write_Byte(wifi_data, 2);
 518   1        delay_ms(400);
 519   1        UH010_ReadDatas(wifi_data, 0, data_2, 3);
 520   1      
 521   1        if (data_2[0] == 'B')
 522   1        {
 523   2          switch (data_2[1])
 524   2          {
 525   3          case 'L':
 526   3            return 0xff;
 527   3          case 'E':
 528   3      #ifdef __LOCK_AUDIO_SUPPORT__
 529   3            mmi_dq_aud_play_with_id(AUD_BASE_ID_FAIL);
 530   3      #endif
 531   3            return 0xff;
 532   3          case 'M':
 533   3            wifi_add_flag = 1;
 534   3      #ifdef __LOCK_AUDIO_SUPPORT__
 535   3            mmi_dq_aud_play_with_id(AUD_ID_INPUT_68_PWD);
 536   3      #endif
 537   3            mmi_dq_ms_set_sys_state(SYS_STATUS_ADD_PWD);
 538   3            break;
 539   3      #ifdef __LOCK_FP_SUPPORT__
 540   3          case 'F':
 541   3            wifi_add_flag = 1;
 542   3      #ifdef __LOCK_AUDIO_SUPPORT__
 543   3            mmi_dq_aud_play_with_id(AUD_ID_PRESS_FP);
 544   3      #endif
 545   3            mmi_dq_ms_set_sys_state(SYS_STATUS_ADD_FP);
 546   3            break;
 547   3      #endif
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 14:52:05 PAGE 10  

 548   3      #ifdef __LOCK_RFID_CARD_SUPPORT__
 549   3          case 'R':
 550   3            wifi_add_flag = 1;
 551   3      #ifdef __LOCK_AUDIO_SUPPORT__
 552   3            mmi_dq_aud_play_with_id(AUD_ID_PRESS_RFCARD);
 553   3      #endif
 554   3            mmi_dq_ms_set_sys_state(SYS_STATUS_ADD_RFID);
 555   3            break;
 556   3      #endif
 557   3          default:
 558   3            return 0xff;
 559   3          }
 560   2        }
 561   1        else if (data_2[0] == 'M' || data_2[0] == 'F' || data_2[0] == 'R')
 562   1        {
 563   2          if (data_2[2] == 0x00) //48 => 0,57 => 9
 564   2            get_index = data_2[1] - '0';
 565   2          else
 566   2            get_index = (data_2[1] - '0') * 10 + (data_2[2] - '0');
 567   2      
 568   2          switch (data_2[0])
 569   2          {
 570   3          case 'M':
 571   3            retval = mmi_dq_fs_del_pwd(get_index, FDS_USE_TYPE_USER);
 572   3            if (retval == RET_SUCESS)
 573   3            {
 574   4      #ifdef __LOCK_AUDIO_SUPPORT__
 575   4              mmi_dq_aud_play_with_id(AUD_ID_DEL_PWD_SUCESS);
 576   4      #endif
 577   4              mmi_dq_wifi_del_password(get_index);
 578   4            }
 579   3            else
 580   3      #ifdef __LOCK_AUDIO_SUPPORT__
 581   3              mmi_dq_aud_play_with_id(AUD_ID_DEL_FAIL)
 582   3      #endif
 583   3                ;
 584   3            break;
 585   3      #ifdef __LOCK_FP_SUPPORT__
 586   3          case 'F':
 587   3            retval = mmi_dq_fs_del_fp(get_index, FDS_USE_TYPE_USER);
 588   3            if (retval == RET_SUCESS)
 589   3              retval = mmi_dq_fp_delete((unsigned short)get_index);
 590   3            if (retval == 0)
 591   3            {
 592   4      #ifdef __LOCK_AUDIO_SUPPORT__
 593   4              mmi_dq_aud_play_with_id(AUD_ID_DEL_FP_SUCESS);
 594   4      #endif
 595   4              mmi_dq_wifi_del_fp(get_index);
 596   4            }
 597   3            else
 598   3      #ifdef __LOCK_AUDIO_SUPPORT__
 599   3              mmi_dq_aud_play_with_id(AUD_ID_DEL_FAIL)
 600   3      #endif
 601   3                ;
 602   3            break;
 603   3      #endif
 604   3      #ifdef __LOCK_RFID_CARD_SUPPORT__
 605   3          case 'R':
 606   3            retval = mmi_dq_fs_del_rfid(get_index);
 607   3            if (retval == RET_SUCESS)
 608   3            {
 609   4      #ifdef __LOCK_AUDIO_SUPPORT__
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 14:52:05 PAGE 11  

 610   4              mmi_dq_aud_play_with_id(AUD_ID_DEL_RFCARD_SUCESS);
 611   4      #endif
 612   4              mmi_dq_wifi_del_rfid_suc(get_index);
 613   4            }
 614   3            else
 615   3      #ifdef __LOCK_AUDIO_SUPPORT__
 616   3              mmi_dq_aud_play_with_id(AUD_ID_DEL_FAIL)
 617   3      #endif
 618   3                ;
 619   3            break;
 620   3      #endif
 621   3          default:
 622   3            return 0xff;
 623   3          }
 624   2        }
 625   1        else
 626   1          return 1;
 627   1      
 628   1        return 0;
 629   1      }
 630          
 631          /**
 632            * @brief  Èó®Êú™ÂÖ≥
 633            * @param  none
 634            * @return none
 635            * @note   none
 636            * @see    none
 637            */
 638          void wifi_close_over_time(void)
 639          {
 640   1        uint8_t wifi_data[2];
 641   1        wifi_data[0] = WIFI_CMD_CLOSE_OVER_TIME;
 642   1        wifi_data[1] = 100;
 643   1        UH010_Write_Byte(wifi_data, 2);
 644   1      }
 645          
 646          /**
 647            * @brief  Âî§ÈÜí
 648            * @param  none
 649            * @return none
 650            * @note   none
 651            * @see    none
 652            */
 653          unsigned char wifi_wake_up(void)
 654          {
 655   1      
 656   1        uint8_t wifi_data[2];
 657   1        wifi_data[0] = WIFI_CMD_WAKEUP;
 658   1        wifi_data[1] = 100;
 659   1        return UH010_Write_Byte(wifi_data, 2);
 660   1      }
 661          
 662          /**
 663            * @brief  Áù°Áú†
 664            * @param  none
 665            * @return none
 666            * @note   none
 667            * @see    none
 668            */
 669          void wifi_sleep_mode(void)
 670          {
 671   1        uint8_t wifi_data[2];
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 14:52:05 PAGE 12  

 672   1        wifi_data[0] = WIFI_CMD_SLEEP;
 673   1        wifi_data[1] = 100;
 674   1        UH010_Write_Byte(wifi_data, 2);
 675   1      }
 676          
 677          /**
 678            * @brief  Ê∑ªÂä†ÂØÜÁ†Å
 679            * @param  index
 680            * @return none
 681            * @note   none
 682            * @see    none
 683            */
 684          void wifi_add_password(uint8_t index)
 685          {
 686   1        uint8_t wifi_data[3];
 687   1        wifi_data[0] = WIFI_CMD_ADD_PW;
 688   1        wifi_data[1] = 100;
 689   1        wifi_data[2] = index;
 690   1        UH010_Write_Byte(wifi_data, 3);
 691   1      }
 692          
 693          /**
 694            * @brief  Âà†Èô§ÂØÜÁ†Å
 695            * @param  index
 696            * @return none
 697            * @note   none
 698            * @see    none
 699            */
 700          void wifi_del_password(uint8_t index)
 701          {
 702   1        uint8_t wifi_data[3];
 703   1        wifi_data[0] = WIFI_CMD_DEL_PW;
 704   1        wifi_data[1] = 100;
 705   1        wifi_data[2] = index;
 706   1        UH010_Write_Byte(wifi_data, 3);
 707   1      }
 708          
 709          /**
 710            * @brief  Ê∑ªÂä†ÊåáÁ∫π
 711            * @param  index
 712            * @return none
 713            * @note   none
 714            * @see    none
 715            */
 716          void wifi_add_fp(uint8_t index)
 717          {
 718   1        uint8_t wifi_data[3];
 719   1        wifi_data[0] = WIFI_CMD_ADD_FP;
 720   1        wifi_data[1] = 100;
 721   1        wifi_data[2] = index;
 722   1        UH010_Write_Byte(wifi_data, 3);
 723   1      }
 724          
 725          /**
 726            * @brief  Âà†Èô§ÊåáÁ∫π
 727            * @param  index
 728            * @return none
 729            * @note   none
 730            * @see    none
 731            */
 732          void wifi_del_fp(uint8_t index)
 733          {
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 14:52:05 PAGE 13  

 734   1        uint8_t wifi_data[3];
 735   1        wifi_data[0] = WIFI_CMD_DEL_FP;
 736   1        wifi_data[1] = 100;
 737   1        wifi_data[2] = index;
 738   1        UH010_Write_Byte(wifi_data, 3);
 739   1      }
 740          
 741          /**
 742            * @brief  Ê∑ªÂä†RFÂç°
 743            * @param  index
 744            * @return none
 745            * @note   none
 746            * @see    none
 747            */
 748          void wifi_add_rf(uint8_t index)
 749          {
 750   1        uint8_t wifi_data[3];
 751   1        wifi_data[0] = WIFI_CMD_ADD_RF;
 752   1        wifi_data[1] = 100;
 753   1        wifi_data[2] = index;
 754   1        UH010_Write_Byte(wifi_data, 3);
 755   1      }
 756          
 757          /**
 758            * @brief  Âà†Èô§RFÂç°
 759            * @param  index
 760            * @return none
 761            * @note   none
 762            * @see    none
 763            */
 764          void wifi_del_rf(uint8_t index)
 765          {
 766   1        uint8_t wifi_data[3];
 767   1        wifi_data[0] = WIFI_CMD_DEL_RF;
 768   1        wifi_data[1] = 100;
 769   1        wifi_data[2] = index;
 770   1        UH010_Write_Byte(wifi_data, 3);
 771   1      }
 772          
 773          /**
 774            * @brief  ÂØÜÁ†ÅÂÖ®ÈÉ®Ê∏ÖÈô§
 775            * @param  none
 776            * @return none
 777            * @note   none
 778            * @see    none
 779            */
 780          void wifi_clr_pwd(void)
 781          {
 782   1        uint8_t wifi_data[2];
 783   1        wifi_data[0] = WIFI_CMD_CLR_PW;
 784   1        wifi_data[1] = 100;
 785   1        UH010_Write_Byte(wifi_data, 2);
 786   1      }
 787          
 788          /**
 789            * @brief  ÊåáÁ∫πÂÖ®ÈÉ®Ê∏ÖÈô§
 790            * @param  none
 791            * @return none
 792            * @note   none
 793            * @see    none
 794            */
 795          void wifi_clr_fp(void)
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 14:52:05 PAGE 14  

 796          {
 797   1        uint8_t wifi_data[2];
 798   1        wifi_data[0] = WIFI_CMD_CLR_FP;
 799   1        wifi_data[1] = 100;
 800   1        UH010_Write_Byte(wifi_data, 2);
 801   1      }
 802          
 803          /**
 804            * @brief  RFÂç°ÂÖ®ÈÉ®Ê∏ÖÈô§
 805            * @param  none
 806            * @return none
 807            * @note   none
 808            * @see    none
 809            */
 810          void wifi_clr_rf(void)
 811          {
 812   1        uint8_t wifi_data[2];
 813   1        wifi_data[0] = WIFI_CMD_CLR_RF;
 814   1        wifi_data[1] = 100;
 815   1        UH010_Write_Byte(wifi_data, 2);
 816   1      }
 817          
 818          /**
 819            * @brief  ËøúÁ®ãÂºÄÈó®
 820            * @param  none
 821            * @return none
 822            * @note   none
 823            * @see    none
 824            */
 825          void wifi_open_by_wifi(void)
 826          {
 827   1        uint8_t wifi_data[2];
 828   1        wifi_data[0] = WIFI_CMD_WF_OPEN;
 829   1        wifi_data[1] = 100;
 830   1        UH010_Write_Byte(wifi_data, 2);
 831   1      }
 832          
 833          /**
 834            * @brief  ÂØÜÁ†ÅÂºÄÈó®
 835            * @param  index
 836            * @return none
 837            * @note   none
 838            * @see    none
 839            */
 840          void wifi_open_by_password(uint8_t index)
 841          {
 842   1        uint8_t wifi_data[3];
 843   1        wifi_data[0] = WIFI_CMD_PW_OPEN;
 844   1        wifi_data[1] = 100;
 845   1        wifi_data[2] = index;
 846   1        UH010_Write_Byte(wifi_data, 3);
 847   1      }
 848          
 849          /**
 850            * @brief  ÊåáÁ∫πÂºÄÈó®
 851            * @param  index
 852            * @return none
 853            * @note   none
 854            * @see    none
 855            */
 856          void wifi_open_by_fp(uint8_t index)
 857          {
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 14:52:05 PAGE 15  

 858   1        uint8_t wifi_data[3];
 859   1        wifi_data[0] = WIFI_CMD_FP_OPEN;
 860   1        wifi_data[1] = 100;
 861   1        wifi_data[2] = index;
 862   1        UH010_Write_Byte(wifi_data, 3);
 863   1      }
 864          
 865          /**
 866            * @brief  RFÂç°ÊåáÁ∫π
 867            * @param  index
 868            * @return none
 869            * @note   none
 870            * @see    none
 871            */
 872          void wifi_open_by_rfid(uint8_t index)
 873          {
 874   1        uint8_t wifi_data[3];
 875   1        wifi_data[0] = WIFI_CMD_RF_OPEN;
 876   1        wifi_data[1] = 100;
 877   1        wifi_data[2] = index;
 878   1        UH010_Write_Byte(wifi_data, 3);
 879   1      }
 880          
 881          /**
 882            * @brief  Â∫îÊÄ•Èí•ÂåôÂºÄÈó®
 883            * @param  none
 884            * @return none
 885            * @note   none
 886            * @see    none
 887            */
 888          void wifi_open_by_key(void)
 889          {
 890   1        uint8_t wifi_data[2];
 891   1        wifi_data[0] = WIFI_CMD_KEY_OPEN;
 892   1        wifi_data[1] = 100;
 893   1        UH010_Write_Byte(wifi_data, 2);
 894   1      }
 895          
 896          /*
 897          parameter: 
 898            none
 899          return :
 900            none
 901          */
 902          void wifi_door_close(void)
 903          {
 904   1        uint8_t wifi_data[2];
 905   1        wifi_data[0] = WIFI_CMD_CLOSE;
 906   1        wifi_data[1] = 100;
 907   1        UH010_Write_Byte(wifi_data, 2);
 908   1      }
 909          
 910          /**
 911            * @brief  ÈúáÂä®Êä•Ë≠¶
 912            * @param  none
 913            * @return none
 914            * @note   none
 915            * @see    none
 916            */
 917          void wifi_via_alarm(void)
 918          {
 919   1        uint8_t wifi_data[2];
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 14:52:05 PAGE 16  

 920   1        wifi_data[0] = WIFI_CMD_VIA_ALARM;
 921   1        wifi_data[1] = 100;
 922   1        UH010_Write_Byte(wifi_data, 2);
 923   1      }
 924          
 925          /**
 926            * @brief  Â§öÊ¨°ÂØÜÁ†ÅÈîôËØØ
 927            * @param  none
 928            * @return none
 929            * @note   none
 930            * @see    none
 931            */
 932          void wifi_pw_alarm(void)
 933          {
 934   1        uint8_t wifi_data[2];
 935   1        wifi_data[0] = WIFI_CMD_PW_ALARM;
 936   1        wifi_data[1] = 100;
 937   1        UH010_Write_Byte(wifi_data, 2);
 938   1      }
 939          
 940          /**
 941            * @brief  Â§öÊ¨°ÊåáÁ∫πÈîôËØØ
 942            * @param  none
 943            * @return none
 944            * @note   none
 945            * @see    none
 946            */
 947          void wifi_fp_alarm(void)
 948          {
 949   1        uint8_t wifi_data[2];
 950   1        wifi_data[0] = WIFI_CMD_FP_ALARM;
 951   1        wifi_data[1] = 100;
 952   1        UH010_Write_Byte(wifi_data, 2);
 953   1      }
 954          
 955          /**
 956            * @brief  Â§öÊ¨°RFÂç°ÈîôËØØ
 957            * @param  none
 958            * @return none
 959            * @note   none
 960            * @see    none
 961            */
 962          void wifi_rf_alarm(void)
 963          {
 964   1        uint8_t wifi_data[2];
 965   1        wifi_data[0] = WIFI_CMD_RF_ALARM;
 966   1        wifi_data[1] = 100;
 967   1        UH010_Write_Byte(wifi_data, 2);
 968   1      }
 969          
 970          /**
 971            * @brief  ‰ΩéÁîµÈáè
 972            * @param  none
 973            * @return none
 974            * @note   none
 975            * @see    none
 976            */
 977          void wifi_lowpower_alarm(void)
 978          {
 979   1        uint8_t wifi_data[2];
 980   1        wifi_data[0] = WIFI_CMD_LOWPOWER_ALARM;
 981   1        wifi_data[1] = 100;
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 14:52:05 PAGE 17  

 982   1        UH010_Write_Byte(wifi_data, 2);
 983   1      }
 984          
 985          /**
 986            * @brief  ÊãçÁÖßÂΩïÂÉèÂºÄÂÖ≥ÔºàÂèëÈÄÅÔºâ
 987            * @param  none
 988            * @return none
 989            * @note   none
 990            * @see    none
 991            */
 992          void wifi_pv_switch_send(void)
 993          {
 994   1        uint8_t wifi_data[2];
 995   1        wifi_data[0] = WIFI_CMD_PV_SWITCH_SEND;
 996   1        wifi_data[1] = 100;
 997   1        UH010_Write_Byte(wifi_data, 2);
 998   1      }
 999          
1000          /**
1001            * @brief  ÊãçÁÖßÂΩïÂÉèÂºÄÂÖ≥ÔºàÊé•Êî∂Ôºâ
1002            * @param  none
1003            * @return none
1004            * @note   none
1005            * @see    none
1006            */
1007          uint8_t wifi_pv_switch_get(void)
1008          {
1009   1        uint8_t wifi_data[2];
1010   1        uint8_t data_2[2] = {0};
1011   1        wifi_data[0] = WIFI_CMD_PV_SWITCH_GET;
1012   1        wifi_data[1] = 100;
1013   1        UH010_Write_Byte(wifi_data, 2);
1014   1        delay_ms(400);
1015   1        UH010_ReadDatas(wifi_data, 0, data_2, 2);
1016   1        if (data_2[0] == 'J' && data_2[1] == 'E') //Êó†ÂìçÂ∫î
1017   1          return 0xff;
1018   1        else if (data_2[0] == 'J' && data_2[1] == '0') //ÂÖ≥Èó≠ÊãçÁÖßÂΩïÂÉè(ËÆæÂ§á‰πãÂêéÂºÄÈó®ÈÉΩ‰∏ç‰ºöÂèëÈÄÅÊãçÁ
             -ÖßÂíåÂΩïÂÉèÂëΩ‰ª§)
1019   1          return 0;
1020   1        else if (data_2[0] == 'J' && data_2[1] == '1') //ÂºÄÂêØÊãçÁÖßÂÖ≥Èó≠ÂΩïÂÉè
1021   1          return 1;
1022   1        else if (data_2[0] == 'J' && data_2[1] == '2') //ÂÖ≥Èó≠ÊãçÁÖßÂºÄÂêØÂΩïÂÉè
1023   1          return 2;
1024   1        else if (data_2[0] == 'J' && data_2[1] == '3') //ÂºÄÂêØÊãçÁÖßÂºÄÂêØÂΩïÂÉè
1025   1          return 3;
1026   1        else
1027   1          return 0xff;
1028   1      }
1029          
1030          void wifi_send_fp_110(void)
1031          {
1032   1        uint8_t wifi_data[2];
1033   1        wifi_data[0] = WIFI_CMD_WF_OPEN_FP_110;
1034   1        wifi_data[1] = 100;
1035   1        UH010_Write_Byte(wifi_data, 2);
1036   1      }
1037          
1038          void wifi_send_pwd_110(void)
1039          {
1040   1        uint8_t wifi_data[2];
1041   1        wifi_data[0] = WIFI_CMD_WF_OPEN_PSW_110;
1042   1        wifi_data[1] = 100;
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 14:52:05 PAGE 18  

1043   1        UH010_Write_Byte(wifi_data, 2);
1044   1      }
1045          
1046          void wifi_set_110(void)
1047          {
1048   1        uint8_t wifi_data[2];
1049   1        wifi_data[0] = WIFI_CMD_WF_SET_110;
1050   1        wifi_data[1] = 100;
1051   1        UH010_Write_Byte(wifi_data, 2);
1052   1      }
1053          
1054          #endif
1055          #endif //__DQIOT_DRV_WIFI_C__


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2307    ----
   CONSTANT SIZE    =     11    ----
   XDATA SIZE       =      5     117
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
