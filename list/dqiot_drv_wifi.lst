C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 16:21:04 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE DQIOT_DRV_WIFI
OBJECT MODULE PLACED IN .\output\dqiot_drv_wifi.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE source\dqiot_drv_wifi.c LARGE OMF2 OPTIMIZE(8,SPEED) BROWSE INCDIR(.\inc
                    -lude;.\Library\byd_standard_peripheral\include;.\byd_api\byd_key\include;.\byd_api\byd_mifare\include;.\byd_tool_comm;.\
                    -byd_rfid;.\mmi_inc) DEBUG PRINT(.\list\dqiot_drv_wifi.lst) TABS(2) OBJECT(.\output\dqiot_drv_wifi.obj)

line level    source

   1          #ifndef __DQIOT_DRV_WIFI_C__
   2          #define __DQIOT_DRV_WIFI_C__
   3          #include "mmi_feature.h"
   4          #ifdef __LOCK_WIFI_SUPPORT__
   5          #include "dqiot_drv_wifi.h"
   6          #include "iic_master.h"
   7          #include "delay.h"
   8          #include "mmi_fs.h"
   9          #include "mmi_audio.h"
  10          #include "mmi_wifi.h"
  11          #include "mmi_fps.h"
  12          #include "mmi_ms.h"
  13          // #include <stdio.h>
  14          
  15          unsigned char wifi_add_flag = 0;
  16          extern unsigned char uart_get_buf[];
  17          extern unsigned char uart_getbuflen;
  18          // extern void printfS(char *show, char *status);
  19          // extern void printfV(char *show, int value);
  20          
  21          /**
  22            * @brief  GPIOÂàùÂßãÂåñ
  23            * @param  none
  24            * @return none
  25            * @note   none
  26            * @see    none
  27            */
  28          void dqiot_drv_wifi_gpio_init(void)
  29          {
  30   1        /*wifi
  31   1        UART0_TX  PF4 ËæìÂá∫
  32   1        UART0_RX  PF5 ËæìÂÖ•
  33   1        NRST_CTR  PF7 ‰æõÁîµ
  34   1        */
  35   1        gpio_init(FP_TX_PORT, FP_TX_PIN, GPIO_MODE_OUT);
  36   1        gpio_bit_set(FP_TX_PORT, FP_TX_PIN);
  37   1      
  38   1        gpio_init(FP_RX_PORT, FP_RX_PIN, GPIO_MODE_IPU);
  39   1        gpio_bit_set(FP_RX_PORT, FP_RX_PIN);
  40   1      
  41   1        gpio_init(FP_PWR_PORT, FP_PWR_PIN, GPIO_MODE_OUT);
  42   1        gpio_bit_set(FP_PWR_PORT, FP_PWR_PIN);
  43   1      
  44   1        return;
  45   1      }
  46          
  47          /**
  48            * @brief  GPIOÂèñÊ∂àÂàùÂßãÂåñ
  49            * @param  none
  50            * @return none
  51            * @note   none
  52            * @see    none
  53            */
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 16:21:04 PAGE 2   

  54          void dqiot_drv_wifi_gpio_deinit(void)
  55          {
  56   1        /*wifi
  57   1        UART0_TX  PF4 ËæìÂá∫
  58   1        UART0_RX  PF5 ËæìÂÖ•
  59   1        NRST_CTR  PF7 ‰æõÁîµ
  60   1        */
  61   1        gpio_init(FP_TX_PORT, FP_TX_PIN, GPIO_MODE_IN_FLOATING);
  62   1        gpio_bit_reset(FP_TX_PORT, FP_TX_PIN);
  63   1      
  64   1        gpio_init(FP_RX_PORT, FP_RX_PIN, GPIO_MODE_IN_FLOATING);
  65   1        gpio_bit_reset(FP_RX_PORT, FP_RX_PIN);
  66   1      
  67   1        gpio_init(FP_PWR_PORT, FP_PWR_PIN, GPIO_MODE_IN_FLOATING);
  68   1        gpio_bit_reset(FP_PWR_PORT, FP_PWR_PIN);
  69   1      
  70   1        return;
  71   1      }
  72          
  73          /**
  74            * @brief  ‰∏≤Âè£Êï∞ÊçÆÊé•Êî∂
  75            * @param  send    ÂèëÈÄÅÊï∞ÊçÆ
  76            * @param  send_len  ÂèëÈÄÅÊï∞ÊçÆÈïøÂ∫¶
  77            * @param  Buf     Êé•Êî∂Êï∞ÊçÆ
  78            * @param  len     Êé•Êî∂Êï∞ÊçÆÈïøÂ∫¶
  79            * @return ‰∏≤Âè£Êï∞ÊçÆ
  80            * @note   none
  81            * @see    none
  82            */
  83          uint8_t UH010_ReadDatas(uint8_t *send, uint8_t send_len, uint8_t *Buf, uint8_t len)
  84          {
  85   1      #if 0
                uint8_t i;
              
                if (send_len > 0)
                {
                  EA = 0;
                  iic_master_start();
              
                  if (iic_sendbyte_and_getnack(WIFI_ADDR))
                  {
                    //iic_master_stop();
                    //EA = 1;
                    //return 1;
                  }
              
                  for (i = 0; i < send_len; i++)
                  {
                    if (iic_sendbyte_and_getnack(send[i]))
                    {
                      //iic_master_stop();
                      //EA = 1;
                      //return 1;
                    }
                  }
              
                  if (iic_sendbyte_and_getnack(WIFI_ADDR | 0x01))
                  {
                    //iic_master_stop();
                    //EA = 1;
                    //return 1;
                  }
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 16:21:04 PAGE 3   

              
                  for (i = 0; i < len; i++)
                  {
                    Buf[i] = iic_receive_byte();
                    if (i == (len - 1))
                      break;
                    iic_respond(ACK);
                  }
              
                  iic_respond(NACK);
              
                  EA = 1;
                  iic_master_stop();
                }
                else
                {
                  EA = 0;
                  iic_master_start();
                  if (iic_sendbyte_and_getnack(WIFI_ADDR | 0x01))
                  {
                    //iic_master_stop();
                    //EA = 1;
                    //return 1;
                  }
              
                  for (i = 0; i < len; i++)
                  {
                    Buf[i] = iic_receive_byte();
                    if (i == (len - 1))
                      break;
                    iic_respond(ACK);
                  }
              
                  iic_respond(NACK);
              
                  EA = 1;
                  iic_master_stop();
                }
              
                return 0;
              #else
 157   1        uint8_t i = 0, j = 0;
 158   1        uint16_t waittime = 1000;
 159   1      
 160   1        if (send_len > 0)
 161   1        {
 162   2          EA = 0;
 163   2      
 164   2          for (i = 0; i < send_len; i++)
 165   2            uart_tx_byte(UART0, send[i]);
 166   2      
 167   2          while (--waittime)
 168   2          {
 169   3            delay_ms(1);
 170   3      
 171   3            if (uart_getbuflen >= 2)
 172   3            {
 173   4              /* ÂØªÊâæÂåÖÂ§¥ */
 174   4              for (i = 0; i < uart_getbuflen; i++)
 175   4              {
 176   5                if (uart_get_buf[i] == 'K' || uart_get_buf[i] == 'I' || uart_get_buf[i] == 'B' || uart_get_buf[i] == 
             -'F' || uart_get_buf[i] == 'R' || uart_get_buf[i] == 'M' || uart_get_buf[i] == 'J' || uart_get_buf[i] == 'q')
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 16:21:04 PAGE 4   

 177   5                  break;
 178   5              }
 179   4      
 180   4              for (i; i < uart_getbuflen; i++)
 181   4              {
 182   5                Buf[j] = uart_get_buf[i];
 183   5                if (j == (len - 1))
 184   5                  break;
 185   5                j++;
 186   5              }
 187   4      
 188   4              EA = 1;
 189   4              /* Ê∏ÖÁ©∫ÁºìÂ≠ò */
 190   4              uart_getbuflen = 0;
 191   4      
 192   4              return 0;
 193   4            }
 194   3          }
 195   2      
 196   2          EA = 1;
 197   2        }
 198   1        else
 199   1        {
 200   2          EA = 0;
 201   2      
 202   2          while (--waittime)
 203   2          {
 204   3            delay_ms(1);
 205   3      
 206   3            if (uart_getbuflen >= 2)
 207   3            {
 208   4              /* ÂØªÊâæÂåÖÂ§¥ */
 209   4              for (i = 0; i < uart_getbuflen; i++)
 210   4              {
 211   5                if (uart_get_buf[i] == 'K' || uart_get_buf[i] == 'I' || uart_get_buf[i] == 'B' || uart_get_buf[i] == 
             -'F' || uart_get_buf[i] == 'R' || uart_get_buf[i] == 'M' || uart_get_buf[i] == 'J' || uart_get_buf[i] == 'q')
 212   5                  break;
 213   5              }
 214   4      
 215   4              for (i; i < uart_getbuflen; i++)
 216   4              {
 217   5                Buf[j] = uart_get_buf[i];
 218   5                if (j == (len - 1))
 219   5                  break;
 220   5                j++;
 221   5              }
 222   4      
 223   4              EA = 1;
 224   4              /* Ê∏ÖÁ©∫ÁºìÂ≠ò */
 225   4              uart_getbuflen = 0;
 226   4      
 227   4              return 0;
 228   4            }
 229   3          }
 230   2      
 231   2          EA = 1;
 232   2        }
 233   1      
 234   1        return 0;
 235   1      #endif
 236   1      }
 237          
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 16:21:04 PAGE 5   

 238          /**
 239            * @brief  ‰∏≤Âè£Êï∞ÊçÆÂèëÁîü
 240            * @param  send    ÂèëÈÄÅÊï∞ÊçÆ
 241            * @param  send_len  ÂèëÈÄÅÊï∞ÊçÆÈïøÂ∫¶
 242            * @return none
 243            * @note   none
 244            * @see    none
 245            */
 246          uint8_t UH010_Write_Byte(uint8_t *send, uint8_t send_len)
 247          {
 248   1      #if 0
                uint8_t i;
              
                EA = 0;
                iic_master_start();
              
                if (iic_sendbyte_and_getnack(WIFI_ADDR & ~0x01))
                {
                  iic_master_stop();
                  EA = 1;
                  return 1;
                }
              
                for (i = 0; i < send_len; i++)
                {
                  if (iic_sendbyte_and_getnack(send[i]))
                  {
                    iic_master_stop();
                    EA = 1;
                    return 1;
                  }
                }
                EA = 1;
                iic_master_stop();
              
                return 0;
              #else
 275   1        uint8_t i;
 276   1      
 277   1        uart_getbuflen = 0;
 278   1        EA = 0;
 279   1      
 280   1        for (i = 0; i < send_len; i++)
 281   1          uart_tx_byte(UART0, send[i]);
 282   1      
 283   1        EA = 1;
 284   1      
 285   1        return 0;
 286   1      #endif
 287   1      }
 288          
 289          /*
 290          parameter: 
 291            none
 292          return :
 293            none
 294          */
 295          void wifi_uh316_init(void)
 296          {
 297   1      }
 298          
 299          /**
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 16:21:04 PAGE 6   

 300            * @brief  Êô∫ËÉΩÈÖçÁΩëÔºàÂèëÈÄÅÔºâ
 301            * @param  none
 302            * @return none
 303            * @note   none
 304            * @see    none
 305            */
 306          uint8_t wifi_net_connect_send(void)
 307          {
 308   1        uint8_t wifi_data[2];
 309   1        wifi_data[0] = WIFI_CMD_NET_CON;
 310   1        wifi_data[1] = 100;
 311   1        if (UH010_Write_Byte(wifi_data, 2) == 0)
 312   1          return 1;
 313   1        else
 314   1          return 0;
 315   1      }
 316          
 317          /**
 318            * @brief  AirkissÈÖçÁΩëÔºàÂèëÈÄÅÔºâ
 319            * @param  none
 320            * @return none
 321            * @note   none
 322            * @see    none
 323            */
 324          uint8_t wifi_net_airkiss_connect_send(void)
 325          {
 326   1        uint8_t wifi_data[2];
 327   1        wifi_data[0] = WIFI_CMD_AIRKISS_NET_CON;
 328   1        wifi_data[1] = 100;
 329   1        if (UH010_Write_Byte(wifi_data, 2) == 0)
 330   1          return 1;
 331   1        else
 332   1          return 0;
 333   1      }
 334          
 335          /**
 336            * @brief  ‰∫åÁª¥Á†ÅÈÖçÁΩëÔºàÂèëÈÄÅÔºâ
 337            * @param  none
 338            * @return none
 339            * @note   none
 340            * @see    none
 341            */
 342          uint8_t wifi_net_code_connect_send(void)
 343          {
 344   1        uint8_t wifi_data[2];
 345   1        wifi_data[0] = WIFI_CMD_CODE_NET_CON;
 346   1        wifi_data[1] = 100;
 347   1        if (UH010_Write_Byte(wifi_data, 2) == 0)
 348   1          return 1;
 349   1        else
 350   1          return 0;
 351   1      }
 352          
 353          /**
 354            * @brief  ÈÖçÁΩëÁä∂ÊÄÅÔºàÊé•Êî∂Ôºâ
 355            * @param  none
 356            * @return none
 357            * @note   none
 358            * @see    none
 359            */
 360          uint8_t wifi_net_connect_state(void)
 361          {
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 16:21:04 PAGE 7   

 362   1        uint8_t wifi_data[2];
 363   1        uint8_t data_2[2] = {0};
 364   1        wifi_data[0] = WIFI_CMD_NET_STATE;
 365   1        wifi_data[1] = 100;
 366   1        UH010_Write_Byte(wifi_data, 2);
 367   1        delay_ms(50);
 368   1        UH010_ReadDatas(wifi_data, 0, data_2, 2);
 369   1        if (data_2[0] == 'I' && data_2[1] == 'O')
 370   1          return 1;
 371   1        if (data_2[0] == 'I' && data_2[1] == 'E')
 372   1          return 2;
 373   1        else
 374   1          return 0;
 375   1      }
 376          
 377          /**
 378            * @brief  Êü•ËØ¢ÁΩëÁªúÁä∂ÊÄÅ
 379            * @param  none
 380            * @return none
 381            * @note   none
 382            * @see    none
 383            */
 384          uint8_t wifi_check_net(void)
 385          {
 386   1        uint8_t wifi_data[2];
 387   1        uint8_t data_2[2] = {0};
 388   1        wifi_data[0] = WIFI_CMD_CHECK_NET;
 389   1        wifi_data[1] = 100;
 390   1        UH010_Write_Byte(wifi_data, 2);
 391   1        delay_ms(50);
 392   1        UH010_ReadDatas(wifi_data, 0, data_2, 2);
 393   1        if (data_2[0] == 'q' && data_2[1] == 'O')
 394   1          return 1;
 395   1        else
 396   1          return 0;
 397   1      }
 398          
 399          /**
 400            * @brief  ÊãçÁÖß
 401            * @param  none
 402            * @return none
 403            * @note   none
 404            * @see    none
 405            */
 406          uint8_t wifi_take_photos(void)
 407          {
 408   1        uint8_t wifi_data[2];
 409   1        wifi_data[0] = WIFI_CMD_TAKE_PHOTOS;
 410   1        wifi_data[1] = 100;
 411   1        UH010_Write_Byte(wifi_data, 2);
 412   1        return 1;
 413   1      }
 414          
 415          /**
 416            * @brief  ÂΩïÂÉè
 417            * @param  none
 418            * @return none
 419            * @note   none
 420            * @see    none
 421            */
 422          uint8_t wifi_take_videos(void)
 423          {
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 16:21:04 PAGE 8   

 424   1        uint8_t wifi_data[2];
 425   1        wifi_data[0] = WIFI_CMD_TAKE_VIDEOS;
 426   1        wifi_data[1] = 100;
 427   1        UH010_Write_Byte(wifi_data, 2);
 428   1        return 1;
 429   1      }
 430          
 431          /**
 432            * @brief  ÂèëÈÄÅÊï∞ÊçÆÂåÖ
 433            * @param  cmd   ÂëΩ‰ª§
 434            * @param  pv    ÁîµÊµÅ
 435            * @param  index ÁºñÂè∑(0xff=null)
 436            * @return status
 437            * @note   none
 438            * @see    none
 439            */
 440          uint8_t wifi_data_package(uint8_t cmd, uint8_t pv, uint8_t index)
 441          {
 442   1        uint8_t wifi_data[3];
 443   1        wifi_data[0] = cmd;
 444   1        wifi_data[1] = pv;
 445   1        wifi_data[2] = index;
 446   1      
 447   1        if (index == 0xff)
 448   1          UH010_Write_Byte(wifi_data, 2);
 449   1        else
 450   1          UH010_Write_Byte(wifi_data, 3);
 451   1      
 452   1        return 1;
 453   1      }
 454          
 455          /**
 456            * @brief  ËøúÁ®ãÂºÄÈó®ÔºàÂèëÈÄÅÔºâ
 457            * @param  none
 458            * @return none
 459            * @note   none
 460            * @see    none
 461            */
 462          uint8_t wifi_open_ask(void)
 463          {
 464   1        uint8_t wifi_data[2];
 465   1        wifi_data[0] = WIFI_CMD_WF_OPEN_ASK;
 466   1        wifi_data[1] = 100;
 467   1        if (UH010_Write_Byte(wifi_data, 2) == 0)
 468   1          return 1;
 469   1        else
 470   1          return 0;
 471   1      }
 472          
 473          /**
 474            * @brief  ËøúÁ®ãÂºÄÈó®ÔºàÊé•Êî∂Ôºâ
 475            * @param  none
 476            * @return none
 477            * @note   none
 478            * @see    none
 479            */
 480          uint8_t wifi_open_reply_get(void)
 481          {
 482   1        uint8_t wifi_data[2];
 483   1        uint8_t data_2[2] = {0};
 484   1        wifi_data[0] = WIFI_CMD_WF_OPEN_REPLY;
 485   1        wifi_data[1] = 100;
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 16:21:04 PAGE 9   

 486   1        UH010_Write_Byte(wifi_data, 2);
 487   1        delay_ms(300);
 488   1        UH010_ReadDatas(wifi_data, 0, data_2, 2);
 489   1      
 490   1        // printfV("data_2[0]", (int)data_2[0]);
 491   1        // printfV("data_2[1]", (int)data_2[1]);
 492   1      
 493   1        if (data_2[0] == 'K' && data_2[1] == 'O')
 494   1          return 1;
 495   1        else if (data_2[0] == 'K' && data_2[1] == 'E')
 496   1          return 2;
 497   1        else if (data_2[0] == 'K' && data_2[1] == 'K')
 498   1          return 3;
 499   1        else
 500   1          return 0;
 501   1      }
 502          
 503          /**
 504            * @brief  Ê∑ªÂä†Âà†Èô§ÂØÜÁ†Å/ÊåáÁ∫π/RFÂç°
 505            * @param  none
 506            * @return none
 507            * @note   none
 508            * @see    none
 509            */
 510          uint8_t wifi_cmd_add_del(void)
 511          {
 512   1        RET_VAL retval = 0xff;
 513   1        uint8_t wifi_data[2];
 514   1        uint8_t data_2[3] = {0};
 515   1        wifi_data[0] = WIFI_CMD_ADD_DEL;
 516   1        wifi_data[1] = 100;
 517   1        UH010_Write_Byte(wifi_data, 2);
 518   1        delay_ms(400);
 519   1        UH010_ReadDatas(wifi_data, 0, data_2, 3);
 520   1      
 521   1        if (data_2[0] == 'B')
 522   1        {
 523   2          switch (data_2[1])
 524   2          {
 525   3          case 'L':
 526   3            return 0xff;
 527   3      
 528   3          case 'E':
 529   3      #ifdef __LOCK_AUDIO_SUPPORT__
 530   3            mmi_dq_aud_play_with_id(AUD_BASE_ID_FAIL);
 531   3      #endif
 532   3            return 0xff;
 533   3      
 534   3          case 'M':
 535   3            wifi_add_flag = 1;
 536   3      #ifdef __LOCK_AUDIO_SUPPORT__
 537   3            mmi_dq_aud_play_with_id(AUD_ID_INPUT_68_PWD);
 538   3      #endif
 539   3            mmi_dq_ms_set_sys_state(SYS_STATUS_ADD_PWD);
 540   3            break;
 541   3      
 542   3          case 'F':
 543   3      #ifdef __LOCK_FP_SUPPORT__
                    wifi_add_flag = 1;
              #ifdef __LOCK_AUDIO_SUPPORT__
                    mmi_dq_aud_play_with_id(AUD_ID_PRESS_FP);
              #endif
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 16:21:04 PAGE 10  

                    mmi_dq_ms_set_sys_state(SYS_STATUS_ADD_FP);
              #else
 550   3            mmi_dq_aud_play_with_id(AUD_BASE_ID_FAIL);
 551   3      #endif
 552   3            break;
 553   3      
 554   3          case 'R':
 555   3      #ifdef __LOCK_RFID_CARD_SUPPORT__
 556   3            wifi_add_flag = 1;
 557   3      #ifdef __LOCK_AUDIO_SUPPORT__
 558   3            mmi_dq_aud_play_with_id(AUD_ID_PRESS_RFCARD);
 559   3      #endif
 560   3            mmi_dq_ms_set_sys_state(SYS_STATUS_ADD_RFID);
 561   3      #else
                    mmi_dq_aud_play_with_id(AUD_BASE_ID_FAIL);
              #endif
 564   3            break;
 565   3          }
 566   2        }
 567   1        else if (data_2[0] == 'M' || data_2[0] == 'F' || data_2[0] == 'R')
 568   1        {
 569   2          if (data_2[2] == 0x00) //48 => 0,57 => 9
 570   2            get_index = data_2[1] - '0';
 571   2          else
 572   2            get_index = (data_2[1] - '0') * 10 + (data_2[2] - '0');
 573   2      
 574   2          switch (data_2[0])
 575   2          {
 576   3          case 'M':
 577   3            retval = mmi_dq_fs_del_pwd(get_index, FDS_USE_TYPE_USER);
 578   3            if (retval == RET_SUCESS)
 579   3            {
 580   4      #ifdef __LOCK_AUDIO_SUPPORT__
 581   4              mmi_dq_aud_play_with_id(AUD_ID_DEL_PWD_SUCESS);
 582   4      #endif
 583   4              mmi_dq_wifi_del_password(get_index);
 584   4            }
 585   3            else
 586   3      #ifdef __LOCK_AUDIO_SUPPORT__
 587   3              mmi_dq_aud_play_with_id(AUD_ID_DEL_FAIL)
 588   3      #endif
 589   3                ;
 590   3            break;
 591   3      
 592   3          case 'F':
 593   3      #ifdef __LOCK_FP_SUPPORT__
                    retval = mmi_dq_fs_del_fp(get_index, FDS_USE_TYPE_USER);
                    if (retval == RET_SUCESS)
                      retval = mmi_dq_fp_delete((unsigned short)get_index);
                    if (retval == 0)
                    {
              #ifdef __LOCK_AUDIO_SUPPORT__
                      mmi_dq_aud_play_with_id(AUD_ID_DEL_FP_SUCESS);
              #endif
                      mmi_dq_wifi_del_fp(get_index);
                    }
                    else
              #ifdef __LOCK_AUDIO_SUPPORT__
                      mmi_dq_aud_play_with_id(AUD_ID_DEL_FAIL)
              #endif
                        ;
              #else
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 16:21:04 PAGE 11  

 610   3            mmi_dq_aud_play_with_id(AUD_BASE_ID_FAIL);
 611   3      #endif
 612   3            break;
 613   3      
 614   3          case 'R':
 615   3      #ifdef __LOCK_RFID_CARD_SUPPORT__
 616   3            retval = mmi_dq_fs_del_rfid(get_index);
 617   3            if (retval == RET_SUCESS)
 618   3            {
 619   4      #ifdef __LOCK_AUDIO_SUPPORT__
 620   4              mmi_dq_aud_play_with_id(AUD_ID_DEL_RFCARD_SUCESS);
 621   4      #endif
 622   4              mmi_dq_wifi_del_rfid_suc(get_index);
 623   4            }
 624   3            else
 625   3      #ifdef __LOCK_AUDIO_SUPPORT__
 626   3              mmi_dq_aud_play_with_id(AUD_ID_DEL_FAIL)
 627   3      #endif
 628   3                ;
 629   3      #else
                    mmi_dq_aud_play_with_id(AUD_BASE_ID_FAIL);
              #endif
 632   3            break;
 633   3          }
 634   2        }
 635   1        else
 636   1          return 1; //Á©∫ÂÄº
 637   1      
 638   1        return 0;
 639   1      }
 640          
 641          /**
 642            * @brief  Èó®Êú™ÂÖ≥
 643            * @param  none
 644            * @return none
 645            * @note   none
 646            * @see    none
 647            */
 648          void wifi_close_over_time(void)
 649          {
 650   1        uint8_t wifi_data[2];
 651   1        wifi_data[0] = WIFI_CMD_CLOSE_OVER_TIME;
 652   1        wifi_data[1] = 100;
 653   1        UH010_Write_Byte(wifi_data, 2);
 654   1      }
 655          
 656          /**
 657            * @brief  Âî§ÈÜí
 658            * @param  none
 659            * @return none
 660            * @note   none
 661            * @see    none
 662            */
 663          unsigned char wifi_wake_up(void)
 664          {
 665   1      
 666   1        uint8_t wifi_data[2];
 667   1        wifi_data[0] = WIFI_CMD_WAKEUP;
 668   1        wifi_data[1] = 100;
 669   1        return UH010_Write_Byte(wifi_data, 2);
 670   1      }
 671          
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 16:21:04 PAGE 12  

 672          /**
 673            * @brief  Áù°Áú†
 674            * @param  none
 675            * @return none
 676            * @note   none
 677            * @see    none
 678            */
 679          void wifi_sleep_mode(void)
 680          {
 681   1        uint8_t wifi_data[2];
 682   1        wifi_data[0] = WIFI_CMD_SLEEP;
 683   1        wifi_data[1] = 100;
 684   1        UH010_Write_Byte(wifi_data, 2);
 685   1      }
 686          
 687          /**
 688            * @brief  Ê∑ªÂä†ÂØÜÁ†Å
 689            * @param  index
 690            * @return none
 691            * @note   none
 692            * @see    none
 693            */
 694          void wifi_add_password(uint8_t index)
 695          {
 696   1        uint8_t wifi_data[3];
 697   1        wifi_data[0] = WIFI_CMD_ADD_PW;
 698   1        wifi_data[1] = 100;
 699   1        wifi_data[2] = index;
 700   1        UH010_Write_Byte(wifi_data, 3);
 701   1      }
 702          
 703          /**
 704            * @brief  Âà†Èô§ÂØÜÁ†Å
 705            * @param  index
 706            * @return none
 707            * @note   none
 708            * @see    none
 709            */
 710          void wifi_del_password(uint8_t index)
 711          {
 712   1        uint8_t wifi_data[3];
 713   1        wifi_data[0] = WIFI_CMD_DEL_PW;
 714   1        wifi_data[1] = 100;
 715   1        wifi_data[2] = index;
 716   1        UH010_Write_Byte(wifi_data, 3);
 717   1      }
 718          
 719          /**
 720            * @brief  Ê∑ªÂä†ÊåáÁ∫π
 721            * @param  index
 722            * @return none
 723            * @note   none
 724            * @see    none
 725            */
 726          void wifi_add_fp(uint8_t index)
 727          {
 728   1        uint8_t wifi_data[3];
 729   1        wifi_data[0] = WIFI_CMD_ADD_FP;
 730   1        wifi_data[1] = 100;
 731   1        wifi_data[2] = index;
 732   1        UH010_Write_Byte(wifi_data, 3);
 733   1      }
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 16:21:04 PAGE 13  

 734          
 735          /**
 736            * @brief  Âà†Èô§ÊåáÁ∫π
 737            * @param  index
 738            * @return none
 739            * @note   none
 740            * @see    none
 741            */
 742          void wifi_del_fp(uint8_t index)
 743          {
 744   1        uint8_t wifi_data[3];
 745   1        wifi_data[0] = WIFI_CMD_DEL_FP;
 746   1        wifi_data[1] = 100;
 747   1        wifi_data[2] = index;
 748   1        UH010_Write_Byte(wifi_data, 3);
 749   1      }
 750          
 751          /**
 752            * @brief  Ê∑ªÂä†RFÂç°
 753            * @param  index
 754            * @return none
 755            * @note   none
 756            * @see    none
 757            */
 758          void wifi_add_rf(uint8_t index)
 759          {
 760   1        uint8_t wifi_data[3];
 761   1        wifi_data[0] = WIFI_CMD_ADD_RF;
 762   1        wifi_data[1] = 100;
 763   1        wifi_data[2] = index;
 764   1        UH010_Write_Byte(wifi_data, 3);
 765   1      }
 766          
 767          /**
 768            * @brief  Âà†Èô§RFÂç°
 769            * @param  index
 770            * @return none
 771            * @note   none
 772            * @see    none
 773            */
 774          void wifi_del_rf(uint8_t index)
 775          {
 776   1        uint8_t wifi_data[3];
 777   1        wifi_data[0] = WIFI_CMD_DEL_RF;
 778   1        wifi_data[1] = 100;
 779   1        wifi_data[2] = index;
 780   1        UH010_Write_Byte(wifi_data, 3);
 781   1      }
 782          
 783          /**
 784            * @brief  ÂØÜÁ†ÅÂÖ®ÈÉ®Ê∏ÖÈô§
 785            * @param  none
 786            * @return none
 787            * @note   none
 788            * @see    none
 789            */
 790          void wifi_clr_pwd(void)
 791          {
 792   1        uint8_t wifi_data[2];
 793   1        wifi_data[0] = WIFI_CMD_CLR_PW;
 794   1        wifi_data[1] = 100;
 795   1        UH010_Write_Byte(wifi_data, 2);
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 16:21:04 PAGE 14  

 796   1      }
 797          
 798          /**
 799            * @brief  ÊåáÁ∫πÂÖ®ÈÉ®Ê∏ÖÈô§
 800            * @param  none
 801            * @return none
 802            * @note   none
 803            * @see    none
 804            */
 805          void wifi_clr_fp(void)
 806          {
 807   1        uint8_t wifi_data[2];
 808   1        wifi_data[0] = WIFI_CMD_CLR_FP;
 809   1        wifi_data[1] = 100;
 810   1        UH010_Write_Byte(wifi_data, 2);
 811   1      }
 812          
 813          /**
 814            * @brief  RFÂç°ÂÖ®ÈÉ®Ê∏ÖÈô§
 815            * @param  none
 816            * @return none
 817            * @note   none
 818            * @see    none
 819            */
 820          void wifi_clr_rf(void)
 821          {
 822   1        uint8_t wifi_data[2];
 823   1        wifi_data[0] = WIFI_CMD_CLR_RF;
 824   1        wifi_data[1] = 100;
 825   1        UH010_Write_Byte(wifi_data, 2);
 826   1      }
 827          
 828          /**
 829            * @brief  ËøúÁ®ãÂºÄÈó®
 830            * @param  none
 831            * @return none
 832            * @note   none
 833            * @see    none
 834            */
 835          void wifi_open_by_wifi(void)
 836          {
 837   1        uint8_t wifi_data[2];
 838   1        wifi_data[0] = WIFI_CMD_WF_OPEN;
 839   1        wifi_data[1] = 100;
 840   1        UH010_Write_Byte(wifi_data, 2);
 841   1      }
 842          
 843          /**
 844            * @brief  ÂØÜÁ†ÅÂºÄÈó®
 845            * @param  index
 846            * @return none
 847            * @note   none
 848            * @see    none
 849            */
 850          void wifi_open_by_password(uint8_t index)
 851          {
 852   1        uint8_t wifi_data[3];
 853   1        wifi_data[0] = WIFI_CMD_PW_OPEN;
 854   1        wifi_data[1] = 100;
 855   1        wifi_data[2] = index;
 856   1        UH010_Write_Byte(wifi_data, 3);
 857   1      }
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 16:21:04 PAGE 15  

 858          
 859          /**
 860            * @brief  ÊåáÁ∫πÂºÄÈó®
 861            * @param  index
 862            * @return none
 863            * @note   none
 864            * @see    none
 865            */
 866          void wifi_open_by_fp(uint8_t index)
 867          {
 868   1        uint8_t wifi_data[3];
 869   1        wifi_data[0] = WIFI_CMD_FP_OPEN;
 870   1        wifi_data[1] = 100;
 871   1        wifi_data[2] = index;
 872   1        UH010_Write_Byte(wifi_data, 3);
 873   1      }
 874          
 875          /**
 876            * @brief  RFÂç°ÊåáÁ∫π
 877            * @param  index
 878            * @return none
 879            * @note   none
 880            * @see    none
 881            */
 882          void wifi_open_by_rfid(uint8_t index)
 883          {
 884   1        uint8_t wifi_data[3];
 885   1        wifi_data[0] = WIFI_CMD_RF_OPEN;
 886   1        wifi_data[1] = 100;
 887   1        wifi_data[2] = index;
 888   1        UH010_Write_Byte(wifi_data, 3);
 889   1      }
 890          
 891          /**
 892            * @brief  Â∫îÊÄ•Èí•ÂåôÂºÄÈó®
 893            * @param  none
 894            * @return none
 895            * @note   none
 896            * @see    none
 897            */
 898          void wifi_open_by_key(void)
 899          {
 900   1        uint8_t wifi_data[2];
 901   1        wifi_data[0] = WIFI_CMD_KEY_OPEN;
 902   1        wifi_data[1] = 100;
 903   1        UH010_Write_Byte(wifi_data, 2);
 904   1      }
 905          
 906          /*
 907          parameter: 
 908            none
 909          return :
 910            none
 911          */
 912          void wifi_door_close(void)
 913          {
 914   1        uint8_t wifi_data[2];
 915   1        wifi_data[0] = WIFI_CMD_CLOSE;
 916   1        wifi_data[1] = 100;
 917   1        UH010_Write_Byte(wifi_data, 2);
 918   1      }
 919          
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 16:21:04 PAGE 16  

 920          /**
 921            * @brief  ÈúáÂä®Êä•Ë≠¶
 922            * @param  none
 923            * @return none
 924            * @note   none
 925            * @see    none
 926            */
 927          void wifi_via_alarm(void)
 928          {
 929   1        uint8_t wifi_data[2];
 930   1        wifi_data[0] = WIFI_CMD_VIA_ALARM;
 931   1        wifi_data[1] = 100;
 932   1        UH010_Write_Byte(wifi_data, 2);
 933   1      }
 934          
 935          /**
 936            * @brief  Â§öÊ¨°ÂØÜÁ†ÅÈîôËØØ
 937            * @param  none
 938            * @return none
 939            * @note   none
 940            * @see    none
 941            */
 942          void wifi_pw_alarm(void)
 943          {
 944   1        uint8_t wifi_data[2];
 945   1        wifi_data[0] = WIFI_CMD_PW_ALARM;
 946   1        wifi_data[1] = 100;
 947   1        UH010_Write_Byte(wifi_data, 2);
 948   1      }
 949          
 950          /**
 951            * @brief  Â§öÊ¨°ÊåáÁ∫πÈîôËØØ
 952            * @param  none
 953            * @return none
 954            * @note   none
 955            * @see    none
 956            */
 957          void wifi_fp_alarm(void)
 958          {
 959   1        uint8_t wifi_data[2];
 960   1        wifi_data[0] = WIFI_CMD_FP_ALARM;
 961   1        wifi_data[1] = 100;
 962   1        UH010_Write_Byte(wifi_data, 2);
 963   1      }
 964          
 965          /**
 966            * @brief  Â§öÊ¨°RFÂç°ÈîôËØØ
 967            * @param  none
 968            * @return none
 969            * @note   none
 970            * @see    none
 971            */
 972          void wifi_rf_alarm(void)
 973          {
 974   1        uint8_t wifi_data[2];
 975   1        wifi_data[0] = WIFI_CMD_RF_ALARM;
 976   1        wifi_data[1] = 100;
 977   1        UH010_Write_Byte(wifi_data, 2);
 978   1      }
 979          
 980          /**
 981            * @brief  ‰ΩéÁîµÈáè
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 16:21:04 PAGE 17  

 982            * @param  none
 983            * @return none
 984            * @note   none
 985            * @see    none
 986            */
 987          void wifi_lowpower_alarm(void)
 988          {
 989   1        uint8_t wifi_data[2];
 990   1        wifi_data[0] = WIFI_CMD_LOWPOWER_ALARM;
 991   1        wifi_data[1] = 100;
 992   1        UH010_Write_Byte(wifi_data, 2);
 993   1      }
 994          
 995          /**
 996            * @brief  ÊãçÁÖßÂΩïÂÉèÂºÄÂÖ≥ÔºàÂèëÈÄÅÔºâ
 997            * @param  none
 998            * @return none
 999            * @note   none
1000            * @see    none
1001            */
1002          void wifi_pv_switch_send(void)
1003          {
1004   1        uint8_t wifi_data[2];
1005   1        wifi_data[0] = WIFI_CMD_PV_SWITCH_SEND;
1006   1        wifi_data[1] = 100;
1007   1        UH010_Write_Byte(wifi_data, 2);
1008   1      }
1009          
1010          /**
1011            * @brief  ÊãçÁÖßÂΩïÂÉèÂºÄÂÖ≥ÔºàÊé•Êî∂Ôºâ
1012            * @param  none
1013            * @return none
1014            * @note   none
1015            * @see    none
1016            */
1017          uint8_t wifi_pv_switch_get(void)
1018          {
1019   1        uint8_t wifi_data[2];
1020   1        uint8_t data_2[2] = {0};
1021   1        wifi_data[0] = WIFI_CMD_PV_SWITCH_GET;
1022   1        wifi_data[1] = 100;
1023   1        UH010_Write_Byte(wifi_data, 2);
1024   1        delay_ms(400);
1025   1        UH010_ReadDatas(wifi_data, 0, data_2, 2);
1026   1        if (data_2[0] == 'J' && data_2[1] == 'E') //Êó†ÂìçÂ∫î
1027   1          return 0xff;
1028   1        else if (data_2[0] == 'J' && data_2[1] == '0') //ÂÖ≥Èó≠ÊãçÁÖßÂΩïÂÉè(ËÆæÂ§á‰πãÂêéÂºÄÈó®ÈÉΩ‰∏ç‰ºöÂèëÈÄÅÊãçÁ
             -ÖßÂíåÂΩïÂÉèÂëΩ‰ª§)
1029   1          return 0;
1030   1        else if (data_2[0] == 'J' && data_2[1] == '1') //ÂºÄÂêØÊãçÁÖßÂÖ≥Èó≠ÂΩïÂÉè
1031   1          return 1;
1032   1        else if (data_2[0] == 'J' && data_2[1] == '2') //ÂÖ≥Èó≠ÊãçÁÖßÂºÄÂêØÂΩïÂÉè
1033   1          return 2;
1034   1        else if (data_2[0] == 'J' && data_2[1] == '3') //ÂºÄÂêØÊãçÁÖßÂºÄÂêØÂΩïÂÉè
1035   1          return 3;
1036   1        else
1037   1          return 0xff;
1038   1      }
1039          
1040          void wifi_send_fp_110(void)
1041          {
1042   1        uint8_t wifi_data[2];
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/20/2021 16:21:04 PAGE 18  

1043   1        wifi_data[0] = WIFI_CMD_WF_OPEN_FP_110;
1044   1        wifi_data[1] = 100;
1045   1        UH010_Write_Byte(wifi_data, 2);
1046   1      }
1047          
1048          void wifi_send_pwd_110(void)
1049          {
1050   1        uint8_t wifi_data[2];
1051   1        wifi_data[0] = WIFI_CMD_WF_OPEN_PSW_110;
1052   1        wifi_data[1] = 100;
1053   1        UH010_Write_Byte(wifi_data, 2);
1054   1      }
1055          
1056          void wifi_set_110(void)
1057          {
1058   1        uint8_t wifi_data[2];
1059   1        wifi_data[0] = WIFI_CMD_WF_SET_110;
1060   1        wifi_data[1] = 100;
1061   1        UH010_Write_Byte(wifi_data, 2);
1062   1      }
1063          
1064          #endif
1065          #endif //__DQIOT_DRV_WIFI_C__


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2237    ----
   CONSTANT SIZE    =     11    ----
   XDATA SIZE       =      1     117
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
