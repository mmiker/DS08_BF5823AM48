C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/10/2021 16:21:32 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE DQIOT_DRV_WIFI
OBJECT MODULE PLACED IN .\output\dqiot_drv_wifi.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE source\dqiot_drv_wifi.c LARGE OMF2 OPTIMIZE(8,SPEED) BROWSE INCDIR(.\inc
                    -lude;.\Library\byd_standard_peripheral\include;.\byd_api\byd_key\include;.\byd_api\byd_mifare\include;.\byd_tool_comm;.\
                    -byd_rfid;.\mmi_inc) DEBUG PRINT(.\list\dqiot_drv_wifi.lst) TABS(2) OBJECT(.\output\dqiot_drv_wifi.obj)

line level    source

   1          #ifndef __DQIOT_DRV_WIFI_H__
   2          #define __DQIOT_DRV_WIFI_H__
   3          #include "dqiot_drv_wifi.h"
   4          #include "mmi_feature.h"
   5          #include "iic_master.h"
   6          #include "delay.h"
   7          #include "mmi_fs.h"
   8          #include "mmi_audio.h"
   9          #include "mmi_wifi.h"
  10          #include "mmi_fps.h"
  11          #include "mmi_ms.h"
  12          // #include <stdio.h>
  13          
  14          unsigned char wifi_add_flag = 0;
  15          extern unsigned char uart_get_buf[];
  16          extern unsigned char uart_getbuflen;
  17          // extern void printfS(char *show, char *status);
  18          // extern void printfV(char *show, int value);
  19          
  20          /**
  21            * @brief  ‰∏≤Âè£Êï∞ÊçÆÊé•Êî∂
  22            * @param  send    ÂèëÈÄÅÊï∞ÊçÆ
  23            * @param  send_len  ÂèëÈÄÅÊï∞ÊçÆÈïøÂ∫¶
  24            * @param  Buf     Êé•Êî∂Êï∞ÊçÆ
  25            * @param  len     Êé•Êî∂Êï∞ÊçÆÈïøÂ∫¶
  26            * @return ‰∏≤Âè£Êï∞ÊçÆ
  27            * @note   none
  28            * @see    none
  29            */
  30          uint8_t UH010_ReadDatas(uint8_t *send, uint8_t send_len, uint8_t *Buf, uint8_t len)
  31          {
  32   1      #if 0
                uint8_t i;
              
                if (send_len > 0)
                {
                  EA = 0;
                  iic_master_start();
              
                  if (iic_sendbyte_and_getnack(WIFI_ADDR))
                  {
                    //iic_master_stop();
                    //EA = 1;
                    //return 1;
                  }
              
                  for (i = 0; i < send_len; i++)
                  {
                    if (iic_sendbyte_and_getnack(send[i]))
                    {
                      //iic_master_stop();
                      //EA = 1;
                      //return 1;
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/10/2021 16:21:32 PAGE 2   

                    }
                  }
              
                  if (iic_sendbyte_and_getnack(WIFI_ADDR | 0x01))
                  {
                    //iic_master_stop();
                    //EA = 1;
                    //return 1;
                  }
              
                  for (i = 0; i < len; i++)
                  {
                    Buf[i] = iic_receive_byte();
                    if (i == (len - 1))
                      break;
                    iic_respond(ACK);
                  }
              
                  iic_respond(NACK);
              
                  EA = 1;
                  iic_master_stop();
                }
                else
                {
                  EA = 0;
                  iic_master_start();
                  if (iic_sendbyte_and_getnack(WIFI_ADDR | 0x01))
                  {
                    //iic_master_stop();
                    //EA = 1;
                    //return 1;
                  }
              
                  for (i = 0; i < len; i++)
                  {
                    Buf[i] = iic_receive_byte();
                    if (i == (len - 1))
                      break;
                    iic_respond(ACK);
                  }
              
                  iic_respond(NACK);
              
                  EA = 1;
                  iic_master_stop();
                }
              
                return 0;
              #else
 104   1        uint8_t i = 0, j = 0;
 105   1        uint16_t waittime = 1000;
 106   1      
 107   1        if (send_len > 0)
 108   1        {
 109   2          EA = 0;
 110   2      
 111   2          for (i = 0; i < send_len; i++)
 112   2            uart_tx_byte(UART0, send[i]);
 113   2      
 114   2          while (--waittime)
 115   2          {
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/10/2021 16:21:32 PAGE 3   

 116   3            delay_ms(1);
 117   3      
 118   3            if (uart_getbuflen >= 2)
 119   3            {
 120   4              /* ÂØªÊâæÂåÖÂ§¥ */
 121   4              for (i = 0; i < uart_getbuflen; i++)
 122   4              {
 123   5                if (uart_get_buf[i] == 'K' || uart_get_buf[i] == 'I' || uart_get_buf[i] == 'B' \
 124   5                || uart_get_buf[i] == 'F' || uart_get_buf[i] == 'R' || uart_get_buf[i] == 'M' \
 125   5                || uart_get_buf[i] == 'J' || uart_get_buf[i] == 'q')
 126   5                  break;
 127   5              }
 128   4      
 129   4              for (i; i < uart_getbuflen; i++)
 130   4              {
 131   5                Buf[j] = uart_get_buf[i];
 132   5                if (j == (len - 1))
 133   5                  break;
 134   5                j++;
 135   5              }
 136   4      
 137   4              /* Ê∏ÖÁ©∫ÁºìÂ≠ò */
 138   4              uart_getbuflen = 0;
 139   4              EA = 1;
 140   4      
 141   4              return 0;
 142   4            }
 143   3          }
 144   2      
 145   2          EA = 1;
 146   2        }
 147   1        else
 148   1        {
 149   2          EA = 0;
 150   2      
 151   2          while (--waittime)
 152   2          {
 153   3            delay_ms(1);
 154   3      
 155   3            if (uart_getbuflen >= 2)
 156   3            {
 157   4              /* ÂØªÊâæÂåÖÂ§¥ */
 158   4              for (i = 0; i < uart_getbuflen; i++)
 159   4              {
 160   5                if (uart_get_buf[i] == 'K' || uart_get_buf[i] == 'I' || uart_get_buf[i] == 'B' \
 161   5                || uart_get_buf[i] == 'F' || uart_get_buf[i] == 'R' || uart_get_buf[i] == 'M' \
 162   5                || uart_get_buf[i] == 'J' || uart_get_buf[i] == 'q')
 163   5                  break;
 164   5              }
 165   4      
 166   4              for (i; i < uart_getbuflen; i++)
 167   4              {
 168   5                Buf[j] = uart_get_buf[i];
 169   5                if (j == (len - 1))
 170   5                  break;
 171   5                j++;
 172   5              }
 173   4      
 174   4              /* Ê∏ÖÁ©∫ÁºìÂ≠ò */
 175   4              uart_getbuflen = 0;
 176   4              EA = 1;
 177   4      
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/10/2021 16:21:32 PAGE 4   

 178   4              return 0;
 179   4            }
 180   3          }
 181   2      
 182   2          EA = 1;
 183   2        }
 184   1      
 185   1        return 0;
 186   1      #endif
 187   1      }
 188          
 189          /**
 190            * @brief  ‰∏≤Âè£Êï∞ÊçÆÂèëÁîü
 191            * @param  send    ÂèëÈÄÅÊï∞ÊçÆ
 192            * @param  send_len  ÂèëÈÄÅÊï∞ÊçÆÈïøÂ∫¶
 193            * @return none
 194            * @note   none
 195            * @see    none
 196            */
 197          uint8_t UH010_Write_Byte(uint8_t *send, uint8_t send_len)
 198          {
 199   1      #if 0
                uint8_t i;
              
                EA = 0;
                iic_master_start();
              
                if (iic_sendbyte_and_getnack(WIFI_ADDR & ~0x01))
                {
                  iic_master_stop();
                  EA = 1;
                  return 1;
                }
              
                for (i = 0; i < send_len; i++)
                {
                  if (iic_sendbyte_and_getnack(send[i]))
                  {
                    iic_master_stop();
                    EA = 1;
                    return 1;
                  }
                }
                EA = 1;
                iic_master_stop();
              
                return 0;
              #else
 226   1        uint8_t i;
 227   1      
 228   1        EA = 0;
 229   1        uart_getbuflen = 0;
 230   1      
 231   1        for (i = 0; i < send_len; i++)
 232   1          uart_tx_byte(UART0, send[i]);
 233   1      
 234   1        EA = 1;
 235   1      
 236   1        return 0;
 237   1      #endif
 238   1      }
 239          
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/10/2021 16:21:32 PAGE 5   

 240          /*
 241          parameter: 
 242            none
 243          return :
 244            none
 245          */
 246          void wifi_uh316_init(void)
 247          {
 248   1      }
 249          
 250          /**
 251            * @brief  Êô∫ËÉΩÈÖçÁΩëÔºàÂèëÈÄÅÔºâ
 252            * @param  none
 253            * @return none
 254            * @note   none
 255            * @see    none
 256            */
 257          uint8_t wifi_net_connect_send(void)
 258          {
 259   1        uint8_t wifi_data[2];
 260   1        wifi_data[0] = WIFI_CMD_NET_CON;
 261   1        wifi_data[1] = 100;
 262   1        if (UH010_Write_Byte(wifi_data, 2) == 0)
 263   1          return 1;
 264   1        else
 265   1          return 0;
 266   1      }
 267          
 268          /**
 269            * @brief  AirkissÈÖçÁΩëÔºàÂèëÈÄÅÔºâ
 270            * @param  none
 271            * @return none
 272            * @note   none
 273            * @see    none
 274            */
 275          uint8_t wifi_net_airkiss_connect_send(void)
 276          {
 277   1        uint8_t wifi_data[2];
 278   1        wifi_data[0] = WIFI_CMD_AIRKISS_NET_CON;
 279   1        wifi_data[1] = 100;
 280   1        if (UH010_Write_Byte(wifi_data, 2) == 0)
 281   1          return 1;
 282   1        else
 283   1          return 0;
 284   1      }
 285          
 286          /**
 287            * @brief  ‰∫åÁª¥Á†ÅÈÖçÁΩëÔºàÂèëÈÄÅÔºâ
 288            * @param  none
 289            * @return none
 290            * @note   none
 291            * @see    none
 292            */
 293          uint8_t wifi_net_code_connect_send(void)
 294          {
 295   1        uint8_t wifi_data[2];
 296   1        wifi_data[0] = WIFI_CMD_CODE_NET_CON;
 297   1        wifi_data[1] = 100;
 298   1        if (UH010_Write_Byte(wifi_data, 2) == 0)
 299   1          return 1;
 300   1        else
 301   1          return 0;
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/10/2021 16:21:32 PAGE 6   

 302   1      }
 303          
 304          /**
 305            * @brief  ÈÖçÁΩëÁä∂ÊÄÅÔºàÊé•Êî∂Ôºâ
 306            * @param  none
 307            * @return none
 308            * @note   none
 309            * @see    none
 310            */
 311          uint8_t wifi_net_connect_state(void)
 312          {
 313   1        uint8_t wifi_data[2];
 314   1        uint8_t data_2[2] = {0};
 315   1        wifi_data[0] = WIFI_CMD_NET_STATE;
 316   1        wifi_data[1] = 100;
 317   1        UH010_Write_Byte(wifi_data, 2);
 318   1        delay_ms(50);
 319   1        UH010_ReadDatas(wifi_data, 0, data_2, 2);
 320   1        if (data_2[0] == 'I' && data_2[1] == 'O')
 321   1          return 1;
 322   1        if (data_2[0] == 'I' && data_2[1] == 'E')
 323   1          return 2;
 324   1        else
 325   1          return 0;
 326   1      }
 327          
 328          /**
 329            * @brief  Êü•ËØ¢ÁΩëÁªúÁä∂ÊÄÅ
 330            * @param  none
 331            * @return none
 332            * @note   none
 333            * @see    none
 334            */
 335          uint8_t wifi_check_net(void)
 336          {
 337   1        uint8_t wifi_data[2];
 338   1        uint8_t data_2[2] = {0};
 339   1        wifi_data[0] = WIFI_CMD_CHECK_NET;
 340   1        wifi_data[1] = 100;
 341   1        UH010_Write_Byte(wifi_data, 2);
 342   1        delay_ms(50);
 343   1        UH010_ReadDatas(wifi_data, 0, data_2, 2);
 344   1        if (data_2[0] == 'q' && data_2[1] == 'O')
 345   1          return 1;
 346   1        else
 347   1          return 0;
 348   1      }
 349          
 350          /**
 351            * @brief  ÊãçÁÖß
 352            * @param  none
 353            * @return none
 354            * @note   none
 355            * @see    none
 356            */
 357          uint8_t wifi_take_photos(void)
 358          {
 359   1        uint8_t wifi_data[2];
 360   1        wifi_data[0] = WIFI_CMD_TAKE_PHOTOS;
 361   1        wifi_data[1] = 100;
 362   1        UH010_Write_Byte(wifi_data, 2);
 363   1        return 1;
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/10/2021 16:21:32 PAGE 7   

 364   1      }
 365          
 366          /**
 367            * @brief  ÂΩïÂÉè
 368            * @param  none
 369            * @return none
 370            * @note   none
 371            * @see    none
 372            */
 373          uint8_t wifi_take_videos(void)
 374          {
 375   1        uint8_t wifi_data[2];
 376   1        wifi_data[0] = WIFI_CMD_TAKE_VIDEOS;
 377   1        wifi_data[1] = 100;
 378   1        UH010_Write_Byte(wifi_data, 2);
 379   1        return 1;
 380   1      }
 381          
 382          /**
 383            * @brief  ÂèëÈÄÅÊï∞ÊçÆÂåÖ
 384            * @param  cmd   ÂëΩ‰ª§
 385            * @param  pv    ÁîµÊµÅ
 386            * @param  index ÁºñÂè∑(0xff=null)
 387            * @return status
 388            * @note   none
 389            * @see    none
 390            */
 391          uint8_t wifi_data_package(uint8_t cmd, uint8_t pv, uint8_t index)
 392          {
 393   1        uint8_t wifi_data[3];
 394   1        wifi_data[0] = cmd;
 395   1        wifi_data[1] = pv;
 396   1        wifi_data[2] = index;
 397   1      
 398   1        if (index == 0xff)
 399   1          UH010_Write_Byte(wifi_data, 2);
 400   1        else
 401   1          UH010_Write_Byte(wifi_data, 3);
 402   1      
 403   1        return 1;
 404   1      }
 405          
 406          /**
 407            * @brief  ËøúÁ®ãÂºÄÈó®ÔºàÂèëÈÄÅÔºâ
 408            * @param  none
 409            * @return none
 410            * @note   none
 411            * @see    none
 412            */
 413          uint8_t wifi_open_ask(void)
 414          {
 415   1        uint8_t wifi_data[2];
 416   1        wifi_data[0] = WIFI_CMD_WF_OPEN_ASK;
 417   1        wifi_data[1] = 100;
 418   1        if (UH010_Write_Byte(wifi_data, 2) == 0)
 419   1          return 1;
 420   1        else
 421   1          return 0;
 422   1      }
 423          
 424          /**
 425            * @brief  ËøúÁ®ãÂºÄÈó®ÔºàÊé•Êî∂Ôºâ
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/10/2021 16:21:32 PAGE 8   

 426            * @param  none
 427            * @return none
 428            * @note   none
 429            * @see    none
 430            */
 431          uint8_t wifi_open_reply_get(void)
 432          {
 433   1        uint8_t wifi_data[2];
 434   1        uint8_t data_2[2] = {0};
 435   1        wifi_data[0] = WIFI_CMD_WF_OPEN_REPLY;
 436   1        wifi_data[1] = 100;
 437   1        UH010_Write_Byte(wifi_data, 2);
 438   1        delay_ms(300);
 439   1        UH010_ReadDatas(wifi_data, 0, data_2, 2);
 440   1      
 441   1        // printfV("data_2[0]", (int)data_2[0]);
 442   1        // printfV("data_2[1]", (int)data_2[1]);
 443   1      
 444   1        if (data_2[0] == 'K' && data_2[1] == 'O')
 445   1          return 1;
 446   1        else if (data_2[0] == 'K' && data_2[1] == 'E')
 447   1          return 2;
 448   1        else if (data_2[0] == 'K' && data_2[1] == 'K')
 449   1          return 3;
 450   1        else
 451   1          return 0;
 452   1      }
 453          
 454          /**
 455            * @brief  Ê∑ªÂä†Âà†Èô§ÂØÜÁ†Å/ÊåáÁ∫π/RFÂç°
 456            * @param  none
 457            * @return none
 458            * @note   none
 459            * @see    none
 460            */
 461          uint8_t wifi_cmd_add_del(void)
 462          {
 463   1        RET_VAL retval = 0;
 464   1        uint8_t wifi_data[2];
 465   1        uint8_t data_2[3] = {0};
 466   1        wifi_data[0] = WIFI_CMD_ADD_DEL;
 467   1        wifi_data[1] = 100;
 468   1        UH010_Write_Byte(wifi_data, 2);
 469   1        delay_ms(300);
 470   1        UH010_ReadDatas(wifi_data, 0, data_2, 3);
 471   1      
 472   1        // printfV("data_2[0]", (int)data_2[0]);
 473   1        // printfV("data_2[1]", (int)data_2[1]);
 474   1        // printfV("data_2[2]", (int)data_2[2]);
 475   1      
 476   1        if (data_2[0] == 'B')
 477   1        {
 478   2          switch (data_2[1])
 479   2          {
 480   3          case 'L':
 481   3            return 0;
 482   3          case 'E':
 483   3            mmi_dq_aud_play_with_id(AUD_BASE_ID_FAIL);
 484   3            return 0xff;
 485   3          case 'M':
 486   3            wifi_add_flag = 1;
 487   3            mmi_dq_aud_play_with_id(AUD_ID_INPUT_68_PWD);
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/10/2021 16:21:32 PAGE 9   

 488   3            mmi_dq_ms_set_sys_state(SYS_STATUS_ADD_PWD);
 489   3            break;
 490   3          case 'F':
 491   3            wifi_add_flag = 1;
 492   3            mmi_dq_aud_play_with_id(AUD_ID_PRESS_FP);
 493   3            mmi_dq_ms_set_sys_state(SYS_STATUS_ADD_FP);
 494   3            break;
 495   3          case 'R':
 496   3            wifi_add_flag = 1;
 497   3            mmi_dq_aud_play_with_id(AUD_ID_PRESS_RFCARD);
 498   3            mmi_dq_ms_set_sys_state(SYS_STATUS_ADD_RFID);
 499   3            break;
 500   3          }
 501   2        }
 502   1        else if (data_2[0] == 'M' || data_2[0] == 'F' || data_2[0] == 'R')
 503   1        {
 504   2          if (data_2[2] == 0x00) //48 => 0,57 => 9
 505   2            get_index = data_2[1] - '0';
 506   2          else
 507   2            get_index = (data_2[1] - '0') * 10 + (data_2[2] - '0');
 508   2          // printfV("get_index", (int)get_index);
 509   2      
 510   2          switch (data_2[0])
 511   2          {
 512   3          case 'M':
 513   3            retval = mmi_dq_fs_del_pwd(get_index, FDS_USE_TYPE_USER);
 514   3            if (retval == RET_SUCESS)
 515   3            {
 516   4              mmi_dq_aud_play_with_id(AUD_ID_DEL_PWD_SUCESS);
 517   4              mmi_dq_wifi_del_password(get_index);
 518   4            }
 519   3            else
 520   3              mmi_dq_aud_play_with_id(AUD_ID_DEL_FAIL);
 521   3            break;
 522   3          case 'F':
 523   3            retval = mmi_dq_fs_del_fp(get_index, FDS_USE_TYPE_USER);
 524   3            if (retval == RET_SUCESS)
 525   3              retval = mmi_dq_fp_delete((unsigned short)get_index);
 526   3            if (retval == 0)
 527   3            {
 528   4              mmi_dq_aud_play_with_id(AUD_ID_DEL_FP_SUCESS);
 529   4              mmi_dq_wifi_del_fp(get_index);
 530   4            }
 531   3            else
 532   3              mmi_dq_aud_play_with_id(AUD_ID_DEL_FAIL);
 533   3            break;
 534   3          case 'R':
 535   3            retval = mmi_dq_fs_del_rfid(get_index);
 536   3            if (retval == RET_SUCESS)
 537   3            {
 538   4              mmi_dq_aud_play_with_id(AUD_ID_DEL_RFCARD_SUCESS);
 539   4              mmi_dq_wifi_del_rfid_suc(get_index);
 540   4            }
 541   3            else
 542   3              mmi_dq_aud_play_with_id(AUD_ID_DEL_FAIL);
 543   3            break;
 544   3          }
 545   2        }
 546   1        else
 547   1          return 0;
 548   1      
 549   1        return 1;
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/10/2021 16:21:32 PAGE 10  

 550   1      }
 551          
 552          /**
 553            * @brief  Èó®Êú™ÂÖ≥
 554            * @param  none
 555            * @return none
 556            * @note   none
 557            * @see    none
 558            */
 559          void wifi_close_over_time(void)
 560          {
 561   1        uint8_t wifi_data[2];
 562   1        wifi_data[0] = WIFI_CMD_CLOSE_OVER_TIME;
 563   1        wifi_data[1] = 100;
 564   1        UH010_Write_Byte(wifi_data, 2);
 565   1      }
 566          
 567          /**
 568            * @brief  Âî§ÈÜí
 569            * @param  none
 570            * @return none
 571            * @note   none
 572            * @see    none
 573            */
 574          unsigned char wifi_wake_up(void)
 575          {
 576   1      
 577   1        uint8_t wifi_data[2];
 578   1        wifi_data[0] = WIFI_CMD_WAKEUP;
 579   1        wifi_data[1] = 100;
 580   1        return UH010_Write_Byte(wifi_data, 2);
 581   1      }
 582          
 583          /**
 584            * @brief  Áù°Áú†
 585            * @param  none
 586            * @return none
 587            * @note   none
 588            * @see    none
 589            */
 590          void wifi_sleep_mode(void)
 591          {
 592   1        uint8_t wifi_data[2];
 593   1        wifi_data[0] = WIFI_CMD_SLEEP;
 594   1        wifi_data[1] = 100;
 595   1        UH010_Write_Byte(wifi_data, 2);
 596   1      }
 597          
 598          /**
 599            * @brief  Ê∑ªÂä†ÂØÜÁ†Å
 600            * @param  index
 601            * @return none
 602            * @note   none
 603            * @see    none
 604            */
 605          void wifi_add_password(uint8_t index)
 606          {
 607   1        uint8_t wifi_data[2];
 608   1        wifi_data[0] = WIFI_CMD_ADD_PW;
 609   1        wifi_data[1] = 100;
 610   1        wifi_data[2] = index;
 611   1        UH010_Write_Byte(wifi_data, 3);
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/10/2021 16:21:32 PAGE 11  

 612   1      }
 613          
 614          /**
 615            * @brief  Âà†Èô§ÂØÜÁ†Å
 616            * @param  index
 617            * @return none
 618            * @note   none
 619            * @see    none
 620            */
 621          void wifi_del_password(uint8_t index)
 622          {
 623   1        uint8_t wifi_data[2];
 624   1        wifi_data[0] = WIFI_CMD_DEL_PW;
 625   1        wifi_data[1] = 100;
 626   1        wifi_data[2] = index;
 627   1        UH010_Write_Byte(wifi_data, 3);
 628   1      }
 629          
 630          /**
 631            * @brief  Ê∑ªÂä†ÊåáÁ∫π
 632            * @param  index
 633            * @return none
 634            * @note   none
 635            * @see    none
 636            */
 637          void wifi_add_fp(uint8_t index)
 638          {
 639   1        uint8_t wifi_data[2];
 640   1        wifi_data[0] = WIFI_CMD_ADD_FP;
 641   1        wifi_data[1] = 100;
 642   1        wifi_data[2] = index;
 643   1        UH010_Write_Byte(wifi_data, 3);
 644   1      }
 645          
 646          /**
 647            * @brief  Âà†Èô§ÊåáÁ∫π
 648            * @param  index
 649            * @return none
 650            * @note   none
 651            * @see    none
 652            */
 653          void wifi_del_fp(uint8_t index)
 654          {
 655   1        uint8_t wifi_data[2];
 656   1        wifi_data[0] = WIFI_CMD_DEL_FP;
 657   1        wifi_data[1] = 100;
 658   1        wifi_data[2] = index;
 659   1        UH010_Write_Byte(wifi_data, 3);
 660   1      }
 661          
 662          /**
 663            * @brief  Ê∑ªÂä†RFÂç°
 664            * @param  index
 665            * @return none
 666            * @note   none
 667            * @see    none
 668            */
 669          void wifi_add_rf(uint8_t index)
 670          {
 671   1        uint8_t wifi_data[2];
 672   1        wifi_data[0] = WIFI_CMD_ADD_RF;
 673   1        wifi_data[1] = 100;
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/10/2021 16:21:32 PAGE 12  

 674   1        wifi_data[2] = index;
 675   1        UH010_Write_Byte(wifi_data, 3);
 676   1      }
 677          
 678          /**
 679            * @brief  Âà†Èô§RFÂç°
 680            * @param  index
 681            * @return none
 682            * @note   none
 683            * @see    none
 684            */
 685          void wifi_del_rf(uint8_t index)
 686          {
 687   1        uint8_t wifi_data[2];
 688   1        wifi_data[0] = WIFI_CMD_DEL_RF;
 689   1        wifi_data[1] = 100;
 690   1        wifi_data[2] = index;
 691   1        UH010_Write_Byte(wifi_data, 3);
 692   1      }
 693          
 694          /**
 695            * @brief  ÂØÜÁ†ÅÂÖ®ÈÉ®Ê∏ÖÈô§
 696            * @param  none
 697            * @return none
 698            * @note   none
 699            * @see    none
 700            */
 701          void wifi_clr_pwd(void)
 702          {
 703   1        uint8_t wifi_data[2];
 704   1        wifi_data[0] = WIFI_CMD_CLR_PW;
 705   1        wifi_data[1] = 100;
 706   1        UH010_Write_Byte(wifi_data, 2);
 707   1      }
 708          
 709          /**
 710            * @brief  ÊåáÁ∫πÂÖ®ÈÉ®Ê∏ÖÈô§
 711            * @param  none
 712            * @return none
 713            * @note   none
 714            * @see    none
 715            */
 716          void wifi_clr_fp(void)
 717          {
 718   1        uint8_t wifi_data[2];
 719   1        wifi_data[0] = WIFI_CMD_CLR_FP;
 720   1        wifi_data[1] = 100;
 721   1        UH010_Write_Byte(wifi_data, 2);
 722   1      }
 723          
 724          /**
 725            * @brief  RFÂç°ÂÖ®ÈÉ®Ê∏ÖÈô§
 726            * @param  none
 727            * @return none
 728            * @note   none
 729            * @see    none
 730            */
 731          void wifi_clr_rf(void)
 732          {
 733   1        uint8_t wifi_data[2];
 734   1        wifi_data[0] = WIFI_CMD_CLR_RF;
 735   1        wifi_data[1] = 100;
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/10/2021 16:21:32 PAGE 13  

 736   1        UH010_Write_Byte(wifi_data, 2);
 737   1      }
 738          
 739          /**
 740            * @brief  ËøúÁ®ãÂºÄÈó®
 741            * @param  none
 742            * @return none
 743            * @note   none
 744            * @see    none
 745            */
 746          void wifi_open_by_wifi(void)
 747          {
 748   1        uint8_t wifi_data[2];
 749   1        wifi_data[0] = WIFI_CMD_WF_OPEN;
 750   1        wifi_data[1] = 100;
 751   1        UH010_Write_Byte(wifi_data, 2);
 752   1      }
 753          
 754          /**
 755            * @brief  ÂØÜÁ†ÅÂºÄÈó®
 756            * @param  index
 757            * @return none
 758            * @note   none
 759            * @see    none
 760            */
 761          void wifi_open_by_password(uint8_t index)
 762          {
 763   1        uint8_t wifi_data[3];
 764   1        wifi_data[0] = WIFI_CMD_PW_OPEN;
 765   1        wifi_data[1] = 100;
 766   1        wifi_data[2] = index;
 767   1        UH010_Write_Byte(wifi_data, 3);
 768   1      }
 769          
 770          /**
 771            * @brief  ÊåáÁ∫πÂºÄÈó®
 772            * @param  index
 773            * @return none
 774            * @note   none
 775            * @see    none
 776            */
 777          void wifi_open_by_fp(uint8_t index)
 778          {
 779   1        uint8_t wifi_data[2];
 780   1        wifi_data[0] = WIFI_CMD_FP_OPEN;
 781   1        wifi_data[1] = 100;
 782   1        wifi_data[2] = index;
 783   1        UH010_Write_Byte(wifi_data, 3);
 784   1      }
 785          
 786          /**
 787            * @brief  RFÂç°ÊåáÁ∫π
 788            * @param  index
 789            * @return none
 790            * @note   none
 791            * @see    none
 792            */
 793          void wifi_open_by_rfid(uint8_t index)
 794          {
 795   1        uint8_t wifi_data[2];
 796   1        wifi_data[0] = WIFI_CMD_RF_OPEN;
 797   1        wifi_data[1] = 100;
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/10/2021 16:21:32 PAGE 14  

 798   1        wifi_data[2] = index;
 799   1        UH010_Write_Byte(wifi_data, 3);
 800   1      }
 801          
 802          /**
 803            * @brief  Â∫îÊÄ•Èí•ÂåôÂºÄÈó®
 804            * @param  none
 805            * @return none
 806            * @note   none
 807            * @see    none
 808            */
 809          void wifi_open_by_key(void)
 810          {
 811   1        uint8_t wifi_data[2];
 812   1        wifi_data[0] = WIFI_CMD_KEY_OPEN;
 813   1        wifi_data[1] = 100;
 814   1        UH010_Write_Byte(wifi_data, 2);
 815   1      }
 816          
 817          /*
 818          parameter: 
 819            none
 820          return :
 821            none
 822          */
 823          void wifi_door_close(void)
 824          {
 825   1        uint8_t wifi_data[2];
 826   1        wifi_data[0] = WIFI_CMD_CLOSE;
 827   1        wifi_data[1] = 100;
 828   1        UH010_Write_Byte(wifi_data, 2);
 829   1      }
 830          
 831          /**
 832            * @brief  ÈúáÂä®Êä•Ë≠¶
 833            * @param  none
 834            * @return none
 835            * @note   none
 836            * @see    none
 837            */
 838          void wifi_via_alarm(void)
 839          {
 840   1        uint8_t wifi_data[2];
 841   1        wifi_data[0] = WIFI_CMD_VIA_ALARM;
 842   1        wifi_data[1] = 100;
 843   1        UH010_Write_Byte(wifi_data, 2);
 844   1      }
 845          
 846          /**
 847            * @brief  Â§öÊ¨°ÂØÜÁ†ÅÈîôËØØ
 848            * @param  none
 849            * @return none
 850            * @note   none
 851            * @see    none
 852            */
 853          void wifi_pw_alarm(void)
 854          {
 855   1        uint8_t wifi_data[2];
 856   1        wifi_data[0] = WIFI_CMD_PW_ALARM;
 857   1        wifi_data[1] = 100;
 858   1        UH010_Write_Byte(wifi_data, 2);
 859   1      }
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/10/2021 16:21:32 PAGE 15  

 860          
 861          /**
 862            * @brief  Â§öÊ¨°ÊåáÁ∫πÈîôËØØ
 863            * @param  none
 864            * @return none
 865            * @note   none
 866            * @see    none
 867            */
 868          void wifi_fp_alarm(void)
 869          {
 870   1        uint8_t wifi_data[2];
 871   1        wifi_data[0] = WIFI_CMD_FP_ALARM;
 872   1        wifi_data[1] = 100;
 873   1        UH010_Write_Byte(wifi_data, 2);
 874   1      }
 875          
 876          /**
 877            * @brief  Â§öÊ¨°RFÂç°ÈîôËØØ
 878            * @param  none
 879            * @return none
 880            * @note   none
 881            * @see    none
 882            */
 883          void wifi_rf_alarm(void)
 884          {
 885   1        uint8_t wifi_data[2];
 886   1        wifi_data[0] = WIFI_CMD_RF_ALARM;
 887   1        wifi_data[1] = 100;
 888   1        UH010_Write_Byte(wifi_data, 2);
 889   1      }
 890          
 891          /**
 892            * @brief  ‰ΩéÁîµÈáè
 893            * @param  none
 894            * @return none
 895            * @note   none
 896            * @see    none
 897            */
 898          void wifi_lowpower_alarm(void)
 899          {
 900   1        uint8_t wifi_data[2];
 901   1        wifi_data[0] = WIFI_CMD_LOWPOWER_ALARM;
 902   1        wifi_data[1] = 100;
 903   1        UH010_Write_Byte(wifi_data, 2);
 904   1      }
 905          
 906          /**
 907            * @brief  ÊãçÁÖßÂΩïÂÉèÂºÄÂÖ≥ÔºàÂèëÈÄÅÔºâ
 908            * @param  none
 909            * @return none
 910            * @note   none
 911            * @see    none
 912            */
 913          void wifi_pv_switch_send(void)
 914          {
 915   1        uint8_t wifi_data[2];
 916   1        wifi_data[0] = WIFI_CMD_PV_SWITCH_SEND;
 917   1        wifi_data[1] = 100;
 918   1        UH010_Write_Byte(wifi_data, 2);
 919   1      }
 920          
 921          /**
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/10/2021 16:21:32 PAGE 16  

 922            * @brief  ÊãçÁÖßÂΩïÂÉèÂºÄÂÖ≥ÔºàÊé•Êî∂Ôºâ
 923            * @param  none
 924            * @return none
 925            * @note   none
 926            * @see    none
 927            */
 928          uint8_t wifi_pv_switch_get(void)
 929          {
 930   1        uint8_t wifi_data[2];
 931   1        uint8_t data_2[2] = {0};
 932   1        wifi_data[0] = WIFI_CMD_PV_SWITCH_GET;
 933   1        wifi_data[1] = 100;
 934   1        UH010_Write_Byte(wifi_data, 2);
 935   1        delay_ms(300);
 936   1        UH010_ReadDatas(wifi_data, 0, data_2, 2);
 937   1        if (data_2[0] == 'J' && data_2[1] == 'E') //Êó†ÂìçÂ∫î
 938   1          return 0xff;
 939   1        else if (data_2[0] == 'J' && data_2[1] == '0') //ÂÖ≥Èó≠ÊãçÁÖßÂΩïÂÉè(ËÆæÂ§á‰πãÂêéÂºÄÈó®ÈÉΩ‰∏ç‰ºöÂèëÈÄÅÊãçÁ
             -ÖßÂíåÂΩïÂÉèÂëΩ‰ª§)
 940   1          return 0;
 941   1        else if (data_2[0] == 'J' && data_2[1] == '1') //ÂºÄÂêØÊãçÁÖßÂÖ≥Èó≠ÂΩïÂÉè
 942   1          return 1;
 943   1        else if (data_2[0] == 'J' && data_2[1] == '2') //ÂÖ≥Èó≠ÊãçÁÖßÂºÄÂêØÂΩïÂÉè
 944   1          return 2;
 945   1        else if (data_2[0] == 'J' && data_2[1] == '3') //ÂºÄÂêØÊãçÁÖßÂºÄÂêØÂΩïÂÉè
 946   1          return 3;
 947   1        else
 948   1          return 0xff;
 949   1      }
 950          
 951          void wifi_send_fp_110(void)
 952          {
 953   1        uint8_t wifi_data[2];
 954   1        wifi_data[0] = WIFI_CMD_WF_OPEN_FP_110;
 955   1        wifi_data[1] = 100;
 956   1        UH010_Write_Byte(wifi_data, 2);
 957   1      }
 958          
 959          void wifi_send_pwd_110(void)
 960          {
 961   1        uint8_t wifi_data[2];
 962   1        wifi_data[0] = WIFI_CMD_WF_OPEN_PSW_110;
 963   1        wifi_data[1] = 100;
 964   1        UH010_Write_Byte(wifi_data, 2);
 965   1      }
 966          
 967          void wifi_set_110(void)
 968          {
 969   1        uint8_t wifi_data[2];
 970   1        wifi_data[0] = WIFI_CMD_WF_SET_110;
 971   1        wifi_data[1] = 100;
 972   1        UH010_Write_Byte(wifi_data, 2);
 973   1      }
 974          
 975          #endif


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2207    ----
   CONSTANT SIZE    =     11    ----
   XDATA SIZE       =      5     109
   PDATA SIZE       =   ----    ----
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/10/2021 16:21:32 PAGE 17  

   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
