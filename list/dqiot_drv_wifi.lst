C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/15/2021 10:13:17 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE DQIOT_DRV_WIFI
OBJECT MODULE PLACED IN .\output\dqiot_drv_wifi.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE source\dqiot_drv_wifi.c LARGE OMF2 OPTIMIZE(8,SPEED) BROWSE INCDIR(.\inc
                    -lude;.\Library\byd_standard_peripheral\include;.\byd_api\byd_key\include;.\byd_api\byd_mifare\include;.\byd_tool_comm;.\
                    -byd_rfid;.\mmi_inc) DEBUG PRINT(.\list\dqiot_drv_wifi.lst) TABS(2) OBJECT(.\output\dqiot_drv_wifi.obj)

line level    source

   1          #ifndef __DQIOT_DRV_WIFI_H__
   2          #define __DQIOT_DRV_WIFI_H__
   3          #include "dqiot_drv_wifi.h"
   4          #include "mmi_feature.h"
   5          #include "iic_master.h"
   6          #include "delay.h"
   7          #include "mmi_fs.h"
   8          #include "mmi_audio.h"
   9          #include "mmi_wifi.h"
  10          #include "mmi_fps.h"
  11          #include "mmi_ms.h"
  12          // #include <stdio.h>
  13          
  14          unsigned char wifi_add_flag = 0;
  15          extern unsigned char uart_get_buf[];
  16          extern unsigned char uart_getbuflen;
  17          // extern void printfS(char *show, char *status);
  18          // extern void printfV(char *show, int value);
  19          
  20          /**
  21            * @brief  ‰∏≤Âè£Êï∞ÊçÆÊé•Êî∂
  22            * @param  send    ÂèëÈÄÅÊï∞ÊçÆ
  23            * @param  send_len  ÂèëÈÄÅÊï∞ÊçÆÈïøÂ∫¶
  24            * @param  Buf     Êé•Êî∂Êï∞ÊçÆ
  25            * @param  len     Êé•Êî∂Êï∞ÊçÆÈïøÂ∫¶
  26            * @return ‰∏≤Âè£Êï∞ÊçÆ
  27            * @note   none
  28            * @see    none
  29            */
  30          uint8_t UH010_ReadDatas(uint8_t *send, uint8_t send_len, uint8_t *Buf, uint8_t len)
  31          {
  32   1      #if 0
                uint8_t i;
              
                if (send_len > 0)
                {
                  EA = 0;
                  iic_master_start();
              
                  if (iic_sendbyte_and_getnack(WIFI_ADDR))
                  {
                    //iic_master_stop();
                    //EA = 1;
                    //return 1;
                  }
              
                  for (i = 0; i < send_len; i++)
                  {
                    if (iic_sendbyte_and_getnack(send[i]))
                    {
                      //iic_master_stop();
                      //EA = 1;
                      //return 1;
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/15/2021 10:13:17 PAGE 2   

                    }
                  }
              
                  if (iic_sendbyte_and_getnack(WIFI_ADDR | 0x01))
                  {
                    //iic_master_stop();
                    //EA = 1;
                    //return 1;
                  }
              
                  for (i = 0; i < len; i++)
                  {
                    Buf[i] = iic_receive_byte();
                    if (i == (len - 1))
                      break;
                    iic_respond(ACK);
                  }
              
                  iic_respond(NACK);
              
                  EA = 1;
                  iic_master_stop();
                }
                else
                {
                  EA = 0;
                  iic_master_start();
                  if (iic_sendbyte_and_getnack(WIFI_ADDR | 0x01))
                  {
                    //iic_master_stop();
                    //EA = 1;
                    //return 1;
                  }
              
                  for (i = 0; i < len; i++)
                  {
                    Buf[i] = iic_receive_byte();
                    if (i == (len - 1))
                      break;
                    iic_respond(ACK);
                  }
              
                  iic_respond(NACK);
              
                  EA = 1;
                  iic_master_stop();
                }
              
                return 0;
              #else
 104   1        uint8_t i = 0, j = 0;
 105   1        uint16_t waittime = 1000;
 106   1      
 107   1        if (send_len > 0)
 108   1        {
 109   2          EA = 0;
 110   2      
 111   2          for (i = 0; i < send_len; i++)
 112   2            uart_tx_byte(UART0, send[i]);
 113   2      
 114   2          while (--waittime)
 115   2          {
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/15/2021 10:13:17 PAGE 3   

 116   3            delay_ms(1);
 117   3      
 118   3            if (uart_getbuflen >= 2)
 119   3            {
 120   4              /* ÂØªÊâæÂåÖÂ§¥ */
 121   4              for (i = 0; i < uart_getbuflen; i++)
 122   4              {
 123   5                if (uart_get_buf[i] == 'K' || uart_get_buf[i] == 'I' || uart_get_buf[i] == 'B' || uart_get_buf[i] == 
             -'F' || uart_get_buf[i] == 'R' || uart_get_buf[i] == 'M' || uart_get_buf[i] == 'J' || uart_get_buf[i] == 'q')
 124   5                  break;
 125   5              }
 126   4      
 127   4              for (i; i < uart_getbuflen; i++)
 128   4              {
 129   5                Buf[j] = uart_get_buf[i];
 130   5                if (j == (len - 1))
 131   5                  break;
 132   5                j++;
 133   5              }
 134   4      
 135   4              /* Ê∏ÖÁ©∫ÁºìÂ≠ò */
 136   4              uart_getbuflen = 0;
 137   4              EA = 1;
 138   4      
 139   4              return 0;
 140   4            }
 141   3          }
 142   2      
 143   2          EA = 1;
 144   2        }
 145   1        else
 146   1        {
 147   2          EA = 0;
 148   2      
 149   2          while (--waittime)
 150   2          {
 151   3            delay_ms(1);
 152   3      
 153   3            if (uart_getbuflen >= 2)
 154   3            {
 155   4              /* ÂØªÊâæÂåÖÂ§¥ */
 156   4              for (i = 0; i < uart_getbuflen; i++)
 157   4              {
 158   5                if (uart_get_buf[i] == 'K' || uart_get_buf[i] == 'I' || uart_get_buf[i] == 'B' || uart_get_buf[i] == 
             -'F' || uart_get_buf[i] == 'R' || uart_get_buf[i] == 'M' || uart_get_buf[i] == 'J' || uart_get_buf[i] == 'q')
 159   5                  break;
 160   5              }
 161   4      
 162   4              for (i; i < uart_getbuflen; i++)
 163   4              {
 164   5                Buf[j] = uart_get_buf[i];
 165   5                if (j == (len - 1))
 166   5                  break;
 167   5                j++;
 168   5              }
 169   4      
 170   4              /* Ê∏ÖÁ©∫ÁºìÂ≠ò */
 171   4              uart_getbuflen = 0;
 172   4              EA = 1;
 173   4      
 174   4              return 0;
 175   4            }
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/15/2021 10:13:17 PAGE 4   

 176   3          }
 177   2      
 178   2          EA = 1;
 179   2        }
 180   1      
 181   1        return 0;
 182   1      #endif
 183   1      }
 184          
 185          /**
 186            * @brief  ‰∏≤Âè£Êï∞ÊçÆÂèëÁîü
 187            * @param  send    ÂèëÈÄÅÊï∞ÊçÆ
 188            * @param  send_len  ÂèëÈÄÅÊï∞ÊçÆÈïøÂ∫¶
 189            * @return none
 190            * @note   none
 191            * @see    none
 192            */
 193          uint8_t UH010_Write_Byte(uint8_t *send, uint8_t send_len)
 194          {
 195   1      #if 0
                uint8_t i;
              
                EA = 0;
                iic_master_start();
              
                if (iic_sendbyte_and_getnack(WIFI_ADDR & ~0x01))
                {
                  iic_master_stop();
                  EA = 1;
                  return 1;
                }
              
                for (i = 0; i < send_len; i++)
                {
                  if (iic_sendbyte_and_getnack(send[i]))
                  {
                    iic_master_stop();
                    EA = 1;
                    return 1;
                  }
                }
                EA = 1;
                iic_master_stop();
              
                return 0;
              #else
 222   1        uint8_t i;
 223   1      
 224   1        EA = 0;
 225   1        uart_getbuflen = 0;
 226   1      
 227   1        for (i = 0; i < send_len; i++)
 228   1          uart_tx_byte(UART0, send[i]);
 229   1      
 230   1        EA = 1;
 231   1      
 232   1        return 0;
 233   1      #endif
 234   1      }
 235          
 236          /*
 237          parameter: 
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/15/2021 10:13:17 PAGE 5   

 238            none
 239          return :
 240            none
 241          */
 242          void wifi_uh316_init(void)
 243          {
 244   1      }
 245          
 246          /**
 247            * @brief  Êô∫ËÉΩÈÖçÁΩëÔºàÂèëÈÄÅÔºâ
 248            * @param  none
 249            * @return none
 250            * @note   none
 251            * @see    none
 252            */
 253          uint8_t wifi_net_connect_send(void)
 254          {
 255   1        uint8_t wifi_data[2];
 256   1        wifi_data[0] = WIFI_CMD_NET_CON;
 257   1        wifi_data[1] = 100;
 258   1        if (UH010_Write_Byte(wifi_data, 2) == 0)
 259   1          return 1;
 260   1        else
 261   1          return 0;
 262   1      }
 263          
 264          /**
 265            * @brief  AirkissÈÖçÁΩëÔºàÂèëÈÄÅÔºâ
 266            * @param  none
 267            * @return none
 268            * @note   none
 269            * @see    none
 270            */
 271          uint8_t wifi_net_airkiss_connect_send(void)
 272          {
 273   1        uint8_t wifi_data[2];
 274   1        wifi_data[0] = WIFI_CMD_AIRKISS_NET_CON;
 275   1        wifi_data[1] = 100;
 276   1        if (UH010_Write_Byte(wifi_data, 2) == 0)
 277   1          return 1;
 278   1        else
 279   1          return 0;
 280   1      }
 281          
 282          /**
 283            * @brief  ‰∫åÁª¥Á†ÅÈÖçÁΩëÔºàÂèëÈÄÅÔºâ
 284            * @param  none
 285            * @return none
 286            * @note   none
 287            * @see    none
 288            */
 289          uint8_t wifi_net_code_connect_send(void)
 290          {
 291   1        uint8_t wifi_data[2];
 292   1        wifi_data[0] = WIFI_CMD_CODE_NET_CON;
 293   1        wifi_data[1] = 100;
 294   1        if (UH010_Write_Byte(wifi_data, 2) == 0)
 295   1          return 1;
 296   1        else
 297   1          return 0;
 298   1      }
 299          
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/15/2021 10:13:17 PAGE 6   

 300          /**
 301            * @brief  ÈÖçÁΩëÁä∂ÊÄÅÔºàÊé•Êî∂Ôºâ
 302            * @param  none
 303            * @return none
 304            * @note   none
 305            * @see    none
 306            */
 307          uint8_t wifi_net_connect_state(void)
 308          {
 309   1        uint8_t wifi_data[2];
 310   1        uint8_t data_2[2] = {0};
 311   1        wifi_data[0] = WIFI_CMD_NET_STATE;
 312   1        wifi_data[1] = 100;
 313   1        UH010_Write_Byte(wifi_data, 2);
 314   1        delay_ms(50);
 315   1        UH010_ReadDatas(wifi_data, 0, data_2, 2);
 316   1        if (data_2[0] == 'I' && data_2[1] == 'O')
 317   1          return 1;
 318   1        if (data_2[0] == 'I' && data_2[1] == 'E')
 319   1          return 2;
 320   1        else
 321   1          return 0;
 322   1      }
 323          
 324          /**
 325            * @brief  Êü•ËØ¢ÁΩëÁªúÁä∂ÊÄÅ
 326            * @param  none
 327            * @return none
 328            * @note   none
 329            * @see    none
 330            */
 331          uint8_t wifi_check_net(void)
 332          {
 333   1        uint8_t wifi_data[2];
 334   1        uint8_t data_2[2] = {0};
 335   1        wifi_data[0] = WIFI_CMD_CHECK_NET;
 336   1        wifi_data[1] = 100;
 337   1        UH010_Write_Byte(wifi_data, 2);
 338   1        delay_ms(50);
 339   1        UH010_ReadDatas(wifi_data, 0, data_2, 2);
 340   1        if (data_2[0] == 'q' && data_2[1] == 'O')
 341   1          return 1;
 342   1        else
 343   1          return 0;
 344   1      }
 345          
 346          /**
 347            * @brief  ÊãçÁÖß
 348            * @param  none
 349            * @return none
 350            * @note   none
 351            * @see    none
 352            */
 353          uint8_t wifi_take_photos(void)
 354          {
 355   1        uint8_t wifi_data[2];
 356   1        wifi_data[0] = WIFI_CMD_TAKE_PHOTOS;
 357   1        wifi_data[1] = 100;
 358   1        UH010_Write_Byte(wifi_data, 2);
 359   1        return 1;
 360   1      }
 361          
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/15/2021 10:13:17 PAGE 7   

 362          /**
 363            * @brief  ÂΩïÂÉè
 364            * @param  none
 365            * @return none
 366            * @note   none
 367            * @see    none
 368            */
 369          uint8_t wifi_take_videos(void)
 370          {
 371   1        uint8_t wifi_data[2];
 372   1        wifi_data[0] = WIFI_CMD_TAKE_VIDEOS;
 373   1        wifi_data[1] = 100;
 374   1        UH010_Write_Byte(wifi_data, 2);
 375   1        return 1;
 376   1      }
 377          
 378          /**
 379            * @brief  ÂèëÈÄÅÊï∞ÊçÆÂåÖ
 380            * @param  cmd   ÂëΩ‰ª§
 381            * @param  pv    ÁîµÊµÅ
 382            * @param  index ÁºñÂè∑(0xff=null)
 383            * @return status
 384            * @note   none
 385            * @see    none
 386            */
 387          uint8_t wifi_data_package(uint8_t cmd, uint8_t pv, uint8_t index)
 388          {
 389   1        uint8_t wifi_data[3];
 390   1        wifi_data[0] = cmd;
 391   1        wifi_data[1] = pv;
 392   1        wifi_data[2] = index;
 393   1      
 394   1        if (index == 0xff)
 395   1          UH010_Write_Byte(wifi_data, 2);
 396   1        else
 397   1          UH010_Write_Byte(wifi_data, 3);
 398   1      
 399   1        return 1;
 400   1      }
 401          
 402          /**
 403            * @brief  ËøúÁ®ãÂºÄÈó®ÔºàÂèëÈÄÅÔºâ
 404            * @param  none
 405            * @return none
 406            * @note   none
 407            * @see    none
 408            */
 409          uint8_t wifi_open_ask(void)
 410          {
 411   1        uint8_t wifi_data[2];
 412   1        wifi_data[0] = WIFI_CMD_WF_OPEN_ASK;
 413   1        wifi_data[1] = 100;
 414   1        if (UH010_Write_Byte(wifi_data, 2) == 0)
 415   1          return 1;
 416   1        else
 417   1          return 0;
 418   1      }
 419          
 420          /**
 421            * @brief  ËøúÁ®ãÂºÄÈó®ÔºàÊé•Êî∂Ôºâ
 422            * @param  none
 423            * @return none
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/15/2021 10:13:17 PAGE 8   

 424            * @note   none
 425            * @see    none
 426            */
 427          uint8_t wifi_open_reply_get(void)
 428          {
 429   1        uint8_t wifi_data[2];
 430   1        uint8_t data_2[2] = {0};
 431   1        wifi_data[0] = WIFI_CMD_WF_OPEN_REPLY;
 432   1        wifi_data[1] = 100;
 433   1        UH010_Write_Byte(wifi_data, 2);
 434   1        delay_ms(300);
 435   1        UH010_ReadDatas(wifi_data, 0, data_2, 2);
 436   1      
 437   1        // printfV("data_2[0]", (int)data_2[0]);
 438   1        // printfV("data_2[1]", (int)data_2[1]);
 439   1      
 440   1        if (data_2[0] == 'K' && data_2[1] == 'O')
 441   1          return 1;
 442   1        else if (data_2[0] == 'K' && data_2[1] == 'E')
 443   1          return 2;
 444   1        else if (data_2[0] == 'K' && data_2[1] == 'K')
 445   1          return 3;
 446   1        else
 447   1          return 0;
 448   1      }
 449          
 450          /**
 451            * @brief  Ê∑ªÂä†Âà†Èô§ÂØÜÁ†Å/ÊåáÁ∫π/RFÂç°
 452            * @param  none
 453            * @return none
 454            * @note   none
 455            * @see    none
 456            */
 457          uint8_t wifi_cmd_add_del(void)
 458          {
 459   1        RET_VAL retval = 0;
 460   1        uint8_t wifi_data[2];
 461   1        uint8_t data_2[3] = {0};
 462   1        wifi_data[0] = WIFI_CMD_ADD_DEL;
 463   1        wifi_data[1] = 100;
 464   1        UH010_Write_Byte(wifi_data, 2);
 465   1        delay_ms(300);
 466   1        UH010_ReadDatas(wifi_data, 0, data_2, 3);
 467   1      
 468   1        // printfV("data_2[0]", (int)data_2[0]);
 469   1        // printfV("data_2[1]", (int)data_2[1]);
 470   1        // printfV("data_2[2]", (int)data_2[2]);
 471   1      
 472   1        if (data_2[0] == 'B')
 473   1        {
 474   2          switch (data_2[1])
 475   2          {
 476   3          case 'L':
 477   3            return 0;
 478   3          case 'E':
 479   3            mmi_dq_aud_play_with_id(AUD_BASE_ID_FAIL);
 480   3            return 0xff;
 481   3          case 'M':
 482   3            wifi_add_flag = 1;
 483   3            mmi_dq_aud_play_with_id(AUD_ID_INPUT_68_PWD);
 484   3            mmi_dq_ms_set_sys_state(SYS_STATUS_ADD_PWD);
 485   3            break;
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/15/2021 10:13:17 PAGE 9   

 486   3      #ifdef __LOCK_FP_SUPPORT__
                  case 'F':
                    wifi_add_flag = 1;
                    mmi_dq_aud_play_with_id(AUD_ID_PRESS_FP);
                    mmi_dq_ms_set_sys_state(SYS_STATUS_ADD_FP);
                    break;
              #endif
 493   3      #ifdef __LOCK_RFID_CARD_SUPPORT__
 494   3          case 'R':
 495   3            wifi_add_flag = 1;
 496   3            mmi_dq_aud_play_with_id(AUD_ID_PRESS_RFCARD);
 497   3            mmi_dq_ms_set_sys_state(SYS_STATUS_ADD_RFID);
 498   3            break;
 499   3      #endif
 500   3          }
 501   2        }
 502   1        else if (data_2[0] == 'M' || data_2[0] == 'F' || data_2[0] == 'R')
 503   1        {
 504   2          if (data_2[2] == 0x00) //48 => 0,57 => 9
 505   2            get_index = data_2[1] - '0';
 506   2          else
 507   2            get_index = (data_2[1] - '0') * 10 + (data_2[2] - '0');
 508   2          // printfV("get_index", (int)get_index);
 509   2      
 510   2          switch (data_2[0])
 511   2          {
 512   3          case 'M':
 513   3            retval = mmi_dq_fs_del_pwd(get_index, FDS_USE_TYPE_USER);
 514   3            if (retval == RET_SUCESS)
 515   3            {
 516   4              mmi_dq_aud_play_with_id(AUD_ID_DEL_PWD_SUCESS);
 517   4              mmi_dq_wifi_del_password(get_index);
 518   4            }
 519   3            else
 520   3              mmi_dq_aud_play_with_id(AUD_ID_DEL_FAIL);
 521   3            break;
 522   3      #ifdef __LOCK_FP_SUPPORT__
                  case 'F':
                    retval = mmi_dq_fs_del_fp(get_index, FDS_USE_TYPE_USER);
                    if (retval == RET_SUCESS)
                      retval = mmi_dq_fp_delete((unsigned short)get_index);
                    if (retval == 0)
                    {
                      mmi_dq_aud_play_with_id(AUD_ID_DEL_FP_SUCESS);
                      mmi_dq_wifi_del_fp(get_index);
                    }
                    else
                      mmi_dq_aud_play_with_id(AUD_ID_DEL_FAIL);
                    break;
              #endif
 536   3      #ifdef __LOCK_RFID_CARD_SUPPORT__
 537   3          case 'R':
 538   3            retval = mmi_dq_fs_del_rfid(get_index);
 539   3            if (retval == RET_SUCESS)
 540   3            {
 541   4              mmi_dq_aud_play_with_id(AUD_ID_DEL_RFCARD_SUCESS);
 542   4              mmi_dq_wifi_del_rfid_suc(get_index);
 543   4            }
 544   3            else
 545   3              mmi_dq_aud_play_with_id(AUD_ID_DEL_FAIL);
 546   3            break;
 547   3      #endif
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/15/2021 10:13:17 PAGE 10  

 548   3          }
 549   2        }
 550   1        else
 551   1          return 0;
 552   1      
 553   1        return 1;
 554   1      }
 555          
 556          /**
 557            * @brief  Èó®Êú™ÂÖ≥
 558            * @param  none
 559            * @return none
 560            * @note   none
 561            * @see    none
 562            */
 563          void wifi_close_over_time(void)
 564          {
 565   1        uint8_t wifi_data[2];
 566   1        wifi_data[0] = WIFI_CMD_CLOSE_OVER_TIME;
 567   1        wifi_data[1] = 100;
 568   1        UH010_Write_Byte(wifi_data, 2);
 569   1      }
 570          
 571          /**
 572            * @brief  Âî§ÈÜí
 573            * @param  none
 574            * @return none
 575            * @note   none
 576            * @see    none
 577            */
 578          unsigned char wifi_wake_up(void)
 579          {
 580   1      
 581   1        uint8_t wifi_data[2];
 582   1        wifi_data[0] = WIFI_CMD_WAKEUP;
 583   1        wifi_data[1] = 100;
 584   1        return UH010_Write_Byte(wifi_data, 2);
 585   1      }
 586          
 587          /**
 588            * @brief  Áù°Áú†
 589            * @param  none
 590            * @return none
 591            * @note   none
 592            * @see    none
 593            */
 594          void wifi_sleep_mode(void)
 595          {
 596   1        uint8_t wifi_data[2];
 597   1        wifi_data[0] = WIFI_CMD_SLEEP;
 598   1        wifi_data[1] = 100;
 599   1        UH010_Write_Byte(wifi_data, 2);
 600   1      }
 601          
 602          /**
 603            * @brief  Ê∑ªÂä†ÂØÜÁ†Å
 604            * @param  index
 605            * @return none
 606            * @note   none
 607            * @see    none
 608            */
 609          void wifi_add_password(uint8_t index)
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/15/2021 10:13:17 PAGE 11  

 610          {
 611   1        uint8_t wifi_data[2];
 612   1        wifi_data[0] = WIFI_CMD_ADD_PW;
 613   1        wifi_data[1] = 100;
 614   1        wifi_data[2] = index;
 615   1        UH010_Write_Byte(wifi_data, 3);
 616   1      }
 617          
 618          /**
 619            * @brief  Âà†Èô§ÂØÜÁ†Å
 620            * @param  index
 621            * @return none
 622            * @note   none
 623            * @see    none
 624            */
 625          void wifi_del_password(uint8_t index)
 626          {
 627   1        uint8_t wifi_data[2];
 628   1        wifi_data[0] = WIFI_CMD_DEL_PW;
 629   1        wifi_data[1] = 100;
 630   1        wifi_data[2] = index;
 631   1        UH010_Write_Byte(wifi_data, 3);
 632   1      }
 633          
 634          /**
 635            * @brief  Ê∑ªÂä†ÊåáÁ∫π
 636            * @param  index
 637            * @return none
 638            * @note   none
 639            * @see    none
 640            */
 641          void wifi_add_fp(uint8_t index)
 642          {
 643   1        uint8_t wifi_data[2];
 644   1        wifi_data[0] = WIFI_CMD_ADD_FP;
 645   1        wifi_data[1] = 100;
 646   1        wifi_data[2] = index;
 647   1        UH010_Write_Byte(wifi_data, 3);
 648   1      }
 649          
 650          /**
 651            * @brief  Âà†Èô§ÊåáÁ∫π
 652            * @param  index
 653            * @return none
 654            * @note   none
 655            * @see    none
 656            */
 657          void wifi_del_fp(uint8_t index)
 658          {
 659   1        uint8_t wifi_data[2];
 660   1        wifi_data[0] = WIFI_CMD_DEL_FP;
 661   1        wifi_data[1] = 100;
 662   1        wifi_data[2] = index;
 663   1        UH010_Write_Byte(wifi_data, 3);
 664   1      }
 665          
 666          /**
 667            * @brief  Ê∑ªÂä†RFÂç°
 668            * @param  index
 669            * @return none
 670            * @note   none
 671            * @see    none
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/15/2021 10:13:17 PAGE 12  

 672            */
 673          void wifi_add_rf(uint8_t index)
 674          {
 675   1        uint8_t wifi_data[2];
 676   1        wifi_data[0] = WIFI_CMD_ADD_RF;
 677   1        wifi_data[1] = 100;
 678   1        wifi_data[2] = index;
 679   1        UH010_Write_Byte(wifi_data, 3);
 680   1      }
 681          
 682          /**
 683            * @brief  Âà†Èô§RFÂç°
 684            * @param  index
 685            * @return none
 686            * @note   none
 687            * @see    none
 688            */
 689          void wifi_del_rf(uint8_t index)
 690          {
 691   1        uint8_t wifi_data[2];
 692   1        wifi_data[0] = WIFI_CMD_DEL_RF;
 693   1        wifi_data[1] = 100;
 694   1        wifi_data[2] = index;
 695   1        UH010_Write_Byte(wifi_data, 3);
 696   1      }
 697          
 698          /**
 699            * @brief  ÂØÜÁ†ÅÂÖ®ÈÉ®Ê∏ÖÈô§
 700            * @param  none
 701            * @return none
 702            * @note   none
 703            * @see    none
 704            */
 705          void wifi_clr_pwd(void)
 706          {
 707   1        uint8_t wifi_data[2];
 708   1        wifi_data[0] = WIFI_CMD_CLR_PW;
 709   1        wifi_data[1] = 100;
 710   1        UH010_Write_Byte(wifi_data, 2);
 711   1      }
 712          
 713          /**
 714            * @brief  ÊåáÁ∫πÂÖ®ÈÉ®Ê∏ÖÈô§
 715            * @param  none
 716            * @return none
 717            * @note   none
 718            * @see    none
 719            */
 720          void wifi_clr_fp(void)
 721          {
 722   1        uint8_t wifi_data[2];
 723   1        wifi_data[0] = WIFI_CMD_CLR_FP;
 724   1        wifi_data[1] = 100;
 725   1        UH010_Write_Byte(wifi_data, 2);
 726   1      }
 727          
 728          /**
 729            * @brief  RFÂç°ÂÖ®ÈÉ®Ê∏ÖÈô§
 730            * @param  none
 731            * @return none
 732            * @note   none
 733            * @see    none
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/15/2021 10:13:17 PAGE 13  

 734            */
 735          void wifi_clr_rf(void)
 736          {
 737   1        uint8_t wifi_data[2];
 738   1        wifi_data[0] = WIFI_CMD_CLR_RF;
 739   1        wifi_data[1] = 100;
 740   1        UH010_Write_Byte(wifi_data, 2);
 741   1      }
 742          
 743          /**
 744            * @brief  ËøúÁ®ãÂºÄÈó®
 745            * @param  none
 746            * @return none
 747            * @note   none
 748            * @see    none
 749            */
 750          void wifi_open_by_wifi(void)
 751          {
 752   1        uint8_t wifi_data[2];
 753   1        wifi_data[0] = WIFI_CMD_WF_OPEN;
 754   1        wifi_data[1] = 100;
 755   1        UH010_Write_Byte(wifi_data, 2);
 756   1      }
 757          
 758          /**
 759            * @brief  ÂØÜÁ†ÅÂºÄÈó®
 760            * @param  index
 761            * @return none
 762            * @note   none
 763            * @see    none
 764            */
 765          void wifi_open_by_password(uint8_t index)
 766          {
 767   1        uint8_t wifi_data[3];
 768   1        wifi_data[0] = WIFI_CMD_PW_OPEN;
 769   1        wifi_data[1] = 100;
 770   1        wifi_data[2] = index;
 771   1        UH010_Write_Byte(wifi_data, 3);
 772   1      }
 773          
 774          /**
 775            * @brief  ÊåáÁ∫πÂºÄÈó®
 776            * @param  index
 777            * @return none
 778            * @note   none
 779            * @see    none
 780            */
 781          void wifi_open_by_fp(uint8_t index)
 782          {
 783   1        uint8_t wifi_data[2];
 784   1        wifi_data[0] = WIFI_CMD_FP_OPEN;
 785   1        wifi_data[1] = 100;
 786   1        wifi_data[2] = index;
 787   1        UH010_Write_Byte(wifi_data, 3);
 788   1      }
 789          
 790          /**
 791            * @brief  RFÂç°ÊåáÁ∫π
 792            * @param  index
 793            * @return none
 794            * @note   none
 795            * @see    none
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/15/2021 10:13:17 PAGE 14  

 796            */
 797          void wifi_open_by_rfid(uint8_t index)
 798          {
 799   1        uint8_t wifi_data[2];
 800   1        wifi_data[0] = WIFI_CMD_RF_OPEN;
 801   1        wifi_data[1] = 100;
 802   1        wifi_data[2] = index;
 803   1        UH010_Write_Byte(wifi_data, 3);
 804   1      }
 805          
 806          /**
 807            * @brief  Â∫îÊÄ•Èí•ÂåôÂºÄÈó®
 808            * @param  none
 809            * @return none
 810            * @note   none
 811            * @see    none
 812            */
 813          void wifi_open_by_key(void)
 814          {
 815   1        uint8_t wifi_data[2];
 816   1        wifi_data[0] = WIFI_CMD_KEY_OPEN;
 817   1        wifi_data[1] = 100;
 818   1        UH010_Write_Byte(wifi_data, 2);
 819   1      }
 820          
 821          /*
 822          parameter: 
 823            none
 824          return :
 825            none
 826          */
 827          void wifi_door_close(void)
 828          {
 829   1        uint8_t wifi_data[2];
 830   1        wifi_data[0] = WIFI_CMD_CLOSE;
 831   1        wifi_data[1] = 100;
 832   1        UH010_Write_Byte(wifi_data, 2);
 833   1      }
 834          
 835          /**
 836            * @brief  ÈúáÂä®Êä•Ë≠¶
 837            * @param  none
 838            * @return none
 839            * @note   none
 840            * @see    none
 841            */
 842          void wifi_via_alarm(void)
 843          {
 844   1        uint8_t wifi_data[2];
 845   1        wifi_data[0] = WIFI_CMD_VIA_ALARM;
 846   1        wifi_data[1] = 100;
 847   1        UH010_Write_Byte(wifi_data, 2);
 848   1      }
 849          
 850          /**
 851            * @brief  Â§öÊ¨°ÂØÜÁ†ÅÈîôËØØ
 852            * @param  none
 853            * @return none
 854            * @note   none
 855            * @see    none
 856            */
 857          void wifi_pw_alarm(void)
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/15/2021 10:13:17 PAGE 15  

 858          {
 859   1        uint8_t wifi_data[2];
 860   1        wifi_data[0] = WIFI_CMD_PW_ALARM;
 861   1        wifi_data[1] = 100;
 862   1        UH010_Write_Byte(wifi_data, 2);
 863   1      }
 864          
 865          /**
 866            * @brief  Â§öÊ¨°ÊåáÁ∫πÈîôËØØ
 867            * @param  none
 868            * @return none
 869            * @note   none
 870            * @see    none
 871            */
 872          void wifi_fp_alarm(void)
 873          {
 874   1        uint8_t wifi_data[2];
 875   1        wifi_data[0] = WIFI_CMD_FP_ALARM;
 876   1        wifi_data[1] = 100;
 877   1        UH010_Write_Byte(wifi_data, 2);
 878   1      }
 879          
 880          /**
 881            * @brief  Â§öÊ¨°RFÂç°ÈîôËØØ
 882            * @param  none
 883            * @return none
 884            * @note   none
 885            * @see    none
 886            */
 887          void wifi_rf_alarm(void)
 888          {
 889   1        uint8_t wifi_data[2];
 890   1        wifi_data[0] = WIFI_CMD_RF_ALARM;
 891   1        wifi_data[1] = 100;
 892   1        UH010_Write_Byte(wifi_data, 2);
 893   1      }
 894          
 895          /**
 896            * @brief  ‰ΩéÁîµÈáè
 897            * @param  none
 898            * @return none
 899            * @note   none
 900            * @see    none
 901            */
 902          void wifi_lowpower_alarm(void)
 903          {
 904   1        uint8_t wifi_data[2];
 905   1        wifi_data[0] = WIFI_CMD_LOWPOWER_ALARM;
 906   1        wifi_data[1] = 100;
 907   1        UH010_Write_Byte(wifi_data, 2);
 908   1      }
 909          
 910          /**
 911            * @brief  ÊãçÁÖßÂΩïÂÉèÂºÄÂÖ≥ÔºàÂèëÈÄÅÔºâ
 912            * @param  none
 913            * @return none
 914            * @note   none
 915            * @see    none
 916            */
 917          void wifi_pv_switch_send(void)
 918          {
 919   1        uint8_t wifi_data[2];
C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/15/2021 10:13:17 PAGE 16  

 920   1        wifi_data[0] = WIFI_CMD_PV_SWITCH_SEND;
 921   1        wifi_data[1] = 100;
 922   1        UH010_Write_Byte(wifi_data, 2);
 923   1      }
 924          
 925          /**
 926            * @brief  ÊãçÁÖßÂΩïÂÉèÂºÄÂÖ≥ÔºàÊé•Êî∂Ôºâ
 927            * @param  none
 928            * @return none
 929            * @note   none
 930            * @see    none
 931            */
 932          uint8_t wifi_pv_switch_get(void)
 933          {
 934   1        uint8_t wifi_data[2];
 935   1        uint8_t data_2[2] = {0};
 936   1        wifi_data[0] = WIFI_CMD_PV_SWITCH_GET;
 937   1        wifi_data[1] = 100;
 938   1        UH010_Write_Byte(wifi_data, 2);
 939   1        delay_ms(300);
 940   1        UH010_ReadDatas(wifi_data, 0, data_2, 2);
 941   1        if (data_2[0] == 'J' && data_2[1] == 'E') //Êó†ÂìçÂ∫î
 942   1          return 0xff;
 943   1        else if (data_2[0] == 'J' && data_2[1] == '0') //ÂÖ≥Èó≠ÊãçÁÖßÂΩïÂÉè(ËÆæÂ§á‰πãÂêéÂºÄÈó®ÈÉΩ‰∏ç‰ºöÂèëÈÄÅÊãçÁ
             -ÖßÂíåÂΩïÂÉèÂëΩ‰ª§)
 944   1          return 0;
 945   1        else if (data_2[0] == 'J' && data_2[1] == '1') //ÂºÄÂêØÊãçÁÖßÂÖ≥Èó≠ÂΩïÂÉè
 946   1          return 1;
 947   1        else if (data_2[0] == 'J' && data_2[1] == '2') //ÂÖ≥Èó≠ÊãçÁÖßÂºÄÂêØÂΩïÂÉè
 948   1          return 2;
 949   1        else if (data_2[0] == 'J' && data_2[1] == '3') //ÂºÄÂêØÊãçÁÖßÂºÄÂêØÂΩïÂÉè
 950   1          return 3;
 951   1        else
 952   1          return 0xff;
 953   1      }
 954          
 955          void wifi_send_fp_110(void)
 956          {
 957   1        uint8_t wifi_data[2];
 958   1        wifi_data[0] = WIFI_CMD_WF_OPEN_FP_110;
 959   1        wifi_data[1] = 100;
 960   1        UH010_Write_Byte(wifi_data, 2);
 961   1      }
 962          
 963          void wifi_send_pwd_110(void)
 964          {
 965   1        uint8_t wifi_data[2];
 966   1        wifi_data[0] = WIFI_CMD_WF_OPEN_PSW_110;
 967   1        wifi_data[1] = 100;
 968   1        UH010_Write_Byte(wifi_data, 2);
 969   1      }
 970          
 971          void wifi_set_110(void)
 972          {
 973   1        uint8_t wifi_data[2];
 974   1        wifi_data[0] = WIFI_CMD_WF_SET_110;
 975   1        wifi_data[1] = 100;
 976   1        UH010_Write_Byte(wifi_data, 2);
 977   1      }
 978          
 979          #endif

C51 COMPILER V9.59.0.0   DQIOT_DRV_WIFI                                                    04/15/2021 10:13:17 PAGE 17  


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2127    ----
   CONSTANT SIZE    =     11    ----
   XDATA SIZE       =      1     109
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
