C51 COMPILER V9.59.0.0   DQIOT_FP_SY                                                       04/20/2021 16:21:03 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE DQIOT_FP_SY
OBJECT MODULE PLACED IN .\output\dqiot_fp_sy.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE source\dqiot_fp_sy.c LARGE OMF2 OPTIMIZE(8,SPEED) BROWSE INCDIR(.\includ
                    -e;.\Library\byd_standard_peripheral\include;.\byd_api\byd_key\include;.\byd_api\byd_mifare\include;.\byd_tool_comm;.\byd
                    -_rfid;.\mmi_inc) DEBUG PRINT(.\list\dqiot_fp_sy.lst) TABS(2) OBJECT(.\output\dqiot_fp_sy.obj)

line level    source

   1          #include "mmi_feature.h"
   2          #if defined(__LOCK_FP_SY_SUPPORT__)
              #include "string.h"
              #include "dqiot_fp_sy.h"
              #include "delay.h"
              #include "dqiot_drv.h"
              #include "mcu02_uart.h"
              // #include <stdio.h>
              
              //unsigned long fp_pin_irq_mask;
              
              //fp_irq_handle_callback fp_callback_handle;
              //fp_uart_handle_callback fp_uart_handle = 0;
              //unsigned char fp_Mode = 0;
              //static unsigned char fp_temp_mode = 0;
              
              static unsigned char uart_rec_buff[20];
              
              //static FP_TYPE fp_flag = FP_NONE;
              static FP_COLOR_E Light_Color = FP_NONE_COLOR;
              //static unsigned char ps_start_flag = 0;
              
              extern unsigned char uart_get_buf[];
              extern unsigned char uart_getbuflen;
              
              //unsigned short  ReceiveInfo( unsigned char *rec_data);
              //void AS608_log(void);
              
              //void fp_set_irq_handle(fp_irq_handle_callback cb)
              //{
              //  fp_callback_handle = cb;
              //}
              
              //void fp_set_uart_handle(fp_uart_handle_callback cb)
              //{
              //  fp_uart_handle = cb;
              //}
              
              ///FP_TYPE fp_get_type(void)
              //{
              //  return fp_flag;
              
              //}
              
              //--------------------------------------------------------------------------------
              
              //static unsigned char uart_len=0;
              //static unsigned short uart_maxlen = 0;
              //static unsigned char uart_buff[25]={0};
              
              //static void UART_Callback(unsigned char send_data)
              //{
              //  send_data = 0;
C51 COMPILER V9.59.0.0   DQIOT_FP_SY                                                       04/20/2021 16:21:03 PAGE 2   

              //}
              
              //unsigned char fp_GetModeState(void)
              //{
              //  return fp_Mode;
              //}
              
              //void fp_SetModeState(unsigned char s)
              //{
              //  fp_Mode = s;
              
              //  if(s == 0)
              //    Light_Color = FP_NONE_COLOR;
              //}
              
              //static void PS_UART_Callback(unsigned char send_data)
              //{
              //  if(send_data == 0x55 )
              //  {
              //    ps_start_flag = 1;
              //  }
              //}
              
              //void FP_PowerOn(void)
              //{
              
              //}
              
              /**
                * @brief  AS608_USARTä¸²å£å‘æŒ‡çº¹æ¨¡å—ä¼ é€’æ•°æ® 
                * @param  data;ä¼ è¾“çš„æ•°æ®
                */
              void AS608_SendData(unsigned char send_data)
              {
                uart_tx_byte(UART0, send_data);
              }
              
              /**
                * @brief  AS608_USARTä¸²å£å‘æŒ‡çº¹æ¨¡å—å‘½ä»¤åŒ…å¤´æ ¼å¼ 
                * @param  æ— 
                */
              unsigned char AS608_PackHead(void)
              {
              
                //unsigned char delay_times = 30;
              
                //while(ps_start_flag==0&&delay_times>0)
                //{
                //  delay_times--;
                //}
                //if(ps_start_flag == 0)
                //{
                //  return 1;
                //}
                //else if(ps_start_flag == 1)
                //{
                //  uart_init_block();
                //  ps_start_flag = 2;
                //}
              
                dqiot_drv_uart0B_init();
                uart_getbuflen = 0;
C51 COMPILER V9.59.0.0   DQIOT_FP_SY                                                       04/20/2021 16:21:03 PAGE 3   

              
                /*åŒ…å¤´*/
                AS608_SendData(0xEF);
                AS608_SendData(0x01);
              
                /*æŒ‡çº¹æ¨¡å—åœ°å€*/
                AS608_SendData(AS608_Addr >> 24);
                AS608_SendData(AS608_Addr >> 16);
                AS608_SendData(AS608_Addr >> 8);
                AS608_SendData(AS608_Addr);
              
                return 0;
              }
              
              unsigned char AS608_PackHead2(void)
              {
              
                /*åŒ…å¤´*/
                AS608_SendData(0xEF);
                AS608_SendData(0x01);
              
                /*æŒ‡çº¹æ¨¡å—åœ°å€*/
                AS608_SendData(AS608_Addr >> 24);
                AS608_SendData(AS608_Addr >> 16);
                AS608_SendData(AS608_Addr >> 8);
                AS608_SendData(AS608_Addr);
              
                return 0;
              }
              
              /**
                * @brief  å‘é€åŒ…æ ‡è¯†
                * @param  flag:åŒ…æ ‡è¯†ä½
                * @retval æ— 
                */
              void SendFlag(unsigned char flag)
              {
                AS608_SendData(flag);
              }
              
              /**
                * @brief  å‘é€åŒ…é•¿åº¦
                * @param  length:åŒ…é•¿åº¦
                * @retval æ— 
                */
              void SendLength(unsigned short length)
              {
                AS608_SendData(length >> 8);
                AS608_SendData(length);
              }
              
              /**
                * @brief  å‘é€æŒ‡ä»¤ç 
                * @param  cmd;æŒ‡ä»¤ç 
                * @retval æ— 
                */
              void Sendcmd(unsigned char cmd)
              {
                AS608_SendData(cmd);
              }
              
              /**
C51 COMPILER V9.59.0.0   DQIOT_FP_SY                                                       04/20/2021 16:21:03 PAGE 4   

                * @brief  å‘é€æ ¡éªŒå’Œ
                * @param  check:æ£€æŸ¥ä½
                * @retval æ— 
                */
              void SendCheck(unsigned short check)
              {
                AS608_SendData(check >> 8);
                AS608_SendData(check);
              }
              
              /**
                * @brief  åˆ¤æ–­ä¸­æ–­æ¥æ”¶çš„æ•°ç»„æœ‰æ²¡æœ‰åº”ç­”åŒ…
                * @param  
                * waittimeä¸ºç­‰å¾…ä¸­æ–­æ¥æ”¶æ•°æ®çš„æ—¶é—´(å•ä½1ms)
                * lengthä¸ºåŒ…é•¿åº¦
                * @return æ•°æ®åŒ…ç¡®è®¤ç 
                * @note   1 failed
                * @see    none
                */
              static u8 JudgeStr(u16 waittime, u8 length)
              {
                u8 i = 0, j = 0;
                //u8 str[8];
                //str[0] = 0xEF;
                //str[1] = 0x01;
                //str[2] = AS608_Addr >> 24;
                //str[3] = AS608_Addr >> 16;
                //str[4] = AS608_Addr >> 8;
                //str[5] = AS608_Addr;
                //str[6] = 0x07;
              
                memset(uart_rec_buff, 0, sizeof(uart_rec_buff));
              
                while (--waittime)
                {
                  delay_ms(1);
              
                  /* æ¥æ”¶åˆ°ä¸€æ¬¡æ•°æ® */
                  if (uart_getbuflen >= 9 + length)
                  {
                    /* å¯»æ‰¾0xEFä½ç½® */
                    for (i = 0; i < uart_getbuflen; i++)
                    {
                      if (uart_get_buf[i] == 0xEF)
                        break;
                    }
              
                    /* åˆ¤æ–­æ˜¯å¦ä¸ºåº”ç­”åŒ… */
                    if (uart_get_buf[i] == 0xEF && uart_get_buf[i + 1] == 0x01 && uart_get_buf[i + 6] == 0x07 && ((uart_get
             -_buf[i + 7] << 8) + uart_get_buf[i + 8]) == length)
                    {
                      for (i; i < uart_getbuflen; i++)
                      {
                        uart_rec_buff[j] = uart_get_buf[i];
                        j++;
                      }
              
                      // dqiot_drv_uart0A_init();
                      // for (i = 0; i < uart_getbuflen - 1; i++)
                      //  printf("uart_rec_buff[%d] is %d\n", (int)i, (int)uart_rec_buff[i]);
                      // dqiot_drv_uart0B_init();
              
C51 COMPILER V9.59.0.0   DQIOT_FP_SY                                                       04/20/2021 16:21:03 PAGE 5   

                      /* æ¸…ç©ºç¼“å­˜ */
                      uart_getbuflen = 0;
              
                      return uart_rec_buff[9];
                    }
                  }
                }
              
                return 1;
              }
              
              #if 0
              /**
                * @brief  ä»ç¼“å†²åŒºè¯»å‡ºç¡®è®¤ç 
                * @param  *i:è¿”å›å€¼ï¼ˆç¡®è®¤ç ï¼‰
                * @retval æ— 
                */
              unsigned char  ReturnFlag( unsigned char *i)
              { 
                *i = ReceiveInfo(uart_rec_buff);
                return *i;
              }
              
              unsigned char  ReceiveInfo( unsigned char *rec_data)
              {
                unsigned char *temp_data;
                unsigned short rev_length = 0;
                unsigned char error = 0;
                unsigned char a = 9;
              
                memset(uart_rec_buff,0,sizeof(uart_rec_buff));
              
                do
                {
                  //error = nrf_drv_uart_rx(rec_data,1);
                  //if(error == NRF_ERROR_INTERNAL)
                  //  return 0xFF;
                  if(rec_data[0] == 0xEF)
                    break;
                  if(a==0)
                    return 0xFF;
                }while(a--);
                
              
                rev_length = (rec_data[7]<<8)+rec_data[8];
                temp_data = rec_data+9;
              
                if(rev_length!=0)
                  ;//nrf_drv_uart_rx(temp_data,rev_length);
                else
                  return 0xFF;
              
                AS608_log();
                return temp_data[0];
              }
              #endif
              
              unsigned char PS_GetEcho(void)
              {
                AS608_PackHead2();
                SendFlag(0x01);
                SendLength(0x03);
C51 COMPILER V9.59.0.0   DQIOT_FP_SY                                                       04/20/2021 16:21:03 PAGE 6   

                Sendcmd(0x53); /*ç”Ÿæˆç‰¹å¾æŒ‡ä»¤*/
                SendCheck(0x57);
              
                //sure=ReturnFlag(&p);
                return JudgeStr(1000, 0x03);
              }
              
              /**
                * @brief  æ£€æµ‹ä¼ æ„Ÿå™¨ PS_CheckSensor
                * @param  none
                * @return ç¡®è®¤ç (æ­£å¸¸0x00/é”™è¯¯0x29)
                * @note   none
                * @see    none
                */
              unsigned char PS_CheckSensor(void)
              {
                if (AS608_PackHead() == 1)
                  return 0xFF;
                SendFlag(0x01);
                SendLength(0x03);
                Sendcmd(0x36);
                SendCheck(0x01 + 0x03 + 0x36);
              
                return JudgeStr(1000, 0x03);
              }
              
              /**
                * @brief  æ£€æµ‹æ‰‹æŒ‡çŠ¶æ€ PS_CheckFinger
                * @param  none
                * @return ç¡®è®¤ç 
                * @note   none
                * @see    none
                */
              unsigned char PS_CheckFinger(void)
              {
                if (AS608_PackHead() == 1)
                  return 0xFF;
                SendFlag(0x01);
                SendLength(0x03);
                Sendcmd(0x2a);
                SendCheck(0x01 + 0x03 + 0x2a);
              
                return JudgeStr(1000, 0x03);
              }
              
              //å½•å…¥å›¾åƒ PS_GetImage
              //åŠŸèƒ½:æ¢æµ‹æ‰‹æŒ‡ï¼Œæ¢æµ‹åˆ°åå½•å…¥æŒ‡çº¹å›¾åƒå­˜äºImageBufferã€‚
              //æ¨¡å—è¿”å›ç¡®è®¤å­—
              unsigned char PS_GetImage(void)
              {
                //delay_ms(300);
                if (AS608_PackHead() == 1)
                  return 0xFF;
                SendFlag(0x01); /*å‘½ä»¤åŒ…æ ‡è¯†*/
                SendLength(0x03);
                Sendcmd(0x01); /*å½•æŒ‡çº¹æŒ‡ä»¤*/
                SendCheck(0x01 + 0x03 + 0x01);
              
                //nrf_delay_ms(50);        /*ç­‰å¾…æŒ‡çº¹è¯†åˆ«æ¨¡å—å¤„ç†æ•°æ®*/
              
                // sure = ReturnFlag(&p);
                return JudgeStr(1000, 0x03);
C51 COMPILER V9.59.0.0   DQIOT_FP_SY                                                       04/20/2021 16:21:03 PAGE 7   

              }
              
              //ç”Ÿæˆç‰¹å¾ PS_GenChar
              //åŠŸèƒ½:å°†ImageBufferä¸­çš„åŸå§‹å›¾åƒç”ŸæˆæŒ‡çº¹ç‰¹å¾æ–‡ä»¶å­˜äºCharBuffer1æˆ–CharBuffer2
              //å‚æ•°:BufferID --> charBuffer1:0x01  charBuffer1:0x02
              //æ¨¡å—è¿”å›ç¡®è®¤å­—
              unsigned char PS_GenChar(unsigned char BufferID)
              {
                if (AS608_PackHead() == 1)
                  return 0xFF;
                SendFlag(0x01);
                SendLength(0x04);
                Sendcmd(0x02); /*ç”Ÿæˆç‰¹å¾æŒ‡ä»¤*/
                AS608_SendData(BufferID);
                SendCheck(0x01 + 0x04 + 0x02 + BufferID);
                return JudgeStr(1000, 0x03);
              }
              
              //ç²¾ç¡®æ¯”å¯¹ä¸¤æšæŒ‡çº¹ç‰¹å¾ PS_Match
              //åŠŸèƒ½:ç²¾ç¡®æ¯”å¯¹CharBuffer1 ä¸CharBuffer2 ä¸­çš„ç‰¹å¾æ–‡ä»¶
              //æ¨¡å—è¿”å›ç¡®è®¤å­—
              unsigned char PS_Match(void)
              {
                if (AS608_PackHead() == 1)
                  return 0xFF;
                SendFlag(0x01);
                SendLength(0x03);
                Sendcmd(0x03); /*ç²¾ç¡®æ¯”å¯¹æŒ‡ä»¤*/
                SendCheck(0x01 + 0x03 + 0x03);
              
                // sure = ReturnFlag(&p);
                return JudgeStr(1000, 0x05);
              }
              //æœç´¢æŒ‡çº¹ PS_Search
              //åŠŸèƒ½:ä»¥CharBuffer1æˆ–CharBuffer2ä¸­çš„ç‰¹å¾æ–‡ä»¶æœç´¢æ•´ä¸ªæˆ–éƒ¨åˆ†æŒ‡çº¹åº“.è‹¥æœç´¢åˆ°ï¼Œåˆ™è¿
             -”å›é¡µç ã€‚
              //å‚æ•°:  BufferID @ref CharBuffer1  CharBuffer2
              //è¯´æ˜:  æ¨¡å—è¿”å›ï¿½?è®¤å­—ï¼Œé¡µç ï¼ˆç›¸é…æŒ‡çº¹æ¨¡æ¿ï¿½?
              unsigned char PS_Search(unsigned char BufferID, unsigned short StartPage, unsigned short PageNum, unsigned
             - short *p)
              {
                unsigned char sure;
                if (AS608_PackHead() == 1)
                  return 0xFF;
                SendFlag(0x01); //å‘½ä»¤åŒ…æ ‡è¯†
                SendLength(0x08);
                Sendcmd(0x04);
                AS608_SendData(BufferID);
                AS608_SendData(StartPage >> 8);
                AS608_SendData(StartPage);
                AS608_SendData(PageNum >> 8);
                AS608_SendData(PageNum);
                SendCheck(0x01 + 0x08 + 0x04 + BufferID + (StartPage >> 8) + (unsigned char)StartPage + (PageNum >> 8) + 
             -(unsigned char)PageNum);
                sure = JudgeStr(1000, 0x07);
                *p = (uart_rec_buff[10] << 8) + uart_rec_buff[11];
                return sure;
              }
              
              //åˆå¹¶ç‰¹å¾ï¼ˆç”Ÿæˆæ¨¡æ¿ï¼‰PS_RegModel
              //åŠŸèƒ½:å°†CharBuffer1ä¸CharBuffer2ä¸­çš„ç‰¹å¾æ–‡ä»¶åˆå¹¶ç”Ÿæˆ æ¨¡æ¿,ç»“æœå­˜äºCharBuffer1ä¸CharB
             -uffer2
C51 COMPILER V9.59.0.0   DQIOT_FP_SY                                                       04/20/2021 16:21:03 PAGE 8   

              //è¯´æ˜:  æ¨¡å—è¿”å›ç¡®è®¤å­—
              unsigned char PS_RegModel(void)
              {
                if (AS608_PackHead() == 1)
                  return 0xFF;
                SendFlag(0x01);
                SendLength(0x03);
                Sendcmd(0x05); /*åˆå¹¶ç‰¹å¾æŒ‡ä»¤*/
                SendCheck(0x01 + 0x03 + 0x05);
              
                // sure = ReturnFlag(&p);
                return JudgeStr(1000, 0x03);
              }
              
              //å‚¨å­˜æ¨¡æ¿ PS_StoreChar
              //åŠŸèƒ½:å°† CharBuffer1 æˆ– CharBuffer2 ä¸­çš„æ¨¡æ¿æ–‡ä»¶å­˜åˆ° PageID å·flashæ•°æ®åº“ä½ç½®ã€‚
              //å‚æ•°:  BufferID @ref charBuffer1:0x01 charBuffer1:0x02
              //       PageIDï¼ˆæŒ‡çº¹åº“ä½ç½®å·ï¼‰
              //è¯´æ˜:  æ¨¡å—è¿”å›ç¡®è®¤å­—
              unsigned char PS_StoreChar(unsigned char BufferID, unsigned short PageID)
              {
                if (AS608_PackHead() == 1)
                  return 0xFF;
                SendFlag(0x01);
                SendLength(0x06);
                Sendcmd(0x06); /*å­˜å‚¨æ¨¡æ¿æŒ‡ä»¤*/
                AS608_SendData(BufferID);
                AS608_SendData(PageID >> 8);
                AS608_SendData(PageID);
                SendCheck(0x01 + 0x06 + 0x06 + BufferID + (PageID >> 8) + (unsigned char)PageID);
              
                // sure = ReturnFlag(&p);
                return JudgeStr(1000, 0x03);
              }
              
              //åˆ é™¤æ¨¡æ¿ PS_DeletChar
              //åŠŸèƒ½:  åˆ é™¤flashæ•°æ®åº“ä¸­æŒ‡å®šIDå·å¼€å§‹çš„Nä¸ªæŒ‡çº¹æ¨¡æ¿
              //å‚æ•°:  PageID(æŒ‡çº¹åº“æ¨¡æ¿å·)ï¼ŒNåˆ é™¤çš„æ¨¡æ¿ä¸ªæ•°ã€‚
              //è¯´æ˜:  æ¨¡å—è¿”å›ç¡®è®¤å­—
              unsigned char PS_DeletChar(unsigned short PageID, unsigned short N)
              {
                if (AS608_PackHead() == 1)
                  return 0xFF;
                SendFlag(0x01); //å‘½ä»¤åŒ…æ ‡è¯†
                SendLength(0x07);
                Sendcmd(0x0C); /*åˆ é™¤æŒ‡å®šæŒ‡çº¹æ¨¡æ¿æŒ‡ä»¤*/
                AS608_SendData(PageID >> 8);
                AS608_SendData(PageID);
                AS608_SendData(N >> 8);
                AS608_SendData(N);
                SendCheck(0x01 + 0x07 + 0x0C + (PageID >> 8) + (unsigned char)PageID + (N >> 8) + (unsigned char)N);
              
                //AS608_DELAY_MS(400);
              
                // sure = ReturnFlag(&p);
                return JudgeStr(1000, 0x03);
              }
              
              //é«˜é€Ÿæœç´¢PS_HighSpeedSearch
              //åŠŸèƒ½ï¼šä»¥ CharBuffer1æˆ–CharBuffer2ä¸­çš„ç‰¹å¾æ–‡ä»¶é«˜é€Ÿæœç´¢æ•´ä¸ªæˆ–éƒ¨åˆ†æŒ‡çº¹åº“ã€‚
              //      è‹¥æœç´¢åˆ°ï¼Œåˆ™è¿”å›é¡µç ,è¯¥æŒ‡ä»¤å¯¹äºçš„ç¡®å­˜åœ¨äºæŒ‡çº¹åº“ä¸­ ï¼Œä¸”ç™»å½•æ—¶è´¨é‡
              //      å¾ˆå¥½çš„æŒ‡çº¹ï¼Œä¼šå¾ˆå¿«ç»™å‡ºæœç´¢ç»“æœã€‚
C51 COMPILER V9.59.0.0   DQIOT_FP_SY                                                       04/20/2021 16:21:03 PAGE 9   

              //å‚æ•°:  BufferIDï¼Œ StartPage(èµ·å§‹é¡µ)ï¼ŒPageNumï¼ˆé¡µæ•°ï¼‰
              //è¯´æ˜:  æ¨¡å—è¿”å›ç¡®è®¤å­—+é¡µç ï¼ˆç›¸é…æŒ‡çº¹æ¨¡æ¿ï¼‰
              unsigned char PS_HighSpeedSearch(unsigned char BufferID, unsigned short StartPage, unsigned short PageNum,
             - unsigned short *p)
              {
                unsigned char ensure;
              
                if (AS608_PackHead() == 1)
                  return 0xFF;
                SendFlag(0x01);
                SendLength(0x08);
                Sendcmd(0x1b); /*é«˜é€Ÿæœç´¢æŒ‡çº¹åº“æŒ‡ä»¤*/
                AS608_SendData(BufferID);
                AS608_SendData(StartPage >> 8);
                AS608_SendData(StartPage);
                AS608_SendData(PageNum >> 8);
                AS608_SendData(PageNum);
                SendCheck(0x01 + 0x08 + 0x1b + BufferID + (StartPage >> 8) + (unsigned char)StartPage + (PageNum >> 8) + 
             -(unsigned char)PageNum);
              
                // ensure = ReturnFlag(&rc);
                ensure = JudgeStr(1000, 0x07);
              
                *p = (uart_rec_buff[10] << 8) + uart_rec_buff[11];
              
                return ensure;
              }
              
              //æ¸…ç©ºæŒ‡çº¹åº“ PS_Empty
              //åŠŸèƒ½:  åˆ é™¤flashæ•°æ®åº“ä¸­æ‰€æœ‰æŒ‡çº¹æ¨¡æ¿
              //å‚æ•°:  æ— 
              //è¯´æ˜:  æ¨¡å—è¿”å›ç¡®è®¤å­—
              unsigned char PS_Empty(void)
              {
                if (AS608_PackHead() == 1)
                  return 0xFF;
                SendFlag(0x01); //å‘½ä»¤åŒ…æ ‡è¯†
                SendLength(0x03);
                Sendcmd(0x0D);
                SendCheck(0x01 + 0x03 + 0x0D);
              
                // sure = ReturnFlag(&p);
                return JudgeStr(1000, 0x03);
              }
              
              #if 0
              /**
                * @brief  æ£€æŸ¥STM32ä¸æŒ‡çº¹æ¨¡å—çš„é€šä¿¡è¿æ¥
                * @param  PS_AddræŒ‡çº¹æ¨¡å—åœ°å€
                * @retval è¿”å›å€¼0é€šè®¯æˆåŠŸ;1è¡¨ç¤ºé€šè®¯ä¸æˆåŠŸ
                */
              unsigned char PS_Connect(unsigned long *PS_Addr)
              {
                PS_Addr = 0;
                if(AS608_PackHead()==1)
                  return 0xFF;
                AS608_SendData(0X01);
                AS608_SendData(0X00);
                AS608_SendData(0X00);
                return 1;   
              }
              
C51 COMPILER V9.59.0.0   DQIOT_FP_SY                                                       04/20/2021 16:21:03 PAGE 10  

              //å†™ç³»ç»Ÿå¯„å­˜å™¨ PS_WriteReg
              //åŠŸèƒ½:  å†™æ¨¡å—å¯„å­˜å™¨
              //å‚æ•°:  å¯„å­˜å™¨åºå·RegNum:4\5\6
              //è¯´æ˜:  æ¨¡å—è¿”å›ç¡®è®¤å­—
              unsigned char PS_WriteReg(unsigned char RegNum, unsigned char DATA)
              {
                unsigned short temp;
                unsigned short sure,p=0;
              
                if(AS608_PackHead()==1)
                  return 0xFF;
                SendFlag(0x01);//é›æˆ’æŠ¤é–å‘®çˆ£ç’‡
                SendLength(0x05);
                Sendcmd(0x0E);
                AS608_SendData(RegNum);
                AS608_SendData(DATA);
                temp = RegNum+DATA+0x01+0x05+0x0E;
                SendCheck(temp);
                sure=ReturnFlag(&p);
                return sure;
              }
              //è¯»ç³»ç»ŸåŸºæœ¬å‚æ•° PS_ReadSysPara
              //åŠŸèƒ½:  è¯»å–æ¨¡å—çš„åŸºæœ¬å‚æ•°ï¼ˆæ³¢ç‰¹ç‡ï¼ŒåŒ…å¤§å°ç­‰)
              //å‚æ•°:  æ— 
              //è¯´æ˜:  æ¨¡å—è¿”å›ç¡®è®¤å­— + åŸºæœ¬å‚æ•°ï¼ˆ16bytesï¼‰
              unsigned char PS_ReadSysPara(void)
              {
                unsigned short temp;
                unsigned char  ensure;
                unsigned char  *send_data;
                unsigned short p=0;
                
                if(AS608_PackHead()==1)
                  return 0xFF;
                SendFlag(0x01);//é›æˆ’æŠ¤é–å‘®çˆ£ç’‡
                SendLength(0x03);
                Sendcmd(0x0F);
                temp = 0x01+0x03+0x0F;
                SendCheck(temp);
                ensure=ReturnFlag(&p);
                if(send_data)
                {
              
                }   
                else
                  ensure=0xff;
                if(ensure==0x00)
                {
              
                }
                return ensure;
              }
              //è®¾ç½®æ¨¡å—åœ°å€ PS_SetAddr
              //åŠŸèƒ½:  è®¾ç½®æ¨¡å—åœ°å€
              //å‚æ•°:  PS_addr
              //è¯´æ˜:  æ¨¡å—è¿”å›ç¡®è®¤å­—
              unsigned char PS_SetAddr(unsigned long PS_addr)
              {
                unsigned short temp;
                unsigned char  ensure;
              
                if(AS608_PackHead()==1)
C51 COMPILER V9.59.0.0   DQIOT_FP_SY                                                       04/20/2021 16:21:03 PAGE 11  

                  return 0xFF;
                SendFlag(0x01);//å‘½ä»¤åŒ…æ ‡è¯†
                SendLength(0x07);
                Sendcmd(0x15);
                AS608_SendData(PS_addr>>24);
                AS608_SendData(PS_addr>>16);
                AS608_SendData(PS_addr>>8);
                AS608_SendData(PS_addr);
                temp = 0x01+0x07+0x15
                +(unsigned char)(PS_addr>>24)+(unsigned char)(PS_addr>>16)
                +(unsigned char)(PS_addr>>8) +(unsigned char)PS_addr;       
                SendCheck(temp);
              
                return ensure;
              }
              //åŠŸèƒ½ï¼š æ¨¡å—å†…éƒ¨ä¸ºç”¨æˆ·å¼€è¾Ÿäº†256bytesçš„FLASHç©ºé—´ç”¨äºå­˜ç”¨æˆ·è®°äº‹æœ¬,
              //  è¯¥è®°äº‹æœ¬é€»è¾‘ä¸Šè¢«åˆ†æˆ 16 ä¸ªé¡µã€‚
              //å‚æ•°:  NotePageNum(0~15),Byte32(è¦å†™å…¥å†…å®¹ï¼Œ32ä¸ªå­—èŠ‚)
              //è¯´æ˜:  æ¨¡å—è¿”å›ç¡®è®¤å­—
              unsigned char PS_WriteNotepad(unsigned char NotePageNum,unsigned char *Byte32)
              {
                unsigned short temp;
                unsigned char  ensure,i;
                
                *Byte32 = 0;
                
                if(AS608_PackHead()==1)
                  return 0xFF;
                SendFlag(0x01); //å‘½ä»¤åŒ…æ ‡è¯†
                SendLength(36);
                Sendcmd(0x18);
                AS608_SendData(NotePageNum);
                for(i=0;i<32;i++)
                {
                  AS608_SendData(Byte32[i]);
                  temp += Byte32[i];
                }
                temp =0x01+36+0x18+NotePageNum+temp;
                SendCheck(temp);
              
                return ensure;
              }
              //è¯»è®°äº‹PS_ReadNotepad
              //åŠŸèƒ½ï¼š  è¯»å–FLASHç”¨æˆ·åŒºçš„128bytesæ•°æ®
              //å‚æ•°:  NotePageNum(0~15)
              //è¯´æ˜:  æ¨¡å—è¿”å›ç¡®è®¤å­—+ç”¨æˆ·ä¿¡æ¯
              unsigned char PS_ReadNotepad(unsigned char NotePageNum,unsigned char *Byte32)
              {
                unsigned short temp;
                unsigned char  ensure;
                
                *Byte32 = 0;
                
                if(AS608_PackHead()==1)
                  return 0xFF;
                SendFlag(0x01);//å‘½ä»¤åŒ…æ ‡è¯†
                SendLength(0x04);
                Sendcmd(0x19);
                AS608_SendData(NotePageNum);
                temp = 0x01+0x04+0x19+NotePageNum;
                SendCheck(temp);
              
C51 COMPILER V9.59.0.0   DQIOT_FP_SY                                                       04/20/2021 16:21:03 PAGE 12  

                return ensure;
              }
              #endif
              
              //è¯»æœ‰æ•ˆæ¨¡æ¿ä¸ªæ•° PS_ValidTempleteNum
              //åŠŸèƒ½ï¼šè¯»æœ‰æ•ˆæ¨¡æ¿ä¸ªæ•°
              //å‚æ•°: æ— 
              //è¯´æ˜: æ¨¡å—è¿”å›ç¡®è®¤å­—+æœ‰æ•ˆæ¨¡æ¿ä¸ªæ•°ValidN
              unsigned char PS_ValidTempleteNum(unsigned short *ValidN)
              {
                unsigned char ensure;
              
                if (AS608_PackHead() == 1)
                  return 0xFF;
                SendFlag(0x01); //å‘½ä»¤åŒ…æ ‡è¯†
                SendLength(0x03);
                Sendcmd(0x1d);
                SendCheck(0x01 + 0x03 + 0x1d);
              
                // ensure = ReturnFlag(&p);
                ensure = JudgeStr(1000, 0x05);
              
                *ValidN = (uart_rec_buff[10] << 8) + uart_rec_buff[11];
              
                return ensure;
              }
              
              unsigned char PS_AutoEnRoll(unsigned short id, unsigned char num, unsigned short param)
              {
                if (AS608_PackHead() == 1)
                  return 0xFF;
                SendFlag(0x01); //å‘½ä»¤åŒ…æ ‡è¯†
                SendLength(0x08);
                Sendcmd(0x31);
                AS608_SendData(id >> 8);
                AS608_SendData(id & 0xFF);
                AS608_SendData(num);
                AS608_SendData(param >> 8);
                AS608_SendData(param & 0xFF);
                SendCheck(0x01 + 0x08 + 0x31 + (id >> 8) + (id & 0xFF) + num + (param >> 8) + (param & 0xFF));
              
                return 0;
              }
              
              //è‡ªåŠ¨éªŒè¯æŒ‡çº¹ PS_AutoIdentify
              //åŠŸèƒ½ï¼š
              //1.è‡ªåŠ¨é‡‡é›†æŒ‡çº¹ï¼Œåœ¨æŒ‡çº¹åº“ä¸­æœç´¢ç›®æ ‡æ¨¡æ¿å¹¶è¿”å›æœç´¢ç»“æœã€‚
              //2.å¦‚æœç›®æ ‡æ¨¡æ¿åŒå½“å‰é‡‡é›†çš„æŒ‡çº¹æ¯”å¯¹å¾—åˆ†å¤§äºæœ€é«˜é˜€å€¼ï¼Œå¹¶ä¸”ç›®æ ‡æ¨¡æ¿ä¸ºä¸å®Œ
             -æ•´ç‰¹å¾åˆ™ä»¥é‡‡é›†çš„ç‰¹å¾æ›´æ–°ç›®æ ‡æ¨¡æ¿çš„ç©ºç™½åŒºåŸŸã€‚
              //å‚æ•°: æ— 
              //è¯´æ˜: æ¨¡å—è¿”å›ç¡®è®¤å­—+é¡µç ï¼ˆç›¸é…æŒ‡çº¹æ¨¡æ¿ï¼‰
              unsigned char PS_AutoIdentify(unsigned short id, unsigned char level, unsigned short param)
              {
                if (AS608_PackHead() == 1)
                  return 0xFF;
                SendFlag(0x01); //å‘½ä»¤åŒ…æ ‡è¯†
                SendLength(0x08);
                Sendcmd(0x32);
                AS608_SendData(level);
                AS608_SendData(id >> 8);
                AS608_SendData(id & 0xFF);
                AS608_SendData(param >> 8);
C51 COMPILER V9.59.0.0   DQIOT_FP_SY                                                       04/20/2021 16:21:03 PAGE 13  

                AS608_SendData(param & 0xFF);
                SendCheck(0x01 + 0x08 + 0x32 + (id >> 8) + (id & 0xFF) + level + (param >> 8) + (param & 0xFF));
              
                return 0;
              }
              
              //ä¸AS608æ¡æ‰‹ PS_HandShake
              //å‚æ•°: PS_Addråœ°å€æŒ‡é’ˆ
              //è¯´æ˜: æ¨¡å—è¿”æ–°åœ°å€ï¼ˆæ­£ç¡®åœ°å€ï¼‰
              unsigned char PS_HandShake(unsigned long *PS_Addr)
              {
                *PS_Addr = 0;
              
                if (AS608_PackHead() == 1)
                  return 0xFF;
                SendFlag(0x01);
                SendLength(0x03);
                Sendcmd(0x53);
                SendCheck(0x57);
              
                return JudgeStr(1000, 0x03);
              }
              
              unsigned char PS_Reset(void)
              {
                return 0;
              }
              
              unsigned char PS_Sleep(void)
              {
                if (AS608_PackHead() == 1)
                  return 0xFF;
                SendFlag(0x01); //å‘½ä»¤åŒ…æ ‡è¯†
                SendLength(0x03);
                Sendcmd(0x60);
                SendCheck(0x01 + 0x03 + 0x60);
                return 0;
              }
              
              //void AS608_log(void)
              //{
              //  unsigned char i =0;
              ////  NRF_LOG_PRINTF_DEBUG("receive :");
              //  for(i=0;i<25;i++)
              //  {
              //    NRF_LOG_PRINTF_DEBUG("%2x ",as608_rec_buff[i]);
              //  }
              //  NRF_LOG_PRINTF_DEBUG("\n");
              //}
              
              void FP_Light(FP_COLOR_E light_id)
              {
                //  if(fp_flag == FP_LT5X)
                //  {
                //#ifdef __FP_LT5X_LIGHT_SUPPORT__
                unsigned short temp;
                unsigned char sure = 0; //,p=0;
              
                if (light_id == Light_Color)
                  return;
              
                if (AS608_PackHead() == 1)
C51 COMPILER V9.59.0.0   DQIOT_FP_SY                                                       04/20/2021 16:21:03 PAGE 14  

                  return;
                SendFlag(0x01);
                SendLength(0x07);
                Sendcmd(0x41);
                switch (light_id)
                {
                case FP_BLUE:
                  AS608_SendData(0x01);
                  AS608_SendData(0x01);
                  AS608_SendData(0x00);
                  AS608_SendData(0x50);
                  temp = 0x01 + 0x07 + 0x41 + 0x02 + 0x50;
                  break;
                case FP_GREEN:
                  AS608_SendData(0x01);
                  AS608_SendData(0x02);
                  AS608_SendData(0x02);
                  AS608_SendData(0);
                  temp = 0x01 + 0x07 + 0x41 + 0x05 + 0;
                  break;
                case FP_RED:
                  AS608_SendData(0x01);
                  AS608_SendData(0x04);
                  AS608_SendData(0x04);
                  AS608_SendData(0);
                  temp = 0x01 + 0x07 + 0x41 + 0x09 + 0;
                  break;
                case FP_NONE_COLOR:
                  AS608_SendData(0x04);
                  AS608_SendData(0x00);
                  AS608_SendData(0x00);
                  AS608_SendData(0xC8);
                  temp = 0x01 + 0x07 + 0x41 + 0x04 + 0xC8;
                  break;
                }
                SendCheck(temp);
              
                // sure=ReturnFlag(&p);
                sure = JudgeStr(1000, 0x03);
                //#endif
                Light_Color = light_id;
              
                //  }
              }
              
              FP_COLOR_E FP_Get_Light(void)
              {
                return Light_Color;
              }
              
              unsigned char FP_Get_Start_Flag(void)
              {
                if (uart_getbuflen > 0)
                {
                  unsigned char i;
              
                  for (i = 0; i < uart_getbuflen; i++)
                  {
                    if (uart_get_buf[i] == 0x55)
                    {
                      uart_getbuflen = 0;
                      return 1;
C51 COMPILER V9.59.0.0   DQIOT_FP_SY                                                       04/20/2021 16:21:03 PAGE 15  

                    }
                  }
                }
                return 0;
              }
              
              #endif //__PREIPHERAL_FP_LT5X_SUPPORT__


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   ----    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
