C51 COMPILER V9.59.0.0   MMI_WIFI                                                          02/22/2021 17:53:07 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE MMI_WIFI
OBJECT MODULE PLACED IN .\output\mmi_wifi.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE mmi_src\mmi_wifi.c LARGE OMF2 OPTIMIZE(8,SPEED) BROWSE INCDIR(.\include;
                    -.\Library\byd_standard_peripheral\include;.\byd_api\byd_key\include;.\byd_api\byd_mifare\include;.\byd_tool_comm;.\byd_r
                    -fid;.\mmi_inc) DEBUG PRINT(.\list\mmi_wifi.lst) TABS(2) OBJECT(.\output\mmi_wifi.obj)

line level    source

   1          #ifndef __MMI_WIFI_C__
   2          #define __MMI_WIFI_C__
   3          
   4          #include "dqiot_drv_wifi.h"
   5          #include "mmi_sys.h"
   6          #include "mmi_ms.h"
   7          #include "mmi_audio.h"
   8          #include "mmi_fs.h"
   9          #include "delay.h"
  10          
  11          static unsigned int wifi_check_times = 0;
  12          
  13          
  14          /*
  15          parameter: 
  16            none
  17          return :
  18            none
  19          */
  20          void mmi_dq_wifi_wakeup(void)
  21          {
  22   1        wifi_wake_up();
  23   1      }
  24          
  25          /*
  26          parameter: 
  27            none
  28          return :
  29            none
  30          */
  31          void mmi_dq_wifi_sleep(void)
  32          {
  33   1        wifi_sleep_mode();
  34   1      }
  35          
  36          /*
  37          parameter: 
  38            none
  39          return :
  40            none
  41          */
  42          unsigned char mmi_dq_wifi_setting(void)
  43          {
  44   1        unsigned char ret = 1;
  45   1        wifi_wake_up();
  46   1        delay_ms(250);
  47   1        if(wifi_net_connect_send() == 0)
  48   1        {
  49   2          delay_ms(250);
  50   2          ret = wifi_net_connect_send();
  51   2        }
  52   1        if(ret == 1)
  53   1          wifi_check_times = 0;
C51 COMPILER V9.59.0.0   MMI_WIFI                                                          02/22/2021 17:53:07 PAGE 2   

  54   1        return ret;
  55   1      }
  56          
  57          /*
  58          parameter: 
  59            none
  60          return :
  61            none
  62          */
  63          void mmi_dq_wifi_connected_fail(void)
  64          {
  65   1        mmi_dq_fs_set_wifi_setting(0);
  66   1        if(SYS_STATUS_WIFI_MODE == mmi_dq_ms_get_sys_state())
  67   1          mmi_dq_ms_set_sys_state(SYS_STATUS_IDLE);
  68   1        else if(SYS_STATUS_ENTER_SLEEP == mmi_dq_ms_get_sys_state())
  69   1          mmi_dq_sys_wake_up();
  70   1        mmi_dq_aud_play_with_id(AUD_BASE_ID_FAIL);
  71   1        return;
  72   1      }
  73          
  74          /*
  75          parameter: 
  76            none
  77          return :
  78            none
  79          */
  80          void mmi_dq_wifi_connected_suc(void)
  81          { 
  82   1        mmi_dq_fs_set_wifi_setting(1);
  83   1        if(SYS_STATUS_WIFI_MODE == mmi_dq_ms_get_sys_state())
  84   1          mmi_dq_ms_set_sys_state(SYS_STATUS_IDLE);
  85   1        else if(SYS_STATUS_ENTER_SLEEP == mmi_dq_ms_get_sys_state())
  86   1          mmi_dq_sys_wake_up();
  87   1        mmi_dq_aud_play_with_id(AUD_BASE_ID_SUCCESS);
  88   1        return;
  89   1      }
  90          
  91          /*
  92          parameter: 
  93            none
  94          return :
  95            none
  96          */
  97          void mmi_dq_wifi_check_connect(void)
  98          {
  99   1        wifi_check_times++;
 100   1        if(wifi_net_connect_state() == 1)
 101   1          mmi_dq_wifi_connected_suc();
 102   1        else if(wifi_check_times >= 150)
 103   1          mmi_dq_wifi_connected_fail();
 104   1        else
 105   1          mmi_dq_sys_set_wifi_check();
 106   1      }
 107          
 108          /*
 109          parameter: 
 110            none
 111          return :
 112            none
 113          */
 114          unsigned char mmi_dq_wifi_open_ask(void)
 115          {
C51 COMPILER V9.59.0.0   MMI_WIFI                                                          02/22/2021 17:53:07 PAGE 3   

 116   1        mmi_dq_wifi_wakeup();
 117   1        delay_ms(250);
 118   1        if(wifi_open_ask() == 0)
 119   1        {
 120   2          delay_ms(250);
 121   2          return wifi_open_ask();
 122   2        }
 123   1        else
 124   1          return 1;
 125   1      }
 126          
 127          
 128          /*
 129          parameter: 
 130            none
 131          return :
 132            none
 133          */
 134          void mmi_dq_wifi_add_password(void)
 135          {
 136   1        mmi_dq_wifi_wakeup();
 137   1      
 138   1        delay_ms(150);
 139   1        wifi_add_password();
 140   1      }
 141          
 142          /*
 143          parameter: 
 144            none
 145          return :
 146            none
 147          */
 148          void mmi_dq_wifi_del_password(void)
 149          {
 150   1        mmi_dq_wifi_wakeup();
 151   1      
 152   1        delay_ms(150);
 153   1      
 154   1        wifi_del_password();
 155   1      }
 156          
 157          /*
 158          parameter: 
 159            none
 160          return :
 161            none
 162          */
 163          void mmi_dq_wifi_add_fp(void)
 164          {
 165   1        mmi_dq_wifi_wakeup();
 166   1      
 167   1        delay_ms(150);
 168   1      
 169   1        wifi_add_fp();
 170   1      }
 171          
 172          /*
 173          parameter: 
 174            none
 175          return :
 176            none
 177          */
C51 COMPILER V9.59.0.0   MMI_WIFI                                                          02/22/2021 17:53:07 PAGE 4   

 178          void mmi_dq_wifi_del_fp(void)
 179          {
 180   1        mmi_dq_wifi_wakeup();
 181   1      
 182   1        delay_ms(150);
 183   1      
 184   1        wifi_del_fp();
 185   1      }
 186          
 187          /*
 188          parameter: 
 189            none
 190          return :
 191            none
 192          */
 193          void mmi_dq_wifi_open_by_password(void)
 194          {
 195   1        mmi_dq_wifi_wakeup();
 196   1      
 197   1        delay_ms(100);
 198   1      
 199   1        wifi_open_by_password();
 200   1      }
 201          
 202          /*
 203          parameter: 
 204            none
 205          return :
 206            none
 207          */
 208          void mmi_dq_wifi_open_by_fp(void)
 209          {
 210   1        mmi_dq_wifi_wakeup();
 211   1      
 212   1        delay_ms(150);
 213   1      
 214   1        wifi_open_by_fp();
 215   1      }
 216          
 217          /*
 218          parameter: 
 219            none
 220          return :
 221            none
 222          */
 223          void mmi_dq_wifi_open_by_key(void)
 224          {
 225   1        mmi_dq_wifi_wakeup();
 226   1      
 227   1        delay_ms(150);
 228   1      
 229   1        wifi_open_by_key();
 230   1      }
 231          
 232          /*
 233          parameter: 
 234            none
 235          return :
 236            none
 237          */
 238          void mmi_dq_wifi_open_by_wifi(void)
 239          {
C51 COMPILER V9.59.0.0   MMI_WIFI                                                          02/22/2021 17:53:07 PAGE 5   

 240   1      
 241   1        wifi_open_by_wifi();
 242   1      }
 243          
 244          /*
 245          parameter: 
 246            none
 247          return :
 248            none
 249          */
 250          void mmi_dq_wifi_door_close(void)
 251          {
 252   1      
 253   1        wifi_door_close();
 254   1      }
 255          
 256          /*
 257          parameter: 
 258            none
 259          return :
 260            none
 261          */
 262          void mmi_dq_wifi_via_alarm(void)
 263          {
 264   1        mmi_dq_wifi_wakeup();
 265   1      
 266   1        delay_ms(150);
 267   1      
 268   1        wifi_via_alarm();
 269   1      }
 270          
 271          /*
 272          parameter: 
 273            none
 274          return :
 275            none
 276          */
 277          void mmi_dq_wifi_pw_alarm(void)
 278          {
 279   1        mmi_dq_wifi_wakeup();
 280   1      
 281   1        delay_ms(150);
 282   1      
 283   1        wifi_pw_alarm();
 284   1      }
 285          
 286          /*
 287          parameter: 
 288            none
 289          return :
 290            none
 291          */
 292          void mmi_dq_wifi_fp_alarm(void)
 293          {
 294   1        mmi_dq_wifi_wakeup();
 295   1      
 296   1        delay_ms(150);
 297   1      
 298   1        wifi_fp_alarm();
 299   1      }
 300          
 301          /*
C51 COMPILER V9.59.0.0   MMI_WIFI                                                          02/22/2021 17:53:07 PAGE 6   

 302          parameter: 
 303            none
 304          return :
 305            none
 306          */
 307          void mmi_dq_wifi_lowpower_alarm(void)
 308          {
 309   1        static uint8_t wifi_lowpower_flag = 0;
 310   1        if(wifi_lowpower_flag == 0)
 311   1        {
 312   2          wifi_lowpower_flag = 1;
 313   2          mmi_dq_wifi_wakeup();
 314   2      
 315   2          delay_ms(150);
 316   2        
 317   2          wifi_lowpower_alarm();
 318   2        }
 319   1      }
 320          #endif


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    363    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      7       1
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
